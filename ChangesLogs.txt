**V4.9.1 - (DEFINITIVE FIX & AUTH REFACTOR) - 29/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas para las causas raíz de las fallas en el espaciado de la barra de búsqueda y la visualización de la video guía. Adicionalmente, se refactorizó la lógica de inicialización para asegurar un renderizado robusto.

**B. Cambios Implementados:**

1.  **Corrección de Espaciado de Búsqueda (Causa Raíz: Efecto Aditivo de CSS) (`style.css`):**
    *   **Problema:** Un `padding-bottom` heredado de la regla general `.container` persistía en el estado de búsqueda activa, creando un espacio no deseado.
    *   **Solución:** Se modificó la regla `body.search-active .container` para que defina explícitamente todos los valores de `padding` (`padding: 60px 20px 0;`). Esto anula por completo la regla general, eliminando el `padding-bottom` y corrigiendo el espaciado de manera definitiva.
    *   **Líneas Afectadas en `style.css`:** 393-396.

2.  **Corrección de Visualización de Video (Causa Raíz: Race Condition) (`ui.js`):**
    *   **Problema:** Una condición de carrera (`race condition`) causaba que la altura del panel del acordeón se calculara *antes* de que el `iframe` del video se cargara, resultando en un panel demasiado pequeño que ocultaba el video.
    *   **Solución:** Se refactorizó el `event listener` del `click` en `createAccordionSection`. La lógica ahora utiliza un `setTimeout` con un retardo de `0` milisegundos. Esto pospone la ejecución del cálculo de `scrollHeight` hasta el siguiente ciclo de eventos del navegador, dando tiempo al `iframe` para que comience a renderizarse y tenga dimensiones, resolviendo la condición de carrera y asegurando que el panel se expanda a la altura correcta.
    *   **Líneas Afectadas en `ui.js`:** 1070-1085.

3.  **Refactorización de la Lógica de Inicialización (`auth.js`):**
    *   **Problema:** Existía una condición de carrera donde `showApp` podía ejecutarse antes de que `loadInitialData` completara la carga de datos del catálogo, resultando en un renderizado vacío.
    *   **Solución:** Se reordenó el flujo en `checkSession`. Ahora, `handleLoginSuccess` se llama primero para establecer el estado del usuario, y `loadInitialData` se llama después. La función `loadInitialData` fue modificada para que, al completarse exitosamente, llame a `showApp`, garantizando que la UI se renderice solo cuando los datos estén listos.
    *   **Líneas Afectadas en `auth.js`:** 39, 83-84.

**C. Impacto:**
- **Solución Definitiva:** Se han resuelto las causas raíz de ambos problemas persistentes, no solo sus síntomas.
- **UI Correcta:** El espaciado de la barra de búsqueda ahora es preciso y funcional.
- **Funcionalidad Restaurada:** La video guía es ahora visible y el acordeón funciona de manera robusta y predecible.
- **Estabilidad de la Aplicación:** La refactorización de la inicialización elimina condiciones de carrera y asegura que la aplicación se cargue y renderice de manera fiable.
**V4.9.0 - (DEFINITIVE ROOT CAUSE FIX) - 29/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas para las causas raíz de los problemas persistentes de visualización de video y espaciado de la barra de búsqueda, basadas en una auditoría correcta y consolidada del flujo de datos completo (backend y frontend).

**B. Cambios Implementados:**

1.  **Corrección de Contrato de Datos Backend-Frontend (Causa Raíz del Video):**
    *   **Problema:** El backend (`services/catalog/catalog.js`) enviaba la URL del video bajo la propiedad `videoGuiaDesarmeUrl`, pero el frontend (`ui.js`) esperaba una propiedad llamada `Video`. Esta discrepancia causaba que el frontend no encontrara el dato.
    *   **Solución (Backend):** Se modificó `services/catalog/catalog.js` para alinear el contrato de datos. Ahora, la propiedad se renombra a `Video` antes de enviar la respuesta al frontend.
    *   **Solución (Frontend):** Se robusteció la lógica en `ui.js` para manejar correctamente la URL del video recibida y se añadió una nueva función (`getYouTubeEmbedUrl`) para convertir de forma fiable cualquier formato de URL de YouTube a un formato `embed` válido, solucionando el problema de reproducción.
    *   **Líneas Afectadas en `catalog.js`:** 311-313.
    *   **Líneas Afectadas en `ui.js`:** 1041-1065 (nueva función), 1076.

2.  **Corrección de Espaciado de Búsqueda (Causa Raíz: Estilo en Línea):**
    *   **Problema:** Un estilo en línea (`margin-bottom: 10px;`) en el `div#search-wrapper` en `index.html` tenía mayor especificidad que las reglas en `style.css`, causando un espaciado persistente.
    *   **Solución:** Se añadió la directiva `!important` a la regla `body.search-active #search-wrapper { margin-bottom: 0; }` en `style.css`. Esto le otorga la máxima prioridad, permitiendo anular el estilo en línea y eliminar el espacio no deseado.
    *   **Líneas Afectadas en `style.css`:** 386.

**C. Impacto:**
- **Funcionalidad de Video Restaurada:** La video guía de desarme ahora se visualiza y reproduce correctamente, ya que el frontend recibe el dato en el formato esperado y lo procesa de forma robusta.
- **UI Corregida Definitivamente:** El espacio extra debajo de la barra de búsqueda ha sido eliminado por completo, logrando el diseño requerido.
- **Robustez del Sistema:** Se ha corregido una inconsistencia fundamental en el contrato de datos entre el backend y el frontend, haciendo el sistema más predec- **V4.8.9 - (ROOT CAUSE FIX) - 29/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas para las causas raíz de los dos problemas persistentes, basadas en los hallazgos de una auditoría consolidada y correcta que incluyó el `README.md`, el servicio de backend `catalog.js` y el frontend.

**B. Cambios Implementados:**

1.  **Corrección de Contrato de Datos (Backend y Frontend):**
    *   **Problema:** El backend (`services/catalog/catalog.js`) enviaba la URL del video bajo la propiedad `videoGuiaDesarmeUrl`, pero el frontend (`ui.js`) esperaba una propiedad `Video`.
    *   **Solución (Backend):** Se modificó `services/catalog/catalog.js` para que, después de procesar la URL del video, la asigne a una nueva propiedad `Video` y elimine la propiedad original `videoGuiaDesarmeUrl` antes de enviar la respuesta.
    *   **Solución (Frontend):** Se ajustó `ui.js` para que utilice consistentemente la propiedad `Video` al construir el modal de detalle, asegurando que el contrato de datos se cumpla en ambos extremos.
    *   **Líneas Afectadas en `catalog.js`:** 308-315 (aprox.).
    *   **Líneas Afectadas en `ui.js`:** 749, 752, 1046, 1049.

2.  **Corrección de Espaciado (CSS):**
    *   **Problema:** Un `margin-bottom: 10px` en un estilo en línea en `index.html` (en el `div#search-wrapper`) no estaba siendo anulado, causando un espacio persistente.
    *   **Solución:** Se añadió `!important` a la regla `body.search-active #search-wrapper { margin-bottom: 0; }` en `style.css` para darle la especificidad necesaria para anular el estilo en línea.
    *   **Líneas Afectadas en `style.css`:** 386.

**C. Impacto:**
- **Funcionalidad Restaurada:** La video guía de desarme ahora se visualiza correctamente en el modal de detalle, ya que el frontend recibe el dato esperado.
- **UI Corregida:** El espacio extra debajo de la barra de búsqueda en el estado activo ha sido eliminado por completo.
- **Robustez del Sistema:** Se ha corregido un error fundamental de inconsistencia de datos entre el frontend y el backend, haciendo el sistema más predecible.

**V4.8.8 - (DEFINITIVE FIX) - 28/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas y robustas para las fallas persistentes en el espaciado de la barra de búsqueda y la visualización de la video guía, abordando las causas raíz identificadas en una auditoría profunda.

**B. Cambios Implementados:**

1.  **Corrección de Espaciado de Búsqueda (Causa Raíz: Efecto Aditivo) (`style.css`):**
    *   **Problema:** Un `padding-bottom` heredado de una regla general (`.container`) persistía en el estado de búsqueda activa, creando un espacio no deseado.
    *   **Solución:** Se modificó la regla `body.search-active .container` para que defina explícitamente todos los valores de `padding` (`padding: 60px 20px 0;`). Esto anula por completo la regla general, eliminando el `padding-bottom` y corrigiendo el espaciado de manera definitiva.
    *   **Líneas Afectadas en `style.css`:** 393-396.

2.  **Corrección de Visualización de Video (Causa Raíz: Race Condition) (`ui.js`):**
    *   **Problema:** Una condición de carrera (`race condition`) causaba que la altura del panel del acordeón se calculara *antes* de que el `iframe` del video se cargara, resultando en un panel demasiado pequeño que ocultaba el video.
    *   **Solución:** Se refactorizó el `event listener` del `click` en `createAccordionSection`. La lógica ahora utiliza un `setTimeout` con un retardo de `0` milisegundos. Esto pospone la ejecución del cálculo de `scrollHeight` hasta el siguiente ciclo de eventos del navegador, dando tiempo al `iframe` para que comience a renderizarse y tenga dimensiones, resolviendo así la condición de carrera y asegurando que el panel se expanda a la altura correcta.
    *   **Líneas Afectadas en `ui.js`:** 1070-1085.

**C. Impacto:**
- **Solución Definitiva:** Se han resuelto las causas raíz de ambos problemas persistentes, no solo sus síntomas.
- **UI Correcta:** El espaciado de la barra de búsqueda ahora es preciso y funcional.
- **Funcionalidad Restaurada:** La video guía es ahora visible y el acordeón funciona de manera robusta y predecible, manejando correctamente el contenido dinámico como los `iframes`.
