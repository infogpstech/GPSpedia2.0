**v4.2.0 (06/01/2026)**
*   **FEAT (feedback.js):** Se refactoriz贸 completamente la l贸gica de `handleSuggestYear` para cumplir con los nuevos requisitos de negocio. La funci贸n ahora requiere 3 votos de usuarios para aplicar un cambio y ejecuta una comprobaci贸n anti-colisi贸n para prevenir el solapamiento de rangos de a帽os entre diferentes generaciones de un mismo modelo.
*   **FEAT (catalog.js):** Se implement贸 el ordenamiento de categor铆as por popularidad. El servicio ahora calcula la cantidad de veh铆culos por categor铆a y devuelve la lista ordenada, permitiendo al frontend mostrar las categor铆as con m谩s contenido primero.
*   **REFACTOR (catalog.js):** Se centraliz贸 la l贸gica de conversi贸n de URLs de Google Drive a thumbnails en el backend. La nueva funci贸n `convertirAGoogleThumbnail` ahora procesa todas las URLs de im谩genes antes de enviarlas al frontend, mejorando el rendimiento y la consistencia.
*   **UX (index.html):** Se implementaron m煤ltiples mejoras en la interfaz de usuario:
    *   **Layout Principal:** Se reorganiz贸 la p谩gina principal para mostrar primero la secci贸n "ltimos Agregados" y luego las "Categor铆as".
    *   **Carrusel:** La secci贸n "ltimos Agregados" es ahora un carrusel que muestra 6 tarjetas.
    *   **Navegaci贸n por Marca:** La vista de selecci贸n de marca ahora muestra los logos en lugar de texto.
    *   **Modal de Detalles:** Se unific贸 la funcionalidad de "like" y "sugerir a帽o" en el bot贸n "til" (). Se a帽adieron placeholders de edici贸n "in-modal" para campos sin datos.
*   **CHORE:** Las modificaciones se realizaron de forma segura, sin alterar la l贸gica cr铆tica protegida de `auth.js` (sesiones) ni `catalog.js` (carga de datos y cach茅).

**v4.1.1 (05/01/2026)**
*   **FIX (index.html):** Se restaur贸 la l贸gica para el bot贸n de instalaci贸n de la PWA (`beforeinstallprompt` listener y el handler del click), que fue eliminada accidentalmente en una refactorizaci贸n previa. Esto soluciona una regresi贸n cr铆tica que imped铆a a los usuarios instalar la aplicaci贸n. (L铆neas 2315-2346).
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Utilities` a la nueva versi贸n desplegada y funcional, eliminando el endpoint placeholder. (L铆nea 14).

**v4.1.0 (04/01/2026)**
*   **FEAT (services/utilities/utilities.js & index.html):** Se implement贸 un nuevo microservicio `GPSpedia-Utilities` y la interfaz de frontend correspondiente para herramientas de administrador.
    1.  **Backend (`services/utilities/utilities.js`):** Creado el nuevo servicio con acciones protegidas (`migrateYearRanges`, `migrateTimestamps`) para migraciones de datos. (Archivo nuevo).
    2.  **Frontend (`index.html`):** A帽adido un modal "Herramientas de Desarrollador", accesible mediante un nuevo bot贸n en el men煤 lateral (visible solo para rol 'Desarrollador'). El modal incluye botones para ejecutar las migraciones y muestra la consola de depuraci贸n. (L铆neas 923-950, 2593-2625, 2772-2808).
    3.  **Infra (`api-manager.js`):** Registrado el nuevo endpoint `UTILITIES` y mapeadas las nuevas acciones. (L铆neas 14, 46-47).
*   **FEAT (services/feedback/feedback.js & index.html):** Se implement贸 un sistema de "Inbox" para la gesti贸n de feedback de usuarios.
    1.  **Backend (`services/feedback/feedback.js`):** A帽adidas nuevas acciones (`getFeedbackItems`, `replyToFeedback`, `markAsResolved`) para leer y gestionar los reportes de problemas y mensajes de contacto. (L铆neas 114-123, 342-423).
    2.  **Frontend (`index.html`):** A帽adido un modal de "Inbox", accesible mediante un nuevo bot贸n en el men煤 lateral (visible para roles 'Supervisor', 'Gefe', 'Desarrollador'). La UI permite ver, responder y resolver items de feedback. (L铆neas 907-921, 2582-2591, 2665-2770).
*   **FIX (users.html):** Solucionado un bug cr铆tico que causaba que los datos de los usuarios se mostraran como "undefined" en la tabla de gesti贸n y en el modal de edici贸n. El problema se deb铆a a un desfase de may煤sculas y min煤sculas (`camelCase` en el frontend vs. `PascalCase_With_Underscores` en el backend). Se corrigi贸 el acceso a las propiedades en todo el archivo. (L铆neas 239-241, 273-279, 318-322, 339, 349-354).
*   **UX (index.html):** Se implementaron mejoras en la interfaz de usuario del modal de detalles del veh铆culo.
    1.  **Botones de Feedback:** Se redise帽aron los botones "til" y "Reportar" para que sean m谩s compactos, mostrando un 铆cono y texto sin un contenedor de bot贸n grande. (L铆neas 1769-1782).
    2.  **Video Gu铆a:** La secci贸n "Video Gu铆a de Desarme" ahora se muestra dentro de un acorde贸n colapsable, igual que el resto de la informaci贸n suplementaria. (L铆neas 1844-1853).
*   **CHORE:** No se introdujeron regresiones en las funcionalidades estables (login, sesi贸n, carga de cat谩logo, cach茅).

**v4.0.2 (03/01/2026)**
*   **DOCS (Auditoria.txt & README.md):** Se realiz贸 una auditor铆a completa del sistema y se sincroniz贸 la documentaci贸n para reflejar el estado real del c贸digo.
    1.  **Auditor铆a (`Auditoria.txt`):** Se sobrescribi贸 el archivo con un nuevo reporte confirmando que el c贸digo fuente es funcional y no presenta los bugs cr铆ticos listados en la documentaci贸n. Se identific贸 el `README.md` como la fuente de la inconsistencia.
    2.  **Sincronizaci贸n (`README.md`):** Se actualizaron los checklists en la secci贸n "Bugs y Regresiones Cr铆ticas" para marcar como completados `[X]` los siguientes puntos, que ya estaban resueltos en el c贸digo: "L贸gica del Modal de Detalle", "Carga de Im谩genes en Modal" y "Carga de Logos en Modal". (L铆neas 231-233).

**v4.0.1 (02/01/2026)**
*   **FIX CRTICO (api-manager.js & services/catalog/catalog.js):** Solucionado un error de "Fallo de conexi贸n" (Failed to fetch) con el servicio de cat谩logo. El fix integral incluy贸:
    1.  **Backend (`services/catalog/catalog.js`):** Se cambi贸 el `MimeType` de la respuesta de `JSON` a `TEXT` para cumplir con la pol铆tica de CORS del entorno de Google Apps Script. (L铆neas 112, 124).
    2.  **Frontend (`api-manager.js`):** Se actualiz贸 la l贸gica de `routeAction` para procesar la respuesta como texto (`.text()`) y luego parsearla (`JSON.parse()`), en lugar de usar directamente `.json()`. (L铆neas 83-84).
*   **INFRA (api-manager.js):** Se ha actualizado la URL del microservicio `GPSpedia-Catalog` a la nueva versi贸n desplegada proporcionada por el usuario. (L铆nea 12).
*   **FIX (index.html):** Se corrigi贸 la l贸gica del modal de detalles (`mostrarDetalleModal`). Ahora, el corte recomendado se muestra de forma visible por defecto, mientras que los cortes adicionales se presentan en secciones desplegables (acorde贸n), cumpliendo con los requisitos de la auditor铆a. (L铆neas 1709-1811).
*   **FIX (index.html):** Solucionado un bug que imped铆a la visualizaci贸n de im谩genes suplementarias en el modal de detalles. Se a帽adi贸 la l贸gica para renderizar las im谩genes de apertura, cable de alimentaci贸n y diagramas de relay en sus correspondientes secciones. (L铆neas 1750-1768, 1829-1875).

**v4.0.0 (02/01/2026)**
*   **FIX CRTICO (services/catalog/catalog.js):** Se ha solucionado el error `cannot read properties of undefined (reading 'categoria')` que imped铆a la carga de datos del cat谩logo y de los formularios. Se implement贸 la funci贸n `mapRowToObject` que faltaba y se corrigi贸 `handleGetDropdownData` para leer din谩micamente las opciones de "Categor铆a" desde las reglas de validaci贸n de la hoja de c谩lculo.
*   **FIX CRTICO (services/users/users.js):** Se ha reparado el servicio de gesti贸n de usuarios, que fallaba en todas sus operaciones (`Failed to fetch`). El error se deb铆a a que la funci贸n `doPost` no retornaba ninguna respuesta. Se corrigi贸 la funci贸n para asegurar que todas las acciones devuelvan un resultado al frontend.
*   **REFACTOR & FEAT (index.html):** Se ha eliminado la p谩gina `info.html` y su contenido se ha integrado directamente en `index.html` como modales.
    *   Las secciones "Sobre Nosotros", "Cont谩ctanos" y "Preguntas Frecuentes" ahora se abren como pop-ups sin necesidad de recargar la p谩gina.
    *   Se ha a帽adido el nuevo contenido extendido a estas secciones.
    *   Se a帽adi贸 un peque帽o margen al CSS del pie de p谩gina para mejorar la separaci贸n visual de los enlaces.
*   **FIX (index.html):** Se ha corregido el env铆o del formulario de contacto, que fallaba por un error tipogr谩fico en el nombre de la acci贸n (`sendContacForm` -> `sendContactForm`).
*   **CHORE (project):** Se han actualizado los n煤meros de versi贸n en todos los archivos modificados a `4.0.0` (global) y a las versiones de componente correspondientes.
