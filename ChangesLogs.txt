**v4.7.2 (04/01/2026)**
*   **FIX (services/users/users.js):** Se solucion贸 una regresi贸n cr铆tica que causaba un error 'Failed to fetch' e inhabilitaba por completo el m贸dulo de gesti贸n de usuarios.
    *   **Causa Ra铆z:** La funci贸n `doPost(e)`, punto de entrada obligatorio para todas las solicitudes POST en Google Apps Script, estaba ausente en el archivo del servicio. Esto provocaba que el backend no pudiera procesar ni responder a ninguna llamada desde el frontend (`users.html`).
    *   **Soluci贸n:** Se re-implement贸 la funci贸n `doPost(e)`. Esta ahora act煤a como un enrutador que parsea la acci贸n de la solicitud y la dirige al manejador correspondiente (ej. `handleGetUsers`, `handleCreateUser`). Se asegur贸 que la respuesta sea devuelta con `MimeType.TEXT` para cumplir con la pol铆tica de CORS, restaurando la funcionalidad completa del m贸dulo.
    *   **Archivos Modificados:** `services/users/users.js`.

**v4.7.1 (04/01/2026)**
*   **DOCS (Instrucciones.txt):** Se actualizaron los estados de las tareas 14 y 22 a "[en revisi贸n]" para reflejar que se ha enviado una propuesta de soluci贸n para su validaci贸n.
    *   **Archivos Modificados:** `Instrucciones.txt`.
*   **FIX (api-manager.js):** Se solucion贸 el bug reportado en la Tarea 21. Se a帽adieron las acciones `suggestYear` y `getFeedbackItems` al `ACTION_TO_SERVICE_MAP`, restaurando la funcionalidad de sugerencia de a帽o y la carga de items en el inbox.
    *   **Archivos Modificados:** `api-manager.js`.

**v4.7.0 (04/01/2026)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `WRITE` a la nueva versi贸n desplegada proporcionada por el usuario.
    *   **Archivos Modificados:** `api-manager.js`.

**v4.6.9 (04/01/2026)**
*   **FIX (services/write/write.js):** Se solucion贸 un bug cr铆tico que imped铆a la creaci贸n de nuevos veh铆culos.
    *   **Causa Ra铆z:** Al crear un nuevo registro, una llamada `setValues` sobrescrib铆a la fila entera, eliminando la f贸rmula de la columna `ID` que se hab铆a heredado de la fila anterior. Esto resultaba en registros nuevos sin ID.
    *   **Soluci贸n:** Se refactoriz贸 la l贸gica de creaci贸n para usar llamadas `setValue` individuales para cada celda. Esto permite actualizar los campos necesarios sin sobrescribir la columna `ID`, preservando as铆 la f贸rmula `autoincremental` y asegurando la integridad de los datos.
    *   **Archivos Modificados:** `services/write/write.js`.

**v4.6.8 (04/01/2026)**
*   **SECURITY & VERSIONING (services/users/users.js & users.html):** Se complet贸 la implementaci贸n y verificaci贸n del parche de seguridad para la gesti贸n de usuarios, asegurando la consistencia entre el frontend y el backend y actualizando las versiones de los componentes.
    *   **Backend (`services/users/users.js`):** Se verific贸 que el servicio (v2.3.0) utiliza correctamente el `sessionToken` para una autorizaci贸n segura basada en servidor.
    *   **Frontend (`users.html`):** Se aplic贸 el parche de seguridad y se actualiz贸 la versi贸n del componente a `3.7.0`. El frontend ahora env铆a el `sessionToken` en lugar de roles en las solicitudes CRUD.
    *   **Archivos Modificados:** `users.html`.
*   **HOTFIX (api-manager.js):** Se corrigi贸 una URL de endpoint incorrecta para el servicio `AUTH` que fue introducida en un commit anterior. La URL ha sido restaurada a la versi贸n correcta y funcional, previniendo una regresi贸n cr铆tica en la autenticaci贸n.
    *   **Archivos Modificados:** `api-manager.js`.
*   **DOCS (Instrucciones.txt):** Se documentaron tres bugs cr铆ticos reportados por el usuario como nuevas tareas pendientes (21, 22, 23) y se elimin贸 contenido duplicado para mantener la claridad del documento.
    *   **Archivos Modificados:** `Instrucciones.txt`.

**v4.6.7 (04/01/2026)**
*   **SECURITY (services/users/users.js & users.html):** Se solucion贸 una vulnerabilidad cr铆tica de seguridad que permit铆a la escalada de privilegios en la gesti贸n de usuarios.
    *   **Causa Ra铆z:** El backend (`services/users/users.js`) confiaba en un par谩metro de rol (`creatorRole`, `updaterRole`, `deleterRole`) enviado desde el frontend (`users.html`) para autorizar operaciones de Crear, Actualizar y Eliminar usuarios. Un usuario malintencionado podr铆a haber manipulado este par谩metro en el cliente para obtener permisos de administrador.
    *   **Soluci贸n (Full-Stack):**
        1.  **Backend:** Se refactoriz贸 el servicio de usuarios para que ignore los roles enviados por el cliente. Se implement贸 una nueva funci贸n `getVerifiedRole(sessionToken)` que valida el token de sesi贸n contra la base de datos (`ActiveSessions` y `Users`) para obtener el rol real del usuario solicitante de forma segura en el servidor. Todas las operaciones de gesti贸n de usuarios ahora usan este rol verificado para la autorizaci贸n.
        2.  **Frontend:** Se modific贸 `users.html` para que env铆e el `sessionToken` del usuario actual en lugar de su rol en todas las solicitudes de gesti贸n de usuarios, aline谩ndose con los nuevos requisitos del backend.
    *   **Archivos Modificados:** `services/users/users.js`, `users.html`.

**v4.6.6 (04/01/2026)**
*   **INFRA (api-manager.js):** Se actualizaron las URLs de los microservicios `AUTH` y `FEEDBACK` a las nuevas versiones desplegadas proporcionadas por el usuario. Esto asegura que el frontend se comunique con las implementaciones m谩s recientes de estos servicios.
    *   **Archivos Modificados:** `api-manager.js`: L铆neas 11, 15.

**v4.6.5 (04/01/2026)**
*   **FIX (services/auth/auth.js):** Se corrigi贸 un bug cr铆tico en la l贸gica de autenticaci贸n que imped铆a a los usuarios iniciar sesi贸n si sus contrase帽as conten铆an caracteres especiales o una combinaci贸n de may煤sculas y min煤sculas.
    *   **Causa Ra铆z:** El proceso de comparaci贸n de contrase帽as convert铆a tanto la contrase帽a almacenada como la ingresada a min煤sculas (`.toLowerCase()`) antes de verificarlas. Esto causaba que cualquier contrase帽a con may煤sculas (ej. "MiClave123") fuera incorrectamente rechazada.
    *   **Soluci贸n:** Se eliminaron las llamadas a `.toLowerCase()` de la l贸gica de comparaci贸n. La verificaci贸n ahora es sensible a may煤sculas y min煤sculas (`case-sensitive`), asegurando que las contrase帽as se validen de forma exacta y permitiendo el uso de caracteres variados.
    *   **Archivos Modificados:** `services/auth/auth.js`: L铆nea 138.

**v4.6.4 (04/01/2026)**
*   **FIX (services/feedback/feedback.js):** Se solucion贸 un bug cr铆tico que imped铆a el funcionamiento de la bandeja de entrada (Inbox).
    *
**Causa Ra铆z:** El servicio devolv铆a una respuesta con `MimeType.JSON`, lo cual es incompatible con la pol铆tica de CORS de Google Apps Script y provocaba un error `Failed to fetch` en el frontend.
    *   **Soluci贸n:** Se cambi贸 el `MimeType` de la respuesta a `ContentService.MimeType.TEXT` en la funci贸n `doPost`, restaurando la comunicaci贸n entre el frontend y el servicio de feedback.
    *   **Archivos Modificados:** `services/feedback/feedback.js`: L铆neas 128, 132.

**v4.6.3 (04/01/2026)**
*   **FIX CRTICO (service-worker.js):** Se solucion贸 la causa ra铆z de m煤ltiples regresiones visuales y funcionales al invalidar la cach茅 del PWA.
    *   **Causa Ra铆z:** Cambios previos en el frontend no se reflejaban porque el service worker serv铆a una versi贸n obsoleta de la aplicaci贸n desde la cach茅.
    *   **Soluci贸n:** Se increment贸 la `CACHE_NAME` de `v5` a `v6`, forzando a todos los clientes a descargar la 煤ltima versi贸n de la aplicaci贸n.
*   **FEAT & UX (index.html):** Se implementaron las mejoras de UI/UX solicitadas, corrigiendo la visualizaci贸n del carrusel de motocicletas y optimizando el modal de detalles.
    *   **Carrusel de Motocicletas:** Se robusteci贸 la l贸gica de filtrado en `mostrarCategorias` para reconocer tanto "Motocicletas" como "motos" como categor铆as v谩lidas, asegurando que el carrusel se renderice incluso con datos inconsistentes.
    *   **Modal de Detalles (Logo):** El logo de la marca ahora se muestra correctamente a la izquierda del t铆tulo del modelo y se ha a帽adido `flex-shrink: 0` para prevenir que se deforme con t铆tulos largos.
    *   **Modal de Detalles (Econom铆a de Espacio):** Se redujeron los m谩rgenes y paddings en `#detalleCompleto`, `h4`, y `p` para un dise帽o m谩s compacto.
*   **REFACTOR (index.html):** Se refactoriz贸 el CSS y el JavaScript del modal de detalles para utilizar clases espec铆ficas para las im谩genes, como fue solicitado en la revisi贸n de c贸digo.
    *   Se a帽adieron las clases `.img-vehiculo-modal` y `.img-corte` al CSS.
    *   La funci贸n `mostrarDetalleModal` fue actualizada para aplicar estas nuevas clases a las im谩genes correspondientes, mejorando la mantenibilidad y especificidad de los estilos.

**v4.6.2 (03/01/2026)**
*   **DOCS (Instrucciones.txt):** Se ha reestructurado completamente el archivo `Instrucciones.txt` para agrupar todas las tareas pendientes en m贸dulos funcionales y auditables.
    *   **Migraci贸n de Tareas:** Todos los hallazgos pendientes de `Auditoria.txt` y las tareas del `Instrucciones.txt` anterior han sido migradas a esta nueva estructura.
    *   **Nuevo Formato:** Cada tarea ahora sigue un formato estricto que incluye descripci贸n, impacto esperado, riesgos conocidos, dependencias y un estado `PENDIENTE`.
    *   **Archivos Modificados:** `Instrucciones.txt`.

**v4.6.1 (02/01/2026)**
*   **FIX (services/write/write.js):** Se agrego una "solucion" a un defecto cr铆tico en la creaci贸n de nuevos veh铆culos (Stage 2). Las nuevas filas deberian de heredan correctamente todas las validaciones de datos, f贸rmulas (especialmente la de ID) y formatos de la fila.
    *   **Causa Ra铆z:** El m茅todo anterior de creaci贸n de filas no copiaba la estructura completa de la fila anterior, lo que resultaba en la p茅rdida de validaciones y f贸rmulas esenciales.
    *   **Soluci贸n:** Se refactoriz贸 la l贸gica de creaci贸n de nuevas filas en `handleAddOrUpdateCut`. El nuevo m茅todo utiliza `previousRowRange.copyTo(newRowRange)` para duplicar la fila anterior en su totalidad, y luego ejecuta `newRowRange.clearContent()` para vaciar los valores de las celdas sin eliminar las f贸rmulas y validaciones subyacentes.
*   **CHORE (versioning):** Se actualiz贸 la versi贸n del componente a `2.3.0`.
    *   **Archivos Modificados:** `services/write/write.js`. **Nota para el auditor:** este ultimo fix causo una regresion grave que deshabilitaba la captura de validacion de datos de la sheet en el formulario de add_cortes.html, se recuper贸 manualmente el repositorio a su estado anterior (con el bug de la renderizacion de las imagenes en catalogo)
considerar esta ultima version como fallida y no se debe trabajar desde esta version (4.6.1) un usar el estado del la version anterior (4.5.9)


**v4.5.9 (31-12-2025)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Write` a la nueva versi贸n desplegada proporcionada por el usuario, asegurando que el frontend apunte a el endpoint m谩s reciente y corregido para todas las operaciones de escritura.
    *   **Archivos Modificados:** `api-manager.js`.
*   **CHORE (versioning):** Se actualiz贸 la versi贸n del componente `api-manager.js` a `3.9.2`.

**v4.5.8 (02/01/2026)**
*   **FIX (services/write/write.js):** Se corrigi贸 la l贸gica de backend para el registro de nuevos cortes (Etapa 2), asegurando que todos los datos se guarden correctamente.
    *   **Soluci贸n:** Se refactoriz贸 `handleAddOrUpdateCut` para procesar y guardar correctamente: a帽o (individual o rango), tipo de corte, ubicaci贸n, color de cable, configuraci贸n de relay, imagen del corte (subida a Drive) y el timestamp en formato `dd/mm/aaaa`. Tambi茅n se asegur贸 que la f贸rmula del ID se copie al crear una nueva fila.
    *   **Archivos Modificados:** `services/write/write.js`.
*   **FIX (add_cortes.html):** Se cambi贸 el campo de a帽o a `type="text"` para permitir el ingreso de rangos.
    *   **Archivos Modificados:** `add_cortes.html`.
*   **CHORE (versioning):** Se actualizaron las versiones de los componentes.
    *   `services/write/write.js`: `2.2.1`
    *   `add_cortes.html`: `2.1.8`

**v4.5.7 (02-01-2026)**
*   **FIX (api-manager.js):** Se corrigi贸 el error "Acci贸n no definida: addOrUpdateCut" al agregar las acciones `addOrUpdateCut` y `addSupplementaryInfo` al mapa de enrutamiento (`ACTION_TO_SERVICE_MAP`), dirigi茅ndolas correctamente al servicio `WRITE`.
    *   **Archivos Modificados:** `api-manager.js`.
*   **STYLE (add_cortes.html):** Se mejor贸 el estilo de los nuevos campos de subida de archivos y las vistas previas de im谩genes para que sean m谩s coherentes con el dise帽o general de la aplicaci贸n.
    *   **Archivos Modificados:** `add_cortes.html`.
*   **CHORE (versioning):** Se actualizaron las versiones de los componentes.
    *   `api-manager.js`: `3.9.1`
    *   `add_cortes.html`: `2.1.7`

**v4.5.6 (02-01-2026)**
*   **REFACTOR (add_cortes.html):** Se refactoriz贸 por completo el formulario de la Etapa 2 para reemplazar los campos de URL de imagen por un sistema de subida de archivos con vista previa, cumpliendo con los requisitos estrictos del `README.md`.
    *   **Causa Ra铆z:** La implementaci贸n anterior solicitaba URLs de im谩genes, lo cual era incorrecto y en contra de las especificaciones.
    *   **Soluci贸n:**
        *   Se reemplazaron los `input[type="text"]` para im谩genes por `input[type="file"]`.
        *   Se a帽adi贸 l贸gica JavaScript con `FileReader` para mostrar una vista previa inmediata de la imagen seleccionada por el usuario.
        *   Se actualiz贸 la l贸gica de env铆o del formulario para convertir las im谩genes a formato `base64` antes de enviarlas al backend.
        *   El campo de imagen del corte (`imgCorte1`) ahora es `required`.
        *   El campo de "Configuraci贸n de Relay" ahora tiene "Corte a ignici贸n" como valor por defecto.
    *   **Archivos Modificados:** `add_cortes.html`.
*   **CHORE (versioning):** Se actualiz贸 la versi贸n del componente a `2.1.6`.
    *   **Archivos Modificados:** `add_cortes.html`.

**v4.5.5 (02-01-2026)**
*   **FIX (add_cortes.html):** Se corrigi贸 la l贸gica de navegaci贸n de los botones en el paso de "Coincidencias". El bot贸n "Agregar informaci贸n adicional" ahora navega correctamente a la Etapa 3 del formulario.
    *   **Archivos Modificados:** `add_cortes.html`.
*   **REFACTOR (add_cortes.html):** Se refactoriz贸 el formulario de la Etapa 2 ("Agregar Informaci贸n del Corte") para cumplir con las especificaciones del `README.md`.
    *   **Nueva L贸gica:** El campo "Imagen del Veh铆culo" ahora solo se muestra si se est谩 creando un veh铆culo completamente nuevo.
    *   **Nuevos Campos:** Se a帽adi贸 el campo "Configuraci贸n de Relay" al formulario de la Etapa 2.
    *   **Archivos Modificados:** `add_cortes.html`.
*   **CHORE (versioning):** Se actualiz贸 la versi贸n del componente a `2.1.5`.
    *   **Archivos Modificados:** `add_cortes.html`.

**v4.5.4 (02-01-2026)**
*   **REFACTOR (add_cortes.html):** Se refactoriz贸 por completo la funcionalidad del lightbox para corregir un bug cr铆tico de navegaci贸n externa.
    *   **Causa Ra铆z:** El uso de etiquetas `<a>` con `href` a Google Drive forzaba la navegaci贸n a una nueva pesta帽a y requer铆a autenticaci贸n. La librer铆a `SimpleLightbox` era inadecuada para este flujo.
    *   **Soluci贸n Arquitect贸nica:** Se elimin贸 `SimpleLightbox` y se reemplazaron las etiquetas `<a>` por `<img>` con `onclick`. Se implement贸 un lightbox interno basado en la arquitectura de `index.html`, que muestra la imagen en un `<div>` modal sin navegar fuera de la p谩gina.
    *   **Archivos Modificados:** `add_cortes.html`.
*   **FIX (add_cortes.html):** Se implement贸 un manejo de errores robusto para la funci贸n `handleSuggestion`.
    *   **Soluci贸n:** Se envolvi贸 la llamada a `routeAction('getSuggestion', ...)` en un bloque `try...catch` para que cualquier fallo en esta API no implementada sea capturado silenciosamente en la consola, sin bloquear la renderizaci贸n de la UI.
    *   **Archivos Modificados:** `add_cortes.html`.
*   **CHORE (versioning):** Se actualiz贸 la versi贸n del componente a `2.1.4`.
    *   **Archivos Modificados:** `add_cortes.html`.

**v4.5.3 (02-01-2026)**
*   **fix(render):** Se resolvi贸 un error de JavaScript que bloqueaba la ejecuci贸n y preven铆a que la UI de resultados de b煤squeda (`#stage-1-5`) se renderizara.
    *   **Causa Ra铆z:** La funci贸n `handleSuggestion` intentaba llamar a la acci贸n `getSuggestion`, la cual no est谩 definida en el `api-manager.js`, causando un error fatal que deten铆a toda la ejecuci贸n de scripts en la p谩gina.
    *   **Soluci贸n:** Se coment贸 la llamada a `routeAction` dentro de `handleSuggestion`, convirtiendo la funci贸n en un stub seguro. Esto previene el error, permite que el resto del c贸digo se ejecute y desbloquea la renderizaci贸n de la UI.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 207-215.
*   **CHORE (versioning):** Se actualiz贸 la versi贸n del componente a `2.1.3` para reflejar el cambio.
    *   **Archivos Modificados:** `add_cortes.html`: L铆nea 1.

**v4.5.2 (02-01-2026)**
*   **FIX (add_cortes.html):** Se implement贸 un manejo de errores robusto en la funci贸n `handleSuggestion` para prevenir que fallos en la API de sugerencias detengan la ejecuci贸n del JavaScript y bloqueen la renderizaci贸n de la UI.
    *   **Causa Ra铆z:** Una llamada a la acci贸n `getSuggestion` fallaba en el entorno de pruebas, lanzando un error no capturado que imped铆a la ejecuci贸n de la l贸gica subsiguiente para mostrar los resultados de la b煤squeda.
    *   **Soluci贸n:** Se envolvi贸 la llamada a `routeAction('getSuggestion', ...)` dentro de un bloque `try...catch`. Ahora, si la llamada falla, el error se registra en la consola para depuraci贸n, pero no se relanza, permitiendo que el resto del script contin煤e su ejecuci贸n sin interrupciones. Esto resuelve el bug que imped铆a mostrar los resultados y, por consiguiente, arregla el problema del lightbox.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 207-213.
*   **CHORE (versioning):** Se actualiz贸 la versi贸n del componente a `2.1.2` para reflejar el cambio.
    *   **Archivos Modificados:** `add_cortes.html`: L铆nea 1.

**v4.5.1 (1-01-2026)**
*   **UX (add_cortes.html):** Se implementaron m煤ltiples mejoras de compactaci贸n en la UI para reducir el espacio vertical y horizontal, siguiendo los requisitos del usuario.
    *   Se redujeron los m谩rgenes y paddings en los contenedores principales, secciones y tarjetas.
    *   Se disminuy贸 el tama帽o de la fuente para los t铆tulos `h2`, `h3` y `h4`.
    *   Se ajust贸 el ancho de las tarjetas de resultados para que sean m谩s compactas.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 23-28, 38-41 (CSS).
*   **FIX (add_cortes.html):** Se solucion贸 un bug cr铆tico que imped铆a el funcionamiento de la galer铆a de im谩genes `SimpleLightbox` en los resultados de b煤squeda.
    *   **Causa Ra铆z:** La biblioteca se inicializaba una sola vez al cargar la p谩gina. No se volv铆a a inicializar despu茅s de que el contenido de los resultados de b煤squeda se a帽adiera din谩micamente al DOM, por lo que los nuevos elementos no ten铆an los listeners de eventos necesarios.
    *   **Soluci贸n:** Se movi贸 la inicializaci贸n de `SimpleLightbox` (`new SimpleLightbox(...)`) dentro de la funci贸n `mostrarResultadosBusqueda`, asegurando que se ejecute cada vez que se generan nuevos resultados. Se a帽adi贸 una l贸gica para destruir cualquier instancia previa (`if (lightbox) lightbox.destroy();`) para evitar fugas de memoria.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 203-207, 303-308.
*   **CHORE (.gitignore):** Se cre贸 un archivo `.gitignore` para excluir los archivos de log del servidor (`*.log`) y otros artefactos de desarrollo del control de versiones.
    *   **Archivos Modificados:** `.gitignore` (nuevo archivo).
*   **CHORE (versioning):** Se actualizaron las versiones de los componentes en los archivos modificados para reflejar los cambios recientes.
    *   `index.html`: Versi贸n de componente actualizada a `2.4.1`.
    *   `add_cortes.html`: Versi贸n de componente actualizada a `2.1.0`.
    *   **Archivos Modificados:** `index.html`: L铆nea 2; `add_cortes.html`: L铆nea 2.

**v4.5.0 (1-01-2026)**
*   **HOTFIX & REFACTOR (add_cortes.html):** Se implement贸 una correcci贸n cr铆tica y final al flujo de trabajo de anti-duplicados para alinearlo con los requisitos exactos del usuario, eliminando la implementaci贸n incorrecta de un modal.
    *   **Flujo de Trabajo Inline:** Se elimin贸 por completo el modal de elecci贸n. En su lugar, cuando se encuentra una coincidencia de veh铆culo, la interfaz de usuario ahora muestra los resultados y presenta **botones de acci贸n inline** directamente en la p谩gina, como se solicit贸.
    *   **Nuevos Botones de Acci贸n:** Los botones ahora son: "S铆, es el mismo corte (cancelar)", "Es uno nuevo", y "Agregar informaci贸n adicional", cada uno con la funcionalidad correcta (cancelar, ir al Paso 2, o ir al Paso 3).
    *   **Tarjetas Informativas:** Las tarjetas de resultados ya no son clickeables, sirviendo 煤nicamente como un display informativo para que el usuario tome una decisi贸n usando los botones. Se elimin贸 el estilo `cursor: pointer` para evitar confusiones.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 48-61 (eliminaci贸n de CSS), 63-75 (eliminaci贸n de HTML), 86-97 (HTML), 281-291 (JS), 354-386 (eliminaci贸n de JS).
*   **DOCS (README.md):** Se actualiz贸 la documentaci贸n para describir con precisi贸n el flujo de trabajo final y correcto, detallando el uso de los botones inline y las tarjetas informativas no interactivas.
    *   **Archivos Modificados:** `README.md`: L铆neas 131-140.

**v4.4.9 (31-12-2025)**
*   **HOTFIX (add_cortes.html):** Se implement贸 una correcci贸n cr铆tica al flujo de trabajo de anti-duplicados para alinearlo con los requisitos del usuario. La navegaci贸n ya no es directa, sino que presenta al usuario opciones claras.
    *   **Modal de Elecci贸n:** Al hacer clic en una tarjeta de veh铆culo coincidente, ahora se muestra un modal que permite al usuario elegir entre "Agregar Nuevo Corte" (ir al Paso 2), "Agregar Informaci贸n Suplementaria" (ir al Paso 3), o "Cancelar". Esto evita la navegaci贸n no deseada y asegura que el usuario tome una decisi贸n informada.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 55-68 (CSS y HTML del modal), 304 (JS), 375-420 (JS).
*   **DOCS (README.md):** Se actualiz贸 la documentaci贸n para describir con precisi贸n el nuevo flujo de navegaci贸n basado en el modal de elecci贸n.
    *   **Archivos Modificados:** `README.md`: L铆neas 131-140.

**v4.4.8 (31-12-2025)**
*   **HOTFIX (add_cortes.html):** Se implementaron correcciones cr铆ticas en la p谩gina de adici贸n de cortes, basadas en el feedback del usuario para resolver una mala interpretaci贸n de los requisitos de la funci贸n anti-duplicados y un bug severo en la visualizaci贸n de im谩genes.
    *   **Navegaci贸n Intuitiva por Tarjeta:** Se elimin贸 el bot贸n "Seleccionar este Veh铆culo", que era redundante. En su lugar, toda la tarjeta de resultados de b煤squeda es ahora clickeable, lo cual alinea el comportamiento con el objetivo real: permitir al usuario seleccionar un veh铆culo existente para a帽adirle nuevos cortes y evitar duplicados.
    *   **Correcci贸n de Lightbox:** Se solucion贸 un bug cr铆tico que requer铆a iniciar sesi贸n en Google para ver las im谩genes de los cortes en el lightbox. Se modific贸 la l贸gica para que el `href` del enlace del lightbox tambi茅n utilice la funci贸n `convertirAGoogleThumbnail`, asegurando que se genere una URL p煤blica y accesible para la imagen en alta resoluci贸n.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 285-300, 318.
*   **DOCS (README.md):** Se actualiz贸 la documentaci贸n para reflejar con precisi贸n el flujo de trabajo anti-duplicados corregido, explicando que el objetivo es mostrar al usuario los cortes existentes y que la navegaci贸n se realiza haciendo clic en la tarjeta del veh铆culo.
    *   **Archivos Modificados:** `README.md`: L铆neas 131-144.

**v4.4.7 (31-12-2025)**
*   **FEAT & UX (add_cortes.html):** Se implement贸 una segunda ronda de mejoras significativas en la UI/UX de los resultados de b煤squeda de veh铆culos, enfocadas en la usabilidad y la navegaci贸n.
    *   **Selecci贸n Expl铆cita de Veh铆culo:** Se a帽adi贸 un bot贸n "Seleccionar este Veh铆culo" a cada tarjeta de resultados. Esta es ahora la 煤nica acci贸n que permite avanzar al siguiente paso, eliminando la navegaci贸n accidental que ocurr铆a al hacer clic en las im谩genes o en el texto de la tarjeta.
    *   **Gesti贸n del Historial del Navegador:** Se integr贸 la API de Historial del navegador (`history.pushState`, `window.onpopstate`) para crear una experiencia de formulario multi-paso fluida. El bot贸n "Atr谩s" del navegador ahora navega correctamente del paso de resultados al paso de b煤squeda, en lugar de sacar al usuario de la p谩gina.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 205-224 (JS), 241-259 (JS), 304 (HTML).
*   **DOCS (README.md):** Se actualiz贸 la documentaci贸n t茅cnica para reflejar estas nuevas mejoras, detallando el flujo de selecci贸n expl铆cito y la gesti贸n del historial del navegador.
    *   **Archivos Modificados:** `README.md`: L铆neas 131-149.

**v4.4.6 (31-12-2025)**
*   **FEAT & UX (add_cortes.html):** Se implementaron mejoras significativas en la visualizaci贸n de las tarjetas de coincidencias de veh铆culos para proporcionar una experiencia de usuario m谩s rica e informativa.
    *   **Im谩genes Detalladas y Lightbox:** Se integr贸 la biblioteca `simple-lightbox-gallery` para permitir que las im谩genes de los cortes se abran en una galer铆a a pantalla completa con capacidad de zoom. La imagen del veh铆culo se muestra en un tama帽o reducido (100px), mientras que las im谩genes de los cortes son m谩s grandes (180x120px) para facilitar su visualizaci贸n.
    *   **Renderizado de Im谩genes de Drive:** Se a帽adi贸 la funci贸n `convertirAGoogleThumbnail` para procesar correctamente las URLs de Google Drive y asegurar que todas las im谩genes se rendericen correctamente.
    *   **Informaci贸n Adicional:** A la derecha de cada imagen de corte, ahora se muestran los detalles de "Ubicaci贸n" y "Color de Cable", proporcionando informaci贸n crucial de un vistazo.
    *   **Archivos Modificados:** `add_cortes.html`: L铆neas 7 (CDN CSS), 35-43 (CSS), 200-212 (JS), 261-344 (JS), 438 (CDN JS).

**v4.4.5 (31-12-2025)**
*   **INFRA (api-manager.js):** Se actualizaron las URLs de los microservicios `GPSpedia-Catalog` y `GPSpedia-Write` a las nuevas versiones desplegadas, asegurando que el frontend apunte a los endpoints m谩s recientes.
    *   **Archivos Modificados:** `api-manager.js`: L铆neas 11-12.

**v4.4.4 (31-12-2025)**
*   **FEAT & REFACTOR (Full-Stack):** Se implement贸 un flujo de trabajo de adici贸n de cortes completamente nuevo y mejorado, abarcando desde la b煤squeda inteligente hasta la gesti贸n de archivos y la documentaci贸n.
    *   **Frontend - Visualizaci贸n de Coincidencias (`add_cortes.html`):**
        *   Se redise帽贸 la secci贸n de resultados de b煤squeda para mostrar tarjetas de coincidencias detalladas.
        *   Cada tarjeta ahora incluye la imagen del veh铆culo (150px), informaci贸n clave y miniaturas de los cortes ya existentes, proporcionando al usuario un contexto visual completo para evitar duplicados.
        *   **Archivos Modificados:** `add_cortes.html`: L铆neas 30-38 (CSS), 205-247 (JavaScript).
    *   **Backend - Gesti贸n de Archivos (`services/write/write.js`):**
        *   Se refactoriz贸 por completo la l贸gica de subida de im谩genes.
        *   El sistema ahora crea una estructura de carpetas jer谩rquica en Google Drive (`Categoria/Marca/Modelo/A帽o`).
        *   Las im谩genes se renombran autom谩ticamente a un formato estandarizado (`Marca_Modelo_TipoEncendido_A帽o_Informacion.jpg`), mejorando dr谩sticamente la organizaci贸n de los archivos.
        *   **Archivos Modificados:** `services/write/write.js`: L铆neas 46-50 (helper), 211-255, 404-416 (l贸gica de nombrado).
    *   **Full-Stack - Sugerencia "Quiz谩s quisiste decir...":**
        *   **Backend (`services/catalog/catalog.js`):** Se cre贸 una nueva acci贸n `getSuggestion` que utiliza el algoritmo de distancia de Levenshtein para encontrar y sugerir la correcci贸n m谩s probable para errores tipogr谩ficos en los campos `marca` y `modelo`.
        *   **Frontend (`add_cortes.html`):** Se a帽adieron listeners de eventos `onblur` a los campos de marca y modelo. Cuando el usuario termina de escribir, se llama al backend para obtener una sugerencia, que se muestra discretamente debajo del campo.
        *   **Archivos Modificados:** `services/catalog/catalog.js`: L铆neas 107-110 (router), 369-453 (l贸gica); `add_cortes.html`: L铆neas 39-42 (CSS), 57-67 (HTML), 171-199 (JavaScript).
    *   **DOCS (README.md):**
        *   Se actualiz贸 la documentaci贸n t茅cnica para reflejar con m谩ximo detalle el funcionamiento de estas nuevas caracter铆sticas, incluyendo la l贸gica de b煤squeda flexible, el asistente de sugerencias y el nuevo sistema de gesti贸n de archivos.
        *   **Archivos Modificados:** `README.md`: L铆neas 112-149.

**v4.4.3 (31-12-2025)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Catalog` a la nueva versi贸n desplegada, asegurando que el frontend apunte al endpoint m谩s reciente tras la implementaci贸n de la b煤squeda flexible.
    *   **Archivos Modificados:** `api-manager.js`: L铆nea 11.

**v4.4.2 (31-12-2025)**
*   **FIX & FEAT (services/catalog/catalog.js):** Se solucion贸 el error "Par谩metros de b煤squeda incompletos" y se implement贸 una l贸gica de b煤squeda flexible.
    *   **Correcci贸n:** Se aline贸 el par谩metro `anoDesde` en la funci贸n `handleCheckVehicle` con los datos enviados desde el frontend, eliminando el error.
    *   **Nueva Funcionalidad:** Se refactoriz贸 la b煤squeda para que `marca` y `modelo` utilicen coincidencias parciales e insensibles a may煤sculas/min煤sculas, mientras que `a帽o` y `tipo de encendido` siguen siendo exactos. La funci贸n ahora devuelve una lista de todas las coincidencias.
    *   **Archivos Modificados:** `services/catalog/catalog.js`: L铆neas 330-366.

**v4.4.1 (31-12-2025)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Catalog` a la nueva versi贸n desplegada, asegurando que el frontend apunte al endpoint m谩s reciente tras la correcci贸n del bug de carga de formularios.
    *   **Archivos Modificados:** `api-manager.js`: L铆nea 11.

**v4.4.0 (31-12-2025)**
*   **HOTFIX (services/catalog/catalog.js):** Se solucion贸 un error cr铆tico de `TypeError: Cannot read properties of undefined (reading 'categoria')` que imped铆a la carga de los datos del formulario.
    *   **Causa Ra铆z:** Exist铆a una discrepancia en la estructura del JSON esperado por el frontend y el JSON devuelto por el backend. La funci贸n `handleGetDropdownData` devolv铆a los datos bajo una clave `data` con nombres de campo en plural (ej. `categorias`), mientras que el frontend esperaba una clave `dropdowns` con nombres en singular (ej. `categoria`).
    *   **Soluci贸n:** Se modific贸 la estructura del objeto de respuesta en `handleGetDropdownData` para que coincida exactamente con la esperada por el frontend, resolviendo el `TypeError`.
    *   **Archivos Modificados:** `services/catalog/catalog.js`: L铆neas 286-298.

**v4.3.9 (31-12-2025)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Catalog` a la nueva versi贸n desplegada, asegurando que el frontend se comunique con el endpoint m谩s reciente y corregido.
    *   **Archivos Modificados:** `api-manager.js`: L铆nea 11.

**v4.3.8 (31-12-2025)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Write` a la nueva versi贸n desplegada, asegurando que el frontend se comunique con el endpoint m谩s reciente para las operaciones de escritura.
    *   **Archivos Modificados:** `api-manager.js`: L铆nea 12.

**v4.3.7 (31-12-2025)**
*   **HOTFIX (services/catalog/catalog.js):** Se solucion贸 un error cr铆tico que imped铆a la carga de los datos del formulario en `add_cortes.html`.
    *   **Causa Ra铆z:** Se produc铆a un error de `TypeError: ... .getValues is not a function` en la funci贸n `handleGetDropdownData`. El c贸digo intentaba llamar a `.getValues()` sobre un array simple devuelto por `getCriteriaValues()`, lo cual es incorrecto.
    *   **Soluci贸n:** Se elimin贸 la llamada err贸nea a `.getValues()`, permitiendo que el array de valores de la lista de validaci贸n de datos se procese correctamente.
    *   **Archivos Modificados:** `services/catalog/catalog.js`: L铆nea 290.

**v4.3.6 (31-12-2025)**
*   **HOTFIX (index.html):** Se solucion贸 la causa ra铆z de la regresi贸n cr铆tica que imped铆a la carga del cat谩logo.
    *   **Causa Ra铆z:** Un error de `ReferenceError: crearCarrusel is not defined` deten铆a la ejecuci贸n de todo el JavaScript. La funci贸n `crearCarrusel` fue definida dentro del scope de `mostrarCategorias`, pero era llamada por `mostrarUltimosAgregados`, que se ejecutaba antes.
    *   **Soluci贸n:** Se movi贸 la definici贸n de la funci贸n `crearCarrusel` al 谩mbito global del script. Esto asegura que la funci贸n est茅 definida antes de cualquier llamada, resolviendo el error de referencia y permitiendo que la aplicaci贸n se inicialice correctamente.
    *   **Archivos Modificados:** `index.html`: L铆neas 1699-1773, 2635-2709.

**v4.3.5 (31-12-2025)**
*   **HOTFIX (service-worker.js):** Se solucion贸 una regresi贸n cr铆tica introducida en la v4.3.4 que imped铆a la carga del cat谩logo y causaba la p茅rdida de sesi贸n en cada recarga.
    *   **Causa Ra铆z:** El commit anterior introdujo cambios significativos en el frontend (`index.html`) pero no increment贸 la versi贸n de la cach茅 en el service worker. Esto provoc贸 que los clientes siguieran usando una versi贸n de JavaScript en cach茅, incompatible con la nueva l贸gica, causando un error fatal durante la inicializaci贸n.
    *   **Soluci贸n:** Se increment贸 la versi贸n de la cach茅 de `v4` a `v5` en `service-worker.js`. Esto invalida la cach茅 obsoleta y fuerza a todos los clientes a descargar la 煤ltima versi贸n de la aplicaci贸n, restaurando la funcionalidad completa.
    *   **Archivos Modificados:** `service-worker.js`: L铆nea 1.

**v4.3.4 (31-12-2025)**
*   **UX (index.html):** Se implementaron m煤ltiples mejoras en la interfaz de usuario para aumentar la compacidad y corregir funcionalidades.

    *   **Logo en Modal:** Se corrigi贸 la l贸gica de `mostrarDetalleModal` para asegurar que el logo de la marca siempre se cargue y muestre.

    *   **Carruseles:** Se refactoriz贸 la l贸gica de navegaci贸n, generaliz谩ndola en la funci贸n `crearCarrusel` para que todos los carruseles (ltimos Agregados, Categor铆as, Marcas) tengan botones de navegaci贸n funcionales.

    *  **Botones de Feedback:** Se redujo el tama帽o de los botones "til" y "Reportar" en un 10% mediante CSS.

NOTA SIBRE ESTA ENTEADA, algunos cambios solicitados no se realizaron y se ignoraron instrucciones.
    *   **Archivos Modificados:** `index.html`: L铆neas 814-855, 1282-1288, 1983-2225, 2561-2835, 3331-3351.

**v4.3.3 (31-12-2025)**
*   **REFACTOR & FIX (index.html):** Se ha redise帽ado por completo el modal de detalles del veh铆culo para alinearlo con la nueva especificaci贸n de 12 puntos y corregir m煤ltiples regresiones cr铆ticas.
    *   **Especificaci贸n del Modal:**
        1.  **Restaurada Navegaci贸n Principal:** Se corrigi贸 la funci贸n `mostrarCategorias` para renderizar correctamente los carruseles de Categor铆as y Marcas.
        2.  **Reparado Video en Tutoriales:** Se corrigi贸 la funci贸n `mostrarDetalleTutorial` para usar `item.Video` en lugar de `item.videoGuia`, restaurando la visualizaci贸n de videos.
        3.  **Reparada Imagen en Relay:** Se corrigi贸 la funci贸n `mostrarDetalleRelay` para usar la variable de contenedor correcta, restaurando la visualizaci贸n de im谩genes.
        4.  **Nuevo Encabezado Detallado:** El encabezado del modal ahora muestra el T铆tulo, Logo de Marca, Versi贸n, Rango de A帽os y Categor铆a en el formato especificado.
        5.  **Orden de Contenido:** El cuerpo del modal ahora sigue el orden estricto: Corte Recomendado, Otros Cortes (acorde贸n), Apertura (acorde贸n), Alimentaci贸n (acorde贸n) y Video Gu铆a (acorde贸n).
        6.  **Corte Recomendado Fijo:** La secci贸n del corte con m谩s "likes" siempre est谩 visible y expandida.
        7.  **Estilo de Imagen de Veh铆culo:** La imagen principal del veh铆culo ahora tiene una altura m谩xima de 150px y un efecto `drop-shadow`.
        8.  **Estilo de Imagen de Corte Recomendado:** La imagen dentro del corte recomendado ahora ocupa el 100% del ancho del panel.
        9.  **Posici贸n del Link de Relay:** El enlace "Ver Configuraci贸n de Relay" ahora aparece correctamente *antes* del nombre del colaborador.
        10. **Alineaci贸n del Colaborador:** El nombre del colaborador ahora se alinea a la izquierda.
        11. **Emoji en Nota Importante:** Se a帽adi贸 el emoji `锔` a la nota importante.
        12. **Eliminaci贸n de Notas Personales:** La secci贸n de notas personales fue eliminada por completo.
    *   **Archivos Modificados:**
        *   `index.html`: L铆neas 1714-1888, 2125-2405.

**v4.3.2 (31-12-2025)**
*   **INFRA (api-manager.js):** Se actualizaron las URLs de los microservicios `CATALOG` y `FEEDBACK` a las nuevas versiones desplegadas, asegurando la comunicaci贸n con los endpoints correctos.
    *   `api-manager.js`: L铆neas 10-14

**v4.3.1 (31-12-2025)**
*   **REFACTOR (services/feedback/feedback.js):** Se mejor贸 y robusteci贸 la l贸gica de `handleSuggestYear`. La funci贸n ahora solo considera votos de usuarios 煤nicos para aplicar un cambio en el rango de a帽os, preveniendo que un solo usuario fuerce una actualizaci贸n. Adicionalmente, se corrigi贸 el `MimeType` de la respuesta del servicio a `TEXT` para garantizar la compatibilidad con CORS y prevenir errores de `Failed to fetch`. Se elimin贸 tambi茅n una declaraci贸n duplicada de la funci贸n `handleRecordLike`.
    *   **services/feedback/feedback.js`: L铆neas 128-140, 210-218
*   **FIX (index.html):** Se corrigi贸 un bug cr铆tico en la funci贸n `handleLike` que imped铆a el correcto funcionamiento del feedback de usuario y la sugerencia de a帽os. La nueva implementaci贸n asegura que la UI se actualice correctamente, previene env铆os duplicados y pasa el `userId` requerido al backend.
    *   `index.html`: L铆neas 3200-3250
*   **REFACTOR (services/catalog/catalog.js):** Se extendi贸 la funcionalidad de conversi贸n de thumbnails. La funci贸n `convertirAGoogleThumbnail` ahora se aplica tambi茅n a los datos de las secciones "Tutoriales" y "Relay", centralizando completamente la l贸gica de formateo de im谩genes en el backend.
    *   `services/catalog/catalog.js`: L铆neas 240-258

**v4.3.0 (15/01/2026)**
*   **FIX CRTICO (index.html, catalog.js, utilities.js):** Se solucion贸 la causa ra铆z final y persistente del fallo de renderizaci贸n de im谩genes de Google Drive en todo el sistema.
    *   **Causa Ra铆z:** Las funciones auxiliares que convert铆an URLs de Google Drive a formatos de thumbnail (`convertirAGoogleThumbnail` en el frontend y backend, y `getImageCreationDate` en utilities) utilizaban una expresi贸n regular que no era capaz de parsear todos los formatos de URL existentes en la base de datos (ej. URLs con `/view` o `/file/d/`).
    *   **Soluci贸n:** Se refactorizaron todas las instancias de esta l贸gica con una expresi贸n regular mucho m谩s robusta que ahora captura correctamente el ID del archivo desde m煤ltiples formatos de URL (`.../file/d/ID...`, `...id=ID...`, y `.../d/ID...`). Esto asegura una conversi贸n de URLs consistente y correcta en toda la aplicaci贸n.
        *   `index.html`: L铆neas 1943-1961
        *   `services/catalog/catalog.js`: L铆neas 346-362
        *   `services/utilities/utilities.js`: L铆neas 127-145, 192-210

**v4.2.9 (14/01/2026)**
*   **FIX (index.html):** Se solucion贸 un bug visual cr铆tico que imped铆a la renderizaci贸n de los logos de las marcas en la vista de selecci贸n de marcas.
    *   **Causa Ra铆z:** La funci贸n `mostrarMarcas` asignaba directamente la URL de Google Drive (`logoUrl`) al atributo `src` de la imagen, sin convertirla al formato de thumbnail requerido por el navegador para su correcta visualizaci贸n.
    *   **Soluci贸n:** Se envolvi贸 la variable `logoUrl` dentro de la funci贸n auxiliar `convertirAGoogleThumbnail` antes de asignarla al `src`. Esto asegura que la URL se formatee correctamente y que la imagen del logo se renderice como es debido. (L铆nea 2567).

**v4.2.8 (13/01/2026)**
*   **FIX (index.html):** Se solucion贸 la causa ra铆z del fallo en la renderizaci贸n de logos de marcas.
    *   **Causa Ra铆z:** La l贸gica anterior para encontrar logos (`getLogoUrlForMarca`) era demasiado r铆gida y se basaba en la concatenaci贸n de strings (ej. 'marca' + 'motocicletas'), lo que no coincid铆a con los nombres reales en la base de datos (ej. 'Honda Motocicletas').
    *   **Soluci贸n:** Se revirti贸 el fallback a texto y se refactoriz贸 `getLogoUrlForMarca` con un algoritmo de b煤squeda flexible. La nueva funci贸n normaliza los nombres, busca todas las coincidencias parciales que contienen el nombre de la marca y luego usa la categor铆a para desambiguiar de forma inteligente entre variantes (ej. prioriza "motocicletas" si la categor铆a es "Motos"). Esto asegura que el logo correcto se encuentre siempre. (L铆neas 1901-1941, 2535-2565).
*   **FEAT (index.html):** Se implement贸 la l贸gica de frontend para la sugerencia de a帽o, completando el flujo de feedback del usuario.
    *   **Funcionalidad:** Despu茅s de que un usuario presiona el bot贸n "til" para registrar un "like", ahora se le presenta un `prompt` que le pregunta si el corte aplica a otro a帽o.
    *   **Implementaci贸n:** Si el usuario ingresa un a帽o v谩lido, la funci贸n `handleLike` invoca la acci贸n `suggestYear` en el backend para registrar la sugerencia. Se a帽adi贸 manejo de errores y validaci贸n de entrada para asegurar que solo se env铆en a帽os num茅ricos v谩lidos. (L铆neas 2933-2980).

**v4.2.7 (12/01/2026)**
*   **FIX (index.html):** Se implement贸 un mecanismo de fallback para la visualizaci贸n de marcas. Si los datos de los logos no est谩n disponibles en el backend (la variable `datosLogos` est谩 vac铆a), la funci贸n `mostrarMarcas` ahora renderizar谩 tarjetas de solo texto con los nombres de las marcas en lugar de mostrar im谩genes rotas. Esto asegura que la navegaci贸n siga siendo funcional y la experiencia de usuario sea fluida incluso con datos incompletos. (L铆neas 2535-2588).

**v4.2.6 (11/01/2026)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `CATALOG` a la nueva versi贸n desplegada proporcionada por el usuario. (L铆nea 10).

**v4.2.5 (10/01/2026)**
*   **FIX (index.html & services/catalog/catalog.js):** Se implement贸 una soluci贸n integral para el fallo persistente en la renderizaci贸n de logos de marcas.
    1.  **Backend (`services/catalog/catalog.js`):** Se corrigi贸 una inconsistencia cr铆tica en la funci贸n `doGet`. Se actualiz贸 el n煤mero de versi贸n reportado de `1.2.1` a `2.3.0` y se a帽adi贸 `LogosMarca` a la lista de hojas de c谩lculo accedidas en el modo debug. Esto asegura que la metadata del servicio refleje su funcionalidad real. (L铆neas 77, 79).
    2.  **Frontend (`index.html`):** Se robusteci贸 la funci贸n `mostrarMarcas`. Ahora incluye una comprobaci贸n defensiva que emite un `debugLog` si `datosLogos` est谩 vac铆o, alertando sobre problemas de datos. Adem谩s, se a帽adi贸 un manejador de eventos `onerror` a las im谩genes de los logos, que muestra una imagen de "Error" y registra un `debugLog` if la carga falla. (L铆neas 2535-2565).
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `FEEDBACK` a la newa versi贸n desplegada y proporcionada por el usuario, restaurando la funcionalidad del sistema de Inbox y reportes. (L铆nea 12).

**v4.2.4 (09/01/2026)**
*   **FIX CRTICO (index.html):** Se solucion贸 una regresi贸n cr铆tica que imped铆a la carga del cat谩logo y causaba la p茅rdida de sesi贸n en cada recarga.
    *   **Causa Ra铆z:** Un error de `ReferenceError: updateCarousel is not defined` deten铆a la ejecuci贸n de JavaScript. La funci贸n `updateCarousel` se defin铆a dentro de un bloque `if` en la l贸gica del carrusel, pero era llamada por un `setTimeout` que se encontraba fuera de dicho bloque. Si la condici贸n del `if` no se cumpl铆a (p.ej., si hab铆a menos de 6 elementos en el carrusel), la funci贸n no se declaraba, provocando el error fatal.
    *   **Soluci贸n:** Se movi贸 la llamada `setTimeout(updateCarousel, 100)` dentro del bloque `if` para asegurar que solo se ejecute si la funci贸n `updateCarousel` ha sido definida. Esto previene el error y permite que la aplicaci贸n se inicialice correctamente. (L铆nea 2525).

**v4.2.3 (08/01/2026)**
*   **FIX (index.html):** Se corrigi贸 una regresi贸n cr铆tica introducida en la v4.2.0 que romp铆a la funcionalidad de la barra de b煤squeda.
    *   **Causa Ra铆z:** La funci贸n `mostrarResultadosBusquedaMarca` intentaba obtener la URL del logo de la marca usando `estado.categoria`, que es nulo o incorrecto en el contexto de una b煤squeda global. Esto provocaba un fallo en la renderizaci贸n de los resultados.
    *   **Soluci贸n:** Se modific贸 la llamada a `getLogoUrlForMarca` para pasar `null` como categor铆a, forzando a la funci贸n a usar su l贸gica de fallback para encontrar el logo gen茅rico de la marca, restaurando as铆 la funcionalidad. (L铆nea 2282).

**v4.2.2 (08/01/2026)**
*   **INFRA (api-manager.js):** Se actualizaron las URLs de los microservicios `CATALOG` y `UTILITIES` a las newas versiones desplegadas y proporcionadas por el usuario, asegurando que el frontend se comunique con los endpoints m谩s recientes. (L铆neas 10, 14).

**v4.2.1 (07/01/2026)**
*   **FIX (catalog.js & index.html):** Se corrigi贸 un bug funcional en el ordenamiento de categor铆as. La versi贸n anterior calculaba la popularidad pero no la aplicaba.
    1.  **Backend (`services/catalog/catalog.js`):** Se a帽adi贸 la l贸gica para ordenar la lista de categor铆as por `vehicleCount` (descendente) antes de enviarla al frontend. (L铆neas 220-221).
    2.  **Frontend (`index.html`):** Se elimin贸 el ordenamiento alfab茅tico (`.sort()`) que se aplicaba en el cliente, asegurando que el orden del backend sea respetado. Se modific贸 la funci贸n `mostrarCategorias` para usar la nueva lista `sortedCategoriesList` recibida. (L铆neas 1611, 1458, 2326-2332).
*   **FEAT (services/utilities/utilities.js):** Se a帽adi贸 una nueva funcionalidad al servicio de utilidades para obtener la fecha de creaci贸n de una imagen a partir de su URL de Google Drive.
    1.  **Helper Function:** Se cre贸 una nueva funci贸n auxiliar `getImageCreationDate(url)` que extrae el ID del archivo de la URL, accede al archivo mediante `DriveApp` y devuelve su fecha de creaci贸n en formato ISO. (L铆neas 105-128).
    2.  **API Endpoint:** Se expuso esta funcionalidad a trav茅s de una nueva acci贸n `getImageCreationDateFromUrl` en el `doPost`, permitiendo que sea invocada de forma segura desde el frontend (requiere rol 'Desarrollador'). (L铆neas 66-72).

**v4.2.0 (06/01/2026)**
*   **FEAT (feedback.js):** Se refactoriz贸 completamente la l贸gica de `handleSuggestYear` para cumplir con los nuevos requisitos de negocio. La funci贸n ahora requiere 3 votos de usuarios para aplicar un cambio y ejecuta una comprobaci贸n anti-colisi贸n para prevenir el solapamiento de rangos de a帽os entre diferentes generaciones de un mismo modelo.
*   **REFACTOR (catalog.js):** Se centraliz贸 la l贸gica de conversi贸n de URLs de Google Drive a thumbnails en el backend. La nueva funci贸n `convertirAGoogleThumbnail` ahora procesa todas las URLs de im谩genes antes de enviarlas al frontend, mejorando el rendimiento y la consistencia.
*   **UX (index.html):** Se implementaron m煤ltiples mejoras en la interfaz de usuario:
    *   **Layout Principal:** Se reorganiz贸 la p谩gina principal para mostrar primero la secci贸n "ltimos Agregados" y luego las "Categor铆as".
    *   **Carrusel:** La secci贸n "ltimos Agregados" es ahora un carrusel que muestra 6 tarjetas.
    *   **Navegaci贸n por Marca:** La vista de selecci贸n de marca ahora muestra los logos en lugar de texto.
    *   **Modal de Detalles:** Se unific贸 la funcionalidad de "like" y "sugerir a帽o" en el bot贸n "til" (). Se a帽adieron placeholders de edici贸n "in-modal" para campos sin datos.
*   **CHORE:** Las modificaciones se realizaron de forma segura, sin alterar la l贸gica cr铆tica protegida de `auth.js` (sesiones) ni `catalog.js` (carga de datos y cach茅).

**v4.1.1 (05/01/2026)**
*   **FIX (index.html):** Se restaur贸 la l贸gica para el bot贸n de instalaci贸n de la PWA (`beforeinstallprompt` listener y el handler del click), que fue eliminada accidentalmente en una refactorizaci贸n previa. Esto soluciona una regresi贸n cr铆tica que imped铆a a los usuarios instalar la aplicaci贸n. (L铆neas 2315-2346).
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Utilities` a la nueva versi贸n desplegada y funcional, eliminando el endpoint placeholder. (L铆nea 14).

**v4.1.0 (04/01/2026)**
*   **FEAT (services/utilities/utilities.js & index.html):** Se implement贸 un nuevo microservicio `GPSpedia-Utilities` y la interfaz de frontend correspondiente para herramientas de administrador.
    1.  **Backend (`services/utilities/utilities.js`):** Creado el nuevo servicio con acciones protegidas (`migrateYearRanges`, `migrateTimestamps`) para migraciones de datos. (Archivo nuevo).
    2.  **Frontend (`index.html`):** A帽adido un modal "Herramientas de Desarrollador", accesible mediante un nuevo bot贸n en el men煤 lateral (visible solo para rol 'Desarrollador'). El modal incluye botones para ejecutar las migraciones y muestra la consola de depuraci贸n. (L铆neas 923-950, 2593-2625, 2772-2808).
    3.  **Infra (`api-manager.js`):** Registrado el nuevo endpoint `UTILITIES` y mapeadas las nuevas acciones. (L铆neas 14, 46-47).
*   **FEAT (services/feedback/feedback.js & index.html):** Se implement贸 un sistema de "Inbox" para la gesti贸n de feedback de usuarios.
    1.  **Backend (`services/feedback/feedback.js`):** A帽adidas nuevas acciones (`getFeedbackItems`, `replyToFeedback`, `markAsResolved`) para leer y gestionar los reportes de problemas y mensajes de contacto. (L铆neas 114-123, 342-423).
    2.  **Frontend (`index.html`):** A帽adido un modal de "Inbox", accesible mediante un nuevo bot贸n en el men煤 lateral (visible para roles 'Supervisor', 'Gefe', 'Desarrollador'). La UI permite ver, responder y resolver items de feedback. (L铆neas 907-921, 2582-2591, 2665-2770).
*   **FIX (users.html):** Solucionado un bug cr铆tico que causaba que los datos de los usuarios se mostrasen como "undefined" en la tabla de gesti贸n y en el modal de edici贸n. El problema se deb铆a a un desfase de may煤sculas y min煤sculas (`camelCase` en el frontend vs. `PascalCase_With_Underscores` en el backend). Se corrigi贸 el acceso a las propiedades en todo el archivo. (L铆neas 239-241, 273-291, 318-322, 339, 349-354).
*   **UX (index.html):** Se implementaron mejoras en la interfaz de usuario del modal de detalles del veh铆culo.
    1.  **Botones de Feedback:** Se redise帽aron los botones "til" y "Reportar" para que sean m谩s compactos, mostrando un 铆cono y texto sin un contenedor de bot贸n grande. (L铆neas 1769-1782).
    2.  **Video Gu铆a:** La secci贸n "Video Gu铆a de Desarme" ahora se muestra dentro de un acorde贸n colapsable, igual que el resto de la informaci贸n suplementaria. (L铆neas 1844-1853).
*   **CHORE:** No se introdujeron regresiones en las funcionalidades estables (login, sesi贸n, carga de cat谩logo, cach茅).

**v4.0.2 (03/01/2026)**
*   **DOCS (Auditoria.txt & README.md):** Se realiz贸 una auditor铆a completa del sistema y se sincroniz贸 la documentaci贸n para reflejar el estado real del c贸digo.
    1.  **Auditor铆a (`Auditoria.txt`):** Se sobrescribi贸 el archivo con un nuevo reporte confirmando que el c贸digo fuente es funcional y no presenta los bugs cr铆ticos listados en la documentaci贸n. Se identific贸 el `README.md` como la fuente de la inconsistencia.
    2.  **Sincronizaci贸n (`README.md`):** Se actualizaron los checklists en la secci贸n "Bugs y Regresiones Cr铆ticas" para marcar como completados `[X]` los siguientes puntos, que ya estaban resueltos en el c贸digo: "L贸gica del Modal de Detalle", "Carga de Im谩genes en Modal" y "Carga de Logos en Modal". (L铆neas 231-233).

**v4.0.1 (02/01/2026)**
*   **FIX CRTICO (api-manager.js & services/catalog/catalog.js):** Solucionado un error de "Fallo de conexi贸n" (Failed to fetch) con el servicio de cat谩logo. El fix integral incluy贸:
    1.  **Backend (`services/catalog/catalog.js`):** Se cambi贸 el `MimeType` de la respuesta de `JSON` a `TEXT` para cumplir con la pol铆tica de CORS del entorno de Google Apps Script. (L铆neas 112, 124).
    2.  **Frontend (`api-manager.js`):** Se actualiz贸 la l贸gica de `routeAction` para procesar la respuesta como texto (`.text()`) y luego parsearla (`JSON.parse()`), en lugar de usar directamente `.json()`. (L铆neas 83-84).
*   **INFRA (api-manager.js):** Se ha actualizado la URL del microservicio `GPSpedia-Catalog` a la nueva versi贸n desplegada proporcionada por el usuario. (L铆nea 12).
*   **FIX (index.html):** Se corrigi贸 la l贸gica del modal de detalles (`mostrarDetalleModal`). Ahora, el corte recomendado se muestra de forma visible por defecto, mientras que los cortes adicionales se presentan en secciones desplegables (acorde贸n), cumpliendo con los requisitos de la auditor铆a. (L铆neas 1709-1811).
*   **FIX (index.html):** Solucionado un bug que imped铆a la visualizaci贸n de im谩genes suplementarias en el modal de detalles. Se a帽adi贸 la l贸gica para renderizar las im谩genes de apertura, cable de alimentaci贸n y diagramas de relay en sus correspondientes secciones. (L铆neas 1750-1768, 1829-1875).

**v4.0.0 (02-01/2026)**
*   **FIX CRTICO (services/catalog/catalog.js):** Se ha solucionado el error `cannot read properties of undefined (reading 'categoria')` que imped铆a la carga de datos del cat谩logo y de los formularios. Se implement贸 la funci贸n `mapRowToObject` que faltaba y se corrigi贸 `handleGetDropdownData` para leer din谩micamente las opciones de "Categor铆a" desde las reglas de validaci贸n de la hoja de c谩lculo.
*   **FIX CRTICO (services/users/users.js):** Se ha reparado el servicio de gesti贸n de usuarios, que fallaba en todas sus operaciones (`Failed to fetch`). El error se deb铆a a que la funci贸n `doPost` no retornaba ninguna respuesta. Se corrigi贸 la funci贸n para asegurar que todas las acciones devuelvan un resultado al frontend.
*   **REFACTOR & FEAT (index.html):** Se ha eliminado la p谩gina `info.html` y su contenido se ha integrado directamente en `index.html` como modales.
    *   Las secciones "Sobre Nosotros", "Cont谩ctanos" y "Preguntas Frecuentes" ahora se abren como pop-ups sin necesidad de recargar la p谩gina.
    *   Se ha a帽adido el nuevo contenido extendido a estas secciones.
    *   Se a帽adi贸 un peque帽o margen al CSS del pie de p谩gina para mejorar la separaci贸n visual de los enlaces.
*   **FIX (index.html):** Se ha corregido el env铆o del formulario de contacto, que fallaba por un error tipogr谩fico en el nombre de la acci贸n (`sendContacForm` -> `sendContactForm`).
*   **CHORE (project):** Se han actualizado los n煤meros de versi贸n en todos los archivos modificados a `4.0.0` (global) y a las versiones de componente correspondientes.
