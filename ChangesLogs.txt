**V7.0.0 - (FEATURE & STABILITY) - 07/01/2026**
**A. IMPLEMENTACIÓN DEL FLUJO DE ESCRITURA Y CORRECCIONES CRÍTICAS (FULL-STACK):** Se completó la implementación del nuevo flujo de trabajo para agregar cortes (`add_cortes.html`) y se solucionaron bugs críticos de corrupción de datos y de funcionalidad en los servicios de `write` y `users`.

**B. Resumen de Nuevas Funcionalidades y Correcciones:**
    1.  **Nuevo Flujo de "Agregar Cortes" (Tarea 27):** Se reconstruyó por completo el frontend y el backend para el formulario de agregar nuevos registros, siguiendo la especificación del `README.md`.
        *   **Frontend (`add_cortes.html`):** Se implementó una nueva interfaz multi-paso (verificación, agregar corte, info. suplementaria) con lógica de renderizado condicional y un diseño basado en "accordions" para una mejor UX.
        *   **Backend (`services/write/write.js`):**
            *   Se implementó la búsqueda anti-duplicados avanzada con lógica flexible para marca/modelo y exacta para año/encendido.
            *   Se añadió la funcionalidad "Quizás quisiste decir..." (`getSuggestion`) usando el algoritmo de distancia de Levenshtein para asistir al usuario.
            *   Se implementó la lógica para manejar las 3 fases del formulario, incluyendo la creación de carpetas y el renombrado estandarizado de imágenes en Google Drive.
    2.  **Unificación de Lógica de Backend (Tarea 17):** Se eliminó la función duplicada `handleCheckVehicle` del `services/catalog/catalog.js`, centralizando la responsabilidad de esta verificación únicamente en `services/write/write.js`.
    3.  **Corrección de Corrupción de IDs (Tareas 22 y 23):** Se solucionó un bug crítico en `services/write/write.js` y `services/users/users.js` que impedía la correcta herencia de las fórmulas de autogeneración de IDs (`V-` y `U-`). Ambos servicios ahora utilizan el método `copyTo` para garantizar la integridad de los datos.
    4.  **Reparación de Gestión de Usuarios (Tarea 23):**
        *   Se corrigió el bug que impedía que el botón "Cambiar Contraseña" en `users.html` funcionara, conectándolo correctamente al backend.
        *   Se solucionó el fallo subyacente en la creación de nuevos usuarios.

**C. Cambios Técnicos Implementados:**
    1.  **`add_cortes.html`:** Reescritura completa del archivo para implementar la nueva interfaz y la lógica de frontend para el flujo de 3 pasos.
    2.  **`services/write/write.js`:** Se refactorizó `handleCheckVehicle`, se añadieron `handleGetSuggestion` y `handleAddSupplementaryInfo`, y se corrigió `handleAddOrUpdateCut` para usar `copyTo` y `setValues`.
    3.  **`services/users/users.js`:** Se refactorizó `handleCreateUser` para usar el método `copyTo` y `setValues`, solucionando el bug de creación e IDs.
    4.  **`users.html`:** Se corrigió el payload en `handleChangePasswordSubmit` para enviar el ID de usuario correcto.
    5.  **`services/catalog/catalog.js`:** Se eliminó código muerto (`handleCheckVehicle`).

**D. Impacto:**
    -   Se entrega una funcionalidad core de la aplicación (agregar nuevos cortes) que es robusta, intuitiva y a prueba de duplicados.
    -   Se elimina una fuente importante de corrupción de datos al asegurar la correcta generación de IDs.
    -   Se restauran funciones críticas de la administración de usuarios.

**V6.1.0 - (CRITICAL DATA INTEGRITY HOTFIX) - 06/01/2026**
**A. FIX CRÍTICO DE INTEGRIDAD DE DATOS (BACKEND):** Se solucionó un bug crítico introducido en la versión anterior que causaba la corrupción de datos en los reportes de problemas.

**B. Resumen de la Corrección:**
    1.  **Corrupción de Datos en Reportes (Tarea 21):** Se corrigió un bug en la función `handleReportProblem` de `services/feedback/feedback.js`. La función estaba sobrescribiendo incorrectamente el `userName` del reportador con su `userId`, resultando en la pérdida del nombre de usuario en la hoja de "Feedbacks". El bug ha sido eliminado y el `userName` ahora se guarda correctamente.

**C. Cambios Técnicos Implementados:**
    1.  **`services/feedback/feedback.js`:** Se eliminó la línea de código redundante y errónea que causaba la sobrescritura del dato `userName`.

**D. Nota de Revisión de Código:**
    - La revisión de código inicial para V6.0.0 indicó incorrectamente una vulnerabilidad de seguridad en `services/users/users.js` (Tarea 14). Una auditoría posterior confirmó que las medidas de seguridad basadas en `sessionToken` ya estaban implementadas correctamente en dicha versión, por lo que no se requirieron cambios en ese servicio.

**E. Impacto:**
    - Se restaura la integridad de los datos para todos los nuevos reportes de problemas.
    - Se asegura que los administradores puedan ver correctamente qué usuario ha enviado cada reporte.

**V6.0.0 - (SECURITY & DATA INTEGRITY) - 06/01/2026**
**A. FIX CRÍTICO DE SEGURIDAD Y DE INTEGRIDAD DE DATOS (BACKEND & FRONTEND):** Se implementaron correcciones a múltiples vulnerabilidades de seguridad y bugs de corrupción de datos en los servicios de backend y se corrigió un bug de renderizado en el frontend.

**B. Resumen de Correcciones Críticas:**
    1.  **Vulnerabilidad de Escalada de Privilegios (Tarea 14):** Se parchó una vulnerabilidad crítica en `services/users/users.js`. Las funciones `handleCreateUser`, `handleUpdateUser`, y `handleDeleteUser` ahora ignoran el rol enviado por el cliente y en su lugar verifican la autoridad del usuario a través de un `sessionToken` validado en el backend, previniendo la escalada de privilegios.
    2.  **Bugs de Integridad de Datos (Tarea 21):** Se solucionaron múltiples bugs en `services/feedback/feedback.js` que causaban corrupción de datos. Las funciones `handleReportProblem` y `handleSendContactForm` ahora guardan correctamente el `userId` y utilizan un método robusto para la creación de filas que preserva las fórmulas de autogeneración de IDs.
    3.  **Inconsistencia en Cambio de Contraseña (Tarea 15):** Se implementó la lógica faltante en la función `handleChangePassword` de `services/users/users.js` y se aseguró que la comparación de la contraseña actual sea `case-insensitive`, alineándola con el comportamiento del login.
    4.  **Bug de Mapeo de Datos en UI (Tarea 7):** Se corrigió el bug de renderizado en `users.html` al limpiar comentarios obsoletos que indicaban un problema de mapeo de datos que ya había sido resuelto, mejorando la claridad del código.

**C. Cambios Técnicos Implementados:**
    1.  **`services/users/users.js`:** Se implementó la función `getVerifiedRole` y se refactorizaron las funciones de CRUD para usar `sessionToken`. Se completó la función `handleChangePassword` con la lógica correcta. Se incrementó la versión a `2.4.0`.
    2.  **`services/feedback/feedback.js`:** Se refactorizaron las funciones de creación de reportes y contactos para guardar `userId` y usar un método de inserción de filas seguro. Se incrementó la versión a `2.3.0`.
    3.  **`users.html`:** Se eliminaron comentarios `FIX:` obsoletos para reflejar el estado correcto del código. Se incrementó la versión a `3.8.0`.

**D. Impacto:**
    -   Se mejora significativamente la seguridad del sistema al eliminar una vulnerabilidad crítica.
    -   Se restaura la integridad de los datos en el sistema de feedback.
    -   Se mejora la experiencia de usuario al solucionar un bug frustrante en el cambio de contraseña y se clarifica el código del frontend.

**V5.9.0 - (CRITICAL REGRESSION FIX) - 05/01/2026**
**A. FIX INTEGRAL DE REGRESIONES CRÍTICAS EN UI (FRONTEND):** Se realizó una corrección masiva de la interfaz de usuario para restaurar funcionalidades y layouts que se rompieron o eliminaron durante la refactorización a una arquitectura modular.

**B. Resumen de Regresiones Corregidas:**
    1.  **Sección "Últimos Agregados" Restaurada:** Se reincorporó esta sección crítica a la página principal, que había desaparecido por completo.
    2.  **Modal de Detalle de Vehículo Reconstruido:** El modal se reconstruyó desde cero para cumplir con las especificaciones del `README.md`, corrigiendo el orden del contenido, la disposición de los logos, y la lógica de renderizado de los "cortes".
    3.  **Ordenamiento de Cortes por Utilidad:** Se implementó la lógica para ordenar los cortes de un vehículo por su número de votos "útil", mostrando el más votado como "Corte Recomendado".
    4.  **Botones de Feedback (UI):** Se implementó la estructura y los estilos para que los botones "Útil" y "Reportar" aparezcan como un overlay en la esquina inferior derecha de las imágenes de corte.
    5.  **Modales de Tutorial y Relay Reparados:** Se corrigió la lógica de navegación y renderizado que impedía mostrar el contenido (videos e imágenes) en los modales de detalle de las secciones "Tutoriales" y "Relay".

**C. Cambios Técnicos Implementados:**
    1.  **`ui.js`:**
        -   Se modificó `mostrarCategorias()` para asegurar que `mostrarUltimosAgregados()` sea llamado primero.
        -   Se reescribió por completo `mostrarDetalleModal()` para generar la estructura HTML correcta y ordenada.
        -   Se añadió la lógica de ordenamiento de cortes y la creación de secciones de acordeón.
        -   Se implementó la función `createAccordionSection()` para renderizar el contenido dinámico del modal, incluyendo el overlay de los botones de feedback.
        -   Se crearon las funciones `mostrarSeccion`, `mostrarTutorialesGrid`, `mostrarRelayGrid`, `mostrarDetalleTutorialModal`, y `mostrarDetalleRelayModal` para manejar la navegación y renderizado de las secciones secundarias.
    2.  **`style.css`:** Se añadieron los estilos para `.feedback-overlay` y `.feedback-btn-overlay` para posicionar y dar formato a los botones de feedback.
    3.  **`main.js`:** Se actualizó el event listener de los botones de sección para que utilice la nueva función `ui.mostrarSeccion`, reemplazando la lógica de placeholder.
    4.  **`index.html`:** Se eliminaron los atributos `onclick` obsoletos de los botones de sección.

**D. Impacto:**
    -   Se restaura la experiencia de usuario a la funcionalidad esperada, solucionando múltiples regresiones críticas.
    -   La aplicación vuelve a ser funcional en sus flujos de navegación y visualización de detalles más importantes.
    -   El frontend ahora está alineado con las especificaciones funcionales y de diseño del `README.md`.
