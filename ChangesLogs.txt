**V8.5.0 - (CRITICAL FIX ATTEMPT) - 10/01/2026**
**A. RESUMEN GENERAL:** Se implementó una corrección integral multi-componente en un intento por resolver una cascada de fallos críticos que afectaban el arranque de la aplicación, la carga de datos del catálogo y la gestión de usuarios. La causa raíz fue identificada como un objeto de sesión incompleto generado por el servicio de autenticación.

**B. Correcciones Implementadas:**
1.  **Objeto de Sesión Incompleto (`services/auth/auth.js`):**
    *   **Problema:** El servicio de autenticación no incluía el campo `Nombre_Completo` en el objeto de sesión del usuario devuelto al iniciar sesión.
    *   **Cambio:** Se modificó la función `handleLogin` para leer y añadir explícitamente el `Nombre_Completo` de la base de datos al objeto de sesión, asegurando que el frontend reciba todos los datos necesarios del usuario. (Línea 198)

2.  **Condición de Carrera en Carga de Catálogo (`auth.js`):**
    *   **Problema:** El frontend intentaba renderizar la UI principal (`showApp`) antes de haber solicitado y recibido los datos del catálogo, resultando en una pantalla en blanco.
    *   **Cambio:** Se invirtió la secuencia de arranque en las funciones `checkSession` y `login`. La aplicación ahora espera (`await`) a que `loadInitialData()` se complete exitosamente antes de llamar a `handleLoginSuccess()`, garantizando que los datos estén disponibles antes del renderizado. (Líneas 70-71, 84-85)

3.  **Manejo de Errores de Carga (`auth.js`):**
    *   **Problema:** Un fallo en la carga inicial de datos (`loadInitialData`) no establecía un estado por defecto, provocando un `TypeError` fatal si el renderizado procedía.
    *   **Cambio:** Se mejoró el bloque `catch` de `loadInitialData` para que, en caso de error, inicialice el `catalogData` en el estado global con una estructura vacía. Esto previene el error fatal y permite que la aplicación se cargue parcialmente. (Líneas 44-52)

4.  **Inconsistencia de Seguridad (`services/users/users.js` y `users.html`):**
    *   **Problema:** La función `handleGetUsers` en el backend requería que el frontend enviara el rol del usuario, creando una vulnerabilidad y una condición de carrera que causaba errores de red intermitentes.
    *   **Cambio (Backend):** Se refactorizó `handleGetUsers` para que ya no acepte el rol del frontend. En su lugar, ahora requiere el `sessionToken` y utiliza la función interna `getVerifiedRole` para una autorización segura del lado del servidor. (Líneas 128-132)
    *   **Cambio (Frontend):** Se actualizó la función `fetchUsers` en `users.html` para que envíe el `sessionToken` del usuario en la solicitud, alineándose con el nuevo requisito del backend. (Línea 261)

**C. Impacto Potencial:**
- Estas correcciones buscan restaurar por completo la funcionalidad de arranque de la aplicación y la visualización del catálogo.
- Se ha mejorado la robustez y seguridad del módulo de gestión de usuarios.
- La aplicación ahora es más resiliente a fallos en la carga de datos iniciales.

**V8.4.8 - (CONFIG) - 09/01/2026**
**A. RESUMEN GENERAL:** Se actualizó por cuarta vez la configuración del frontend para apuntar a la nueva URL de producción del microservicio de gestión de usuarios (`GPSpedia-Users`).

**B. Cambios de Configuración:**
1.  **Actualización de Endpoint (`api-manager.js`):**
    *   **Motivo:** El servicio de usuarios fue redesplegado en una nueva URL para incorporar las correcciones más recientes.
    *   **Cambio:** Se actualizó la constante `API_ENDPOINTS.USERS` con el nuevo endpoint para asegurar que el frontend utilice la versión definitiva del servicio.

**C. Cambios Técnicos Implementados:**
- **`api-manager.js`:** Se modificó la URL del endpoint para el servicio `USERS` (Línea 12).

**D. Impacto:**
- **Continuidad del Servicio:** El frontend ahora se comunica con el endpoint más reciente del servicio de usuarios, asegurando que toda la funcionalidad de gestión de usuarios permanezca operativa y libre de bugs conocidos.

**V8.4.7 - (CRITICAL REGRESSION FIX) - 09/01/2026**
**A. RESUMEN GENERAL:** Se corrigió una regresión crítica que provocaba la duplicación de usuarios al editarlos y se implementó la solución definitiva al bug persistente que impedía guardar el campo "Nombre Completo".

**B. Correcciones Implementadas:**
1.  **Regresión "Create on Edit" (`services/users/users.js`):**
    *   **Problema:** Al editar un usuario existente, el sistema creaba un nuevo usuario duplicado en lugar de actualizar el original.
    *   **Causa Raíz:** La función `handleCreateUser` no generaba ni asignaba un ID único al nuevo usuario, dejando la columna `ID` vacía. Esto provocaba que el frontend tratara las ediciones de estos usuarios sin ID como si fueran nuevas creaciones.
    *   **Solución:** Se implementó una nueva función auxiliar, `getNewUserId`, para calcular el siguiente ID disponible. Se modificó `handleCreateUser` para llamar a esta función y escribir explícitamente el nuevo ID en la hoja de cálculo, garantizando la integridad de los datos y eliminando la duplicación.

2.  **Bug Persistente de "Nombre Completo" (`services/users/users.js`):**
    *   **Problema:** El campo "Nombre Completo" seguía sin guardarse al editar un usuario.
    *   **Causa Raíz Definitiva:** La lógica en `handleUpdateUser` era demasiado frágil y fallaba por conflictos de `case-sensitivity` entre el frontend y el backend.
    *   **Solución:** Se reemplazó la lógica de actualización genérica por bloques `if` explícitos para cada campo, asegurando que `Nombre_Completo` y todos los demás datos se guarden de manera fiable.

**C. Cambios Técnicos Implementados:**
- **`services/users/users.js`:**
    - Se añadió la función `getNewUserId` para la generación de IDs únicos (Líneas 290-294).
    - Se refactorizó `handleCreateUser` para asignar el nuevo ID (Líneas 175-186).
    - Se refactorizó `handleUpdateUser` con lógica explícita para garantizar las actualizaciones (Líneas 212-227).

**D. Impacto:**
- **Estabilidad del Módulo Restaurada:** Se ha eliminado la regresión crítica que corrompía la base de datos de usuarios con duplicados.
- **Funcionalidad Completada:** La capacidad de crear y editar usuarios, incluyendo su nombre completo, es ahora completamente funcional y robusta.

**V8.4.6 - (CONFIG) - 09/01/2026**
**A. RESUMEN GENERAL:** Se actualizó por tercera vez la configuración del frontend para apuntar a la nueva URL de producción del microservicio de gestión de usuarios (`GPSpedia-Users`).

**B. Cambios de Configuración:**
1.  **Actualización de Endpoint (`api-manager.js`):**
    *   **Motivo:** El servicio de usuarios fue redesplegado en una nueva URL para incorporar las correcciones más recientes.
    *   **Cambio:** Se actualizó la constante `API_ENDPOINTS.USERS` con el nuevo endpoint para asegurar que el frontend utilice la versión definitiva del servicio.

**C. Cambios Técnicos Implementados:**
- **`api-manager.js`:** Se modificó la URL del endpoint para el servicio `USERS` (Línea 12).

**D. Impacto:**
- **Continuidad del Servicio:** El frontend ahora se comunica con el endpoint más reciente del servicio de usuarios, asegurando que toda la funcionalidad de gestión de usuarios permanezca operativa y libre de bugs conocidos.

**V8.4.5 - (BUG FIX) - 09/01/2026**
**A. RESUMEN GENERAL:** Se implementó la corrección definitiva para el bug persistente que impedía guardar el "Nombre Completo" al editar un usuario.

**B. Corrección Implementada:**
1.  **Bug de Escritura en Edición (`services/users/users.js`):**
    *   **Problema:** A pesar de correcciones anteriores, el campo "Nombre Completo" seguía sin actualizarse al editar un usuario existente.
    *   **Causa Raíz Definitiva:** La lógica genérica en `handleUpdateUser` para procesar los campos fallaba silenciosamente debido a un conflicto de sensibilidad a mayúsculas/minúsculas (`case-sensitivity`) entre las claves del objeto `updates` enviado por el frontend (ej. `Nombre_Completo`) y las claves esperadas en el bucle del backend.
    *   **Solución:** Se reemplazó el bucle genérico por una serie de bloques `if` explícitos. Este enfoque actualiza cada campo de forma individual, eliminando la ambigüedad del `case` y asegurando que la actualización del "Nombre Completo" (y otros campos) se ejecute de manera fiable.

**C. Cambios Técnicos Implementados:**
- **`services/users/users.js`:** Se refactorizó por completo la lógica de actualización dentro de la función `handleUpdateUser` para usar bloques condicionales explícitos en lugar de un bucle genérico (Líneas 212-227).

**D. Impacto:**
- **Funcionalidad Crítica Restaurada:** La capacidad de editar y guardar correctamente el nombre completo de un usuario está ahora completamente restaurada y robustecida contra errores de `case-sensitivity`, garantizando la integridad de los datos del perfil de usuario.

**V8.4.4 - (CONFIG) - 09/01/2026**
**A. RESUMEN GENERAL:** Se actualizó la configuración del frontend para apuntar a la nueva URL de producción del microservicio de gestión de usuarios (`GPSpedia-Users`) tras una nueva iteración de despliegue.

**B. Cambios de Configuración:**
1.  **Actualización de Endpoint (`api-manager.js`):**
    *   **Motivo:** El servicio de usuarios fue redesplegado en una nueva URL para incorporar correcciones.
    *   **Cambio:** Se actualizó la constante `API_ENDPOINTS.USERS` con el nuevo endpoint proporcionado para asegurar que las solicitudes se dirijan a la versión más reciente del servicio.

**C. Cambios Técnicos Implementados:**
- **`api-manager.js`:** Se modificó la URL del endpoint para el servicio `USERS` (Línea 12).

**D. Impacto:**
- **Continuidad del Servicio:** El frontend ahora se comunica con el endpoint correcto y más actualizado del servicio de usuarios, asegurando que toda la funcionalidad de gestión de usuarios permanezca operativa.

**V8.4.3 - (BUG FIX) - 09/01/2026**
**A. RESUMEN GENERAL:** Se corrigió un bug crítico que impedía que el campo "Nombre Completo" de un usuario se guardara en la base de datos al crear o editar un perfil.

**B. Corrección Implementada:**
1.  **Bug de Escritura en Backend (`services/users/users.js`):**
    *   **Problema:** Al crear o editar un usuario, la información del campo "Nombre Completo" se enviaba correctamente desde el frontend pero era ignorada por el backend, resultando en que el campo nunca se escribía en la Google Sheet.
    *   **Causa Raíz:** Las funciones `handleCreateUser` y `handleUpdateUser` en el servicio de usuarios no incluían la lógica para procesar y guardar el campo `Nombre_Completo` que recibían en el payload.
    *   **Solución:** Se modificaron ambas funciones para que explícitamente lean el valor de `Nombre_Completo` del objeto de entrada y lo escriban en la columna correspondiente de la hoja de cálculo.

**C. Cambios Técnicos Implementados:**
- **`services/users/users.js`:**
    - Se añadió la lógica de escritura para `Nombre_Completo` en la función `handleCreateUser` (Línea 183).
    - Se actualizó la lógica de procesamiento en `handleUpdateUser` para asegurar que el campo `Nombre_Completo` se guarde al editar (Líneas 212-218).

**D. Impacto:**
- **Funcionalidad Esencial Restaurada:** La gestión de la información personal de los usuarios es ahora completamente funcional. Los administradores pueden crear y actualizar perfiles de usuario con su nombre completo, asegurando la integridad de los datos del sistema.

**V8.4.2 - (CONFIG) - 09/01/2026**
**A. RESUMEN GENERAL:** Se actualizó la configuración del frontend para apuntar a la nueva URL de producción del microservicio de gestión de usuarios (`GPSpedia-Users`).

**B. Cambios de Configuración:**
1.  **Actualización de Endpoint (`api-manager.js`):**
    *   **Motivo:** El servicio de usuarios fue desplegado en una nueva URL.
    *   **Cambio:** Se actualizó la constante `API_ENDPOINTS.USERS` con el nuevo endpoint proporcionado para asegurar que las solicitudes de gestión de usuarios se dirijan a la versión más reciente del servicio.

**C. Cambios Técnicos Implementados:**
- **`api-manager.js`:** Se modificó la URL del endpoint para el servicio `USERS` (Línea 12).

**D. Impacto:**
- **Continuidad del Servicio:** El frontend ahora se comunica con el endpoint correcto del servicio de usuarios, asegurando que la funcionalidad de inicio de sesión, creación, edición y eliminación de usuarios siga operativa tras el nuevo despliegue.

**V8.4.1 - (CRITICAL REGRESSION FIX) - 09/01/2026**
**A. RESUMEN GENERAL:** Se corrigieron tres regresiones críticas interconectadas en el módulo de gestión de usuarios que impedían la correcta visualización, actualización y eliminación de usuarios.

**B. Correcciones Implementadas:**
1.  **Bug de Visualización de "Nombre Completo" (`services/users/users.js`):**
    *   **Problema:** La tabla de usuarios mostraba el `SessionToken` en lugar del "Nombre Completo" del usuario.
    *   **Causa Raíz:** El mapeo de columnas (`COLS_USERS`) en el backend no estaba sincronizado con la estructura real de 8 columnas de la base de datos en Google Sheets.
    *   **Solución:** Se actualizó la constante `COLS_USERS` para reflejar el esquema correcto de 8 columnas, asignando `Nombre_Completo: 7` y `SessionToken: 8`.

2.  **Bug de Actualización de Usuario (`services/users/users.js`):**
    *   **Problema:** La edición de un usuario fallaba con el error "Usuario no encontrado para actualizar".
    *   **Causa Raíz:** Un conflicto de sensibilidad a mayúsculas/minúsculas (`case-sensitivity`). El backend enviaba el ID como `ID` (mayúsculas), pero el frontend (`users.html`) intentaba leerlo como `id` (minúsculas), enviando `undefined` de vuelta.
    *   **Solución:** Se modificó la función `handleGetUsers` en el backend para construir manualmente el objeto de respuesta, asegurando que la propiedad del identificador sea siempre `ID` (mayúsculas), coincidiendo con lo que el frontend espera.

3.  **Bug de Eliminación de Usuario (`services/users/users.js`):**
    *   **Problema:** La eliminación de un usuario fallaba de manera intermitente.
    *   **Causa Raíz:** Este era un síntoma secundario del mapeo de columnas incorrecto. La corrupción de datos interna impedía que la lógica de búsqueda y eliminación del backend funcionara de manera fiable.
    *   **Solución:** La corrección del mapeo de columnas (`COLS_USERS`) resolvió este problema al restaurar la integridad de los datos que maneja el servicio.

**C. Cambios Técnicos Implementados:**
- **`services/users/users.js`:**
    - Se actualizó el objeto `COLS_USERS` para un esquema de 8 columnas (Líneas 30-38).
    - Se refactorizó la función `handleGetUsers` para asegurar la consistencia del `ID` de usuario (Líneas 140-149).
- **`users.html`:** No se requirieron cambios; la lógica del frontend era correcta y los problemas se originaban en el backend.

**D. Impacto:**
- **Funcionalidad Crítica Restaurada:** El módulo de gestión de usuarios es ahora completamente funcional. Los administradores pueden ver, editar y eliminar usuarios de manera fiable, lo cual es esencial para la administración del sistema.
- **Integridad de Datos Asegurada:** Se ha restaurado la coherencia entre el backend y la base de datos, previniendo futuros errores de corrupción de datos.