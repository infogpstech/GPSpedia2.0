**v4.3.7 (31/12/2025)**
*   **FIX CRTICO (index.html):** Se solucion贸 un conjunto de regresiones cr铆ticas en la interfaz de usuario introducidas en v4.3.4, re-implementando los estilos y la l贸gica correctos basados en feedback detallado del usuario.
    *   **Carrusel de Motocicletas:** Se corrigi贸 la l贸gica de filtrado en `mostrarCategorias` para incluir tanto "motos" como "motocicletas", restaurando el carrusel de marcas de motocicletas que no se mostraba. (L铆nea 2351).
    *   **Estilo del Logo en Modal:** En `mostrarDetalleModal`, se ajust贸 el logo de la marca a la altura correcta de `55px` y se aplic贸 el efecto `drop-shadow` directamente a la imagen en lugar de a su contenedor, corrigiendo el error visual. (L铆nea 1746).
    *   **Imagen Principal del Veh铆culo:** Se redimension贸 la imagen principal del veh铆culo en el modal de detalle a una altura de `140px` y se le aplic贸 el efecto de sombra correcto, siguiendo las especificaciones de dise帽o. (L铆nea 1742).
    *   **Imagen de Corte a Ancho Completo:** Se asegur贸 que la imagen del corte (`imgCorte`) dentro del modal ocupe el 100% del ancho de su contenedor, solucionando el problema de tama帽o. (L铆nea 1789).

**v4.3.0 (15/01/2026)**
*   **FIX CRTICO (index.html, catalog.js, utilities.js):** Se solucion贸 la causa ra铆z final y persistente del fallo de renderizaci贸n de im谩genes de Google Drive en todo el sistema.
    *   **Causa Ra铆z:** Las funciones auxiliares que convert铆an URLs de Google Drive a formatos de thumbnail (`convertirAGoogleThumbnail` en el frontend y backend, y `getImageCreationDate` en utilities) utilizaban una expresi贸n regular que no era capaz de parsear todos los formatos de URL existentes en la base de datos (ej. URLs con `/view` o `/file/d/`).
    *   **Soluci贸n:** Se refactorizaron todas las instancias de esta l贸gica con una expresi贸n regular mucho m谩s robusta que ahora captura correctamente el ID del archivo desde m煤ltiples formatos de URL (`.../file/d/ID...`, `...id=ID...`, y `.../d/ID...`). Esto asegura una conversi贸n de URLs consistente y correcta en toda la aplicaci贸n.
        *   `index.html`: L铆neas 1943-1961
        *   `services/catalog/catalog.js`: L铆neas 346-362
        *   `services/utilities/utilities.js`: L铆neas 127-145, 192-210

**v4.2.9 (14/01/2026)**
*   **FIX (index.html):** Se solucion贸 un bug visual cr铆tico que imped铆a la renderizaci贸n de los logos de las marcas en la vista de selecci贸n de marcas.
    *   **Causa Ra铆z:** La funci贸n `mostrarMarcas` asignaba directamente la URL de Google Drive (`logoUrl`) al atributo `src` de la imagen, sin convertirla al formato de thumbnail requerido por el navegador para su correcta visualizaci贸n.
    *   **Soluci贸n:** Se envolvi贸 la variable `logoUrl` dentro de la funci贸n auxiliar `convertirAGoogleThumbnail` antes de asignarla al `src`. Esto asegura que la URL se formatee correctamente y que la imagen del logo se renderice como es debido. (L铆nea 2567).

**v4.2.8 (13/01/2026)**
*   **FIX (index.html):** Se solucion贸 la causa ra铆z del fallo en la renderizaci贸n de logos de marcas.
    *   **Causa Ra铆z:** La l贸gica anterior para encontrar logos (`getLogoUrlForMarca`) era demasiado r铆gida y se basaba en la concatenaci贸n de strings (ej. 'marca' + 'motocicletas'), lo que no coincid铆a con los nombres reales en la base de datos (ej. 'Honda Motocicletas').
    *   **Soluci贸n:** Se revirti贸 el fallback a texto y se refactoriz贸 `getLogoUrlForMarca` con un algoritmo de b煤squeda flexible. La nueva funci贸n normaliza los nombres, busca todas las coincidencias parciales que contienen el nombre de la marca y luego usa la categor铆a para desambiguar de forma inteligente entre variantes (ej. prioriza "motocicletas" si la categor铆a es "Motos"). Esto asegura que el logo correcto se encuentre siempre. (L铆neas 1901-1941, 2535-2565).
*   **FEAT (index.html):** Se implement贸 la l贸gica de frontend para la sugerencia de a帽o, completando el flujo de feedback del usuario.
    *   **Funcionalidad:** Despu茅s de que un usuario presiona el bot贸n "til" para registrar un "like", ahora se le presenta un `prompt` que le pregunta si el corte aplica a otro a帽o.
    *   **Implementaci贸n:** Si el usuario ingresa un a帽o v谩lido, la funci贸n `handleLike` invoca la acci贸n `suggestYear` en el backend para registrar la sugerencia. Se a帽adi贸 manejo de errores y validaci贸n de entrada para asegurar que solo se env铆en a帽os num茅ricos v谩lidos. (L铆neas 2933-2980).

**v4.2.7 (12/01/2026)**
*   **FIX (index.html):** Se implement贸 un mecanismo de fallback para la visualizaci贸n de marcas. Si los datos de los logos no est谩n disponibles en el backend (la variable `datosLogos` est谩 vac铆a), la funci贸n `mostrarMarcas` ahora renderizar谩 tarjetas de solo texto con los nombres de las marcas en lugar de mostrar im谩genes rotas. Esto asegura que la navegaci贸n siga siendo funcional y la experiencia de usuario sea fluida incluso con datos incompletos. (L铆neas 2535-2588).

**v4.2.6 (11/01/2026)**
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `CATALOG` a la nueva versi贸n desplegada proporcionada por el usuario. (L铆nea 10).

**v4.2.5 (10/01/2026)**
*   **FIX (index.html & services/catalog/catalog.js):** Se implement贸 una soluci贸n integral para el fallo persistente en la renderizaci贸n de logos de marcas.
    1.  **Backend (`services/catalog/catalog.js`):** Se corrigi贸 una inconsistencia cr铆tica en la funci贸n `doGet`. Se actualiz贸 el n煤mero de versi贸n reportado de `1.2.1` a `2.3.0` y se a帽adi贸 `LogosMarca` a la lista de hojas de c谩lculo accedidas en el modo debug. Esto asegura que la metadata del servicio refleje su funcionalidad real. (L铆neas 77, 79).
    2.  **Frontend (`index.html`):** Se robusteci贸 la funci贸n `mostrarMarcas`. Ahora incluye una comprobaci贸n defensiva que emite un `debugLog` si `datosLogos` est谩 vac铆o, alertando sobre problemas de datos. Adem谩s, se a帽adi贸 un manejador de eventos `onerror` a las im谩genes de los logos, que muestra una imagen de "Error" y registra un `debugLog` si la carga falla. (L铆neas 2535-2565).
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `FEEDBACK` a la nueva versi贸n desplegada y proporcionada por el usuario, restaurando la funcionalidad del sistema de Inbox y reportes. (L铆nea 12).

**v4.2.4 (09/01/2026)**
*   **FIX CRTICO (index.html):** Se solucion贸 una regresi贸n cr铆tica que imped铆a la carga del cat谩logo y causaba la p茅rdida de sesi贸n en cada recarga.
    *   **Causa Ra铆z:** Un error de `ReferenceError: updateCarousel is not defined` deten铆a la ejecuci贸n de JavaScript. La funci贸n `updateCarousel` se defin铆a dentro de un bloque `if` en la l贸gica del carrusel, pero era llamada por un `setTimeout` que se encontraba fuera de dicho bloque. Si la condici贸n del `if` no se cumpl铆a (p.ej., si hab铆a menos de 6 elementos en el carrusel), la funci贸n no se declaraba, provocando el error fatal.
    *   **Soluci贸n:** Se movi贸 la llamada `setTimeout(updateCarousel, 100)` dentro del bloque `if` para asegurar que solo se ejecute si la funci贸n `updateCarousel` ha sido definida. Esto previene el error y permite que la aplicaci贸n se inicialice correctamente. (L铆nea 2525).

**v4.2.3 (08/01/2026)**
*   **FIX (index.html):** Se corrigi贸 una regresi贸n cr铆tica introducida en la v4.2.0 que romp铆a la funcionalidad de la barra de b煤squeda.
    *   **Causa Ra铆z:** La funci贸n `mostrarResultadosBusquedaMarca` intentaba obtener la URL del logo de la marca usando `estado.categoria`, que es nulo o incorrecto en el contexto de una b煤squeda global. Esto provocaba un fallo en la renderizaci贸n de los resultados.
    *   **Soluci贸n:** Se modific贸 la llamada a `getLogoUrlForMarca` para pasar `null` como categor铆a, forzando a la funci贸n a usar su l贸gica de fallback para encontrar el logo gen茅rico de la marca, restaurando as铆 la funcionalidad. (L铆nea 2282).

**v4.2.2 (08/01/2026)**
*   **INFRA (api-manager.js):** Se actualizaron las URLs de los microservicios `CATALOG` y `UTILITIES` a las nuevas versiones desplegadas y proporcionadas por el usuario, asegurando que el frontend se comunique con los endpoints m谩s recientes. (L铆neas 10, 14).

**v4.2.1 (07/01/2026)**
*   **FIX (catalog.js & index.html):** Se corrigi贸 un bug funcional en el ordenamiento de categor铆as. La versi贸n anterior calculaba la popularidad pero no la aplicaba.
    1.  **Backend (`services/catalog/catalog.js`):** Se a帽adi贸 la l贸gica para ordenar la lista de categor铆as por `vehicleCount` (descendente) antes de enviarla al frontend. (L铆neas 220-221).
    2.  **Frontend (`index.html`):** Se elimin贸 el ordenamiento alfab茅tico (`.sort()`) que se aplicaba en el cliente, asegurando que el orden del backend sea respetado. Se modific贸 la funci贸n `mostrarCategorias` para usar la nueva lista `sortedCategoriesList` recibida. (L铆neas 1611, 1458, 2326-2332).
*   **FEAT (services/utilities/utilities.js):** Se a帽adi贸 una nueva funcionalidad al servicio de utilidades para obtener la fecha de creaci贸n de una imagen a partir de su URL de Google Drive.
    1.  **Helper Function:** Se cre贸 una nueva funci贸n auxiliar `getImageCreationDate(url)` que extrae el ID del archivo de la URL, accede al archivo mediante `DriveApp` y devuelve su fecha de creaci贸n en formato ISO. (L铆neas 105-128).
    2.  **API Endpoint:** Se expuso esta funcionalidad a trav茅s de una nueva acci贸n `getImageCreationDateFromUrl` en el `doPost`, permitiendo que sea invocada de forma segura desde el frontend (requiere rol 'Desarrollador'). (L铆neas 66-72).

**v4.2.0 (06/01/2026)**
*   **FEAT (feedback.js):** Se refactoriz贸 completamente la l贸gica de `handleSuggestYear` para cumplir con los nuevos requisitos de negocio. La funci贸n ahora requiere 3 votos de usuarios para aplicar un cambio y ejecuta una comprobaci贸n anti-colisi贸n para prevenir el solapamiento de rangos de a帽os entre diferentes generaciones de un mismo modelo.
*   **REFACTOR (catalog.js):** Se centraliz贸 la l贸gica de conversi贸n de URLs de Google Drive a thumbnails en el backend. La nueva funci贸n `convertirAGoogleThumbnail` ahora procesa todas las URLs de im谩genes antes de enviarlas al frontend, mejorando el rendimiento y la consistencia.
*   **UX (index.html):** Se implementaron m煤ltiples mejoras en la interfaz de usuario:
    *   **Layout Principal:** Se reorganiz贸 la p谩gina principal para mostrar primero la secci贸n "ltimos Agregados" y luego las "Categor铆as".
    *   **Carrusel:** La secci贸n "ltimos Agregados" es ahora un carrusel que muestra 6 tarjetas.
    *   **Navegaci贸n por Marca:** La vista de selecci贸n de marca ahora muestra los logos en lugar de texto.
    *   **Modal de Detalles:** Se unific贸 la funcionalidad de "like" y "sugerir a帽o" en el bot贸n "til" (). Se a帽adieron placeholders de edici贸n "in-modal" para campos sin datos.
*   **CHORE:** Las modificaciones se realizaron de forma segura, sin alterar la l贸gica cr铆tica protegida de `auth.js` (sesiones) ni `catalog.js` (carga de datos y cach茅).

**v4.1.1 (05/01/2026)**
*   **FIX (index.html):** Se restaur贸 la l贸gica para el bot贸n de instalaci贸n de la PWA (`beforeinstallprompt` listener y el handler del click), que fue eliminada accidentalmente en una refactorizaci贸n previa. Esto soluciona una regresi贸n cr铆tica que imped铆a a los usuarios instalar la aplicaci贸n. (L铆neas 2315-2346).
*   **INFRA (api-manager.js):** Se actualiz贸 la URL del microservicio `GPSpedia-Utilities` a la nueva versi贸n desplegada y funcional, eliminando el endpoint placeholder. (L铆nea 14).

**v4.1.0 (04/01/2026)**
*   **FEAT (services/utilities/utilities.js & index.html):** Se implement贸 un nuevo microservicio `GPSpedia-Utilities` y la interfaz de frontend correspondiente para herramientas de administrador.
    1.  **Backend (`services/utilities/utilities.js`):** Creado el nuevo servicio con acciones protegidas (`migrateYearRanges`, `migrateTimestamps`) para migraciones de datos. (Archivo nuevo).
    2.  **Frontend (`index.html`):** A帽adido un modal "Herramientas de Desarrollador", accesible mediante un nuevo bot贸n en el men煤 lateral (visible solo para rol 'Desarrollador'). El modal incluye botones para ejecutar las migraciones y muestra la consola de depuraci贸n. (L铆neas 923-950, 2593-2625, 2772-2808).
    3.  **Infra (`api-manager.js`):** Registrado el nuevo endpoint `UTILITIES` y mapeadas las nuevas acciones. (L铆neas 14, 46-47).
*   **FEAT (services/feedback/feedback.js & index.html):** Se implement贸 un sistema de "Inbox" para la gesti贸n de feedback de usuarios.
    1.  **Backend (`services/feedback/feedback.js`):** A帽adidas nuevas acciones (`getFeedbackItems`, `replyToFeedback`, `markAsResolved`) para leer y gestionar los reportes de problemas y mensajes de contacto. (L铆neas 114-123, 342-423).
    2.  **Frontend (`index.html`):** A帽adido un modal de "Inbox", accesible mediante un nuevo bot贸n en el men煤 lateral (visible para roles 'Supervisor', 'Gefe', 'Desarrollador'). La UI permite ver, responder y resolver items de feedback. (L铆neas 907-921, 2582-2591, 2665-2770).
*   **FIX (users.html):** Solucionado un bug cr铆tico que causaba que los datos de los usuarios se mostrasen como "undefined" en la tabla de gesti贸n y en el modal de edici贸n. El problema se deb铆a a un desfase de may煤sculas y min煤sculas (`camelCase` en el frontend vs. `PascalCase_With_Underscores` en el backend). Se corrigi贸 el acceso a las propiedades en todo el archivo. (L铆neas 239-241, 273-279, 318-322, 339, 349-354).
*   **UX (index.html):** Se implementaron mejoras en la interfaz de usuario del modal de detalles del veh铆culo.
    1.  **Botones de Feedback:** Se redise帽aron los botones "til" y "Reportar" para que sean m谩s compactos, mostrando un 铆cono y texto sin un contenedor de bot贸n grande. (L铆neas 1769-1782).
    2.  **Video Gu铆a:** La secci贸n "Video Gu铆a de Desarme" ahora se muestra dentro de un acorde贸n colapsable, igual que el resto de la informaci贸n suplementaria. (L铆neas 1844-1853).
*   **CHORE:** No se introdujeron regresiones en las funcionalidades estables (login, sesi贸n, carga de cat谩logo, cach茅).

**v4.0.2 (03/01/2026)**
*   **DOCS (Auditoria.txt & README.md):** Se realiz贸 una auditor铆a completa del sistema y se sincroniz贸 la documentaci贸n para reflejar el estado real del c贸digo.
    1.  **Auditor铆a (`Auditoria.txt`):** Se sobrescribi贸 el archivo con un nuevo reporte confirmando que el c贸digo fuente es funcional y no presenta los bugs cr铆ticos listados en la documentaci贸n. Se identific贸 el `README.md` como la fuente de la inconsistencia.
    2.  **Sincronizaci贸n (`README.md`):** Se actualizaron los checklists en la secci贸n "Bugs y Regresiones Cr铆ticas" para marcar como completados `[X]` los siguientes puntos, que ya estaban resueltos en el c贸digo: "L贸gica del Modal de Detalle", "Carga de Im谩genes en Modal" y "Carga de Logos en Modal". (L铆neas 231-233).

**v4.0.1 (02/01/2026)**
*   **FIX CRTICO (api-manager.js & services/catalog/catalog.js):** Solucionado un error de "Fallo de conexi贸n" (Failed to fetch) con el servicio de cat谩logo. El fix integral incluy贸:
    1.  **Backend (`services/catalog/catalog.js`):** Se cambi贸 el `MimeType` de la respuesta de `JSON` a `TEXT` para cumplir con la pol铆tica de CORS del entorno de Google Apps Script. (L铆neas 112, 124).
    2.  **Frontend (`api-manager.js`):** Se actualiz贸 la l贸gica de `routeAction` para procesar la respuesta como texto (`.text()`) y luego parsearla (`JSON.parse()`), en lugar de usar directamente `.json()`. (L铆neas 83-84).
*   **INFRA (api-manager.js):** Se ha actualizado la URL del microservicio `GPSpedia-Catalog` a la nueva versi贸n desplegada proporcionada por el usuario. (L铆nea 12).
*   **FIX (index.html):** Se corrigi贸 la l贸gica del modal de detalles (`mostrarDetalleModal`). Ahora, el corte recomendado se muestra de forma visible por defecto, mientras que los cortes adicionales se presentan en secciones desplegables (acorde贸n), cumpliendo con los requisitos de la auditor铆a. (L铆neas 1709-1811).
*   **FIX (index.html):** Solucionado un bug que imped铆a la visualizaci贸n de im谩genes suplementarias en el modal de detalles. Se a帽adi贸 la l贸gica para renderizar las im谩genes de apertura, cable de alimentaci贸n y diagramas de relay en sus correspondientes secciones. (L铆neas 1750-1768, 1829-1875).

**v4.0.0 (02/01/2026)**
*   **FIX CRTICO (services/catalog/catalog.js):** Se ha solucionado el error `cannot read properties of undefined (reading 'categoria')` que imped铆a la carga de datos del cat谩logo y de los formularios. Se implement贸 la funci贸n `mapRowToObject` que faltaba y se corrigi贸 `handleGetDropdownData` para leer din谩micamente las opciones de "Categor铆a" desde las reglas de validaci贸n de la hoja de c谩lculo.
*   **FIX CRTICO (services/users/users.js):** Se ha reparado el servicio de gesti贸n de usuarios, que fallaba en todas sus operaciones (`Failed to fetch`). El error se deb铆a a que la funci贸n `doPost` no retornaba ninguna respuesta. Se corrigi贸 la funci贸n para asegurar que todas las acciones devuelvan un resultado al frontend.
*   **REFACTOR & FEAT (index.html):** Se ha eliminado la p谩gina `info.html` y su contenido se ha integrado directamente en `index.html` como modales.
    *   Las secciones "Sobre Nosotros", "Cont谩ctanos" y "Preguntas Frecuentes" ahora se abren como pop-ups sin necesidad de recargar la p谩gina.
    *   Se ha a帽adido el nuevo contenido extendido a estas secciones.
    *   Se a帽adi贸 un peque帽o margen al CSS del pie de p谩gina para mejorar la separaci贸n visual de los enlaces.
*   **FIX (index.html):** Se ha corregido el env铆o del formulario de contacto, que fallaba por un error tipogr谩fico en el nombre de la acci贸n (`sendContacForm` -> `sendContactForm`).
*   **CHORE (project):** Se han actualizado los n煤meros de versi贸n en todos los archivos modificados a `4.0.0` (global) y a las versiones de componente correspondientes.