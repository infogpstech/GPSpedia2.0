**V8.2.9 - (FEATURE & REFACTOR) - 11/01/2024**
**A. RESUMEN GENERAL:** Se implementaron las correcciones funcionales y de apariencia identificadas en la auditoría del 11/01/2024, restaurando la funcionalidad de la página de gestión de usuarios y mejorando significativamente la UX y la presentación del modal de detalles del vehículo.

**B. Correcciones y Mejoras (Full-Stack):**
1.  **Reparación de Gestión de Usuarios (`users.html`):**
    *   **Causa Raíz:** Se corrigió un error de ámbito de JavaScript que impedía que los botones "Editar" y "Eliminar" funcionaran.
    *   **Solución:** Se refactorizó la función `renderUserTable` para adjuntar `event listeners` mediante JavaScript en lugar de usar `onclick` en el HTML, resolviendo el problema de accesibilidad de las funciones del módulo.
    *   **Mejora de UX:** Se añadió un enlace "Volver al Catálogo" en la parte superior de la página para mejorar la navegación.

2.  **Reestructuración del Modal de Detalles (`ui.js`):**
    *   **Corte Recomendado:** Se modificó la lógica para que el corte con más votos se muestre siempre visible y fuera de la estructura de acordeón.
    *   **Encabezado del Modal:** Se reordenó la lógica de renderizado para que el logo de la marca aparezca a la izquierda del título del vehículo, como se especifica.
    *   **Funcionalidad de Relay:** Se implementó la lógica completa para la configuración de Relay. Ahora, si no hay datos, se muestra "Sin Relay". Si hay una configuración, se muestra un botón con el nombre de la misma, que al ser presionado abre un segundo modal con el diagrama del relay.

3.  **Ajustes de Estilo (`style.css`):**
    *   **Tamaño de Imágenes:** Se ajustaron las reglas de CSS para reducir el tamaño de la imagen del vehículo en el modal y para asegurar que la imagen del corte ocupe el 80% del ancho en dispositivos móviles.
    *   **Botón de Relay:** Se añadieron nuevos estilos para dar la apariencia de un enlace al botón de configuración del relay.

**C. Cambios Técnicos Implementados:**
- **`users.html`:** Se refactorizó la función `renderUserTable` para usar `addEventListener` y se añadió un enlace de retorno.
- **`ui.js`:** Se refactorizó `mostrarDetalleModal` para separar el corte recomendado, reordenar el encabezado e implementar la lógica del modal de relay. Se añadieron las funciones auxiliares `renderCutContent` y `renderRelayInfoModal`.
- **`style.css`:** Se modificaron las clases `.img-vehiculo-modal` y `.img-corte` y se añadió la clase `.btn-link`.

**D. Impacto:**
-   **Restaura Funcionalidad Crítica:** La gestión de usuarios vuelve a ser completamente funcional.
-   **Mejora la Experiencia de Usuario:** El modal de detalles es ahora más intuitivo, se alinea con las especificaciones de diseño y proporciona una nueva funcionalidad interactiva para los diagramas de relay.

**V8.2.8 - (CRITICAL HOTFIX) - 10/01/2024**
**A. RESUMEN GENERAL:** Se corrigió un error crítico de enrutamiento en la configuración de la API (`api.js`) que causaba que el formulario de "Agregar Vehículo" fallara con el error "Acción desconocida: checkVehicle".

**B. Corrección Crítica (API Frontend):**
    1.  **Error de Enrutamiento en `api.js`:** Se identificó que la acción `checkVehicle` estaba incorrectamente mapeada al microservicio `CATALOG` en el `ACTION_TO_SERVICE_MAP`.
    2.  **Causa Raíz:** La lógica para verificar si un vehículo existe es una operación de pre-escritura y pertenece al servicio `WRITE`, no al servicio de solo lectura `CATALOG`. El enrutamiento incorrecto hacía que la llamada llegara a un servicio que no reconocía la acción.
    3.  **Solución:** Se corrigió el mapa de enrutamiento en `api.js`, reasignando la acción `checkVehicle` (y la acción relacionada `getSuggestion`) al servicio correcto: `WRITE`.

**C. Cambios Técnicos Implementados:**
    - **`api.js`:**
        - Se corrigió la entrada para `checkVehicle` en `ACTION_TO_SERVICE_MAP` para que apunte a `'WRITE'`.
        - Se corrigió la entrada para `getSuggestion` para que apunte a `'WRITE'`.

**D. Impacto:**
    -   **Restaura la Funcionalidad de Verificación de Vehículos:** Esta corrección es fundamental para el flujo de agregar nuevos registros, ya que permite que el primer paso de verificación funcione correctamente.
    -   **Alineación Arquitectónica:** Asegura que las acciones de la API se enruten a los microservicios correctos según su responsabilidad lógica (lectura vs. escritura).

**V8.2.7 - (CRITICAL HOTFIX) - 10/01/2024**
**A. RESUMEN GENERAL:** Se corrigió un error fatal en el formulario para agregar vehículos (`add_cortes.html`) que impedía su funcionamiento. Este error es idéntico al que se solucionó previamente en la página de gestión de usuarios.

**B. Corrección Crítica (Frontend):**
    1.  **Error de Ámbito (Scope) en `add_cortes.html`:** Al igual que en `users.html`, se identificó que el script de la página no estaba configurado como un módulo (`type="module"`), lo que impedía la importación de la función `routeAction`.
    2.  **Causa Raíz:** El script intentaba llamar a `routeAction` sin haberla importado desde `api.js`, causando un `ReferenceError` que bloqueaba toda la funcionalidad del formulario.
    3.  **Solución:** Se modernizó el script de `add_cortes.html` convirtiéndolo en un módulo. Se añadió `type="module"` a la etiqueta `<script>` y se incluyó `import { routeAction } from './api.js';`, solucionando el error.

**C. Cambios Técnicos Implementados:**
    - **`add_cortes.html`:**
        - Se añadió `type="module"` a la etiqueta `<script>`.
        - Se importó la función `routeAction` desde `api.js`.
        - Se eliminó la referencia al script obsoleto `api-manager.js`.

**D. Impacto:**
    -   **Restaura la Funcionalidad de Agregar Vehículos:** Esta corrección es crítica para restaurar una de las funcionalidades principales de la aplicación, permitiendo a los usuarios agregar nuevos vehículos y cortes al catálogo.
    -   **Consistencia Arquitectónica:** Se completa la alineación de todas las páginas con la arquitectura de módulos de JavaScript, mejorando la mantenibilidad y consistencia general del frontend.

**V8.2.6 - (CRITICAL HOTFIX) - 10/01/2024**
**A. RESUMEN GENERAL:** Se corrigió un error fatal en la página de gestión de usuarios (`users.html`) que impedía la ejecución de cualquier acción (crear, editar, eliminar) debido a un error de JavaScript "routeAction is not defined".

**B. Corrección Crítica (Frontend):**
    1.  **Error de Ámbito (Scope) en `users.html`:** Se identificó que el script de la página no estaba configurado como un módulo de JavaScript (`type="module"`), lo que impedía que pudiera importar funciones de otros archivos.
    2.  **Causa Raíz:** El script intentaba llamar a la función `routeAction` sin haberla importado previamente desde `api.js`, causando un error de referencia que detenía toda la funcionalidad.
    3.  **Solución:** Se modernizó el script de `users.html` convirtiéndolo en un módulo. Se añadió `type="module"` a la etiqueta `<script>` y se incluyó la línea `import { routeAction } from './api.js';` al principio del código, haciendo que la función `routeAction` esté disponible y solucionando el error.

**C. Cambios Técnicos Implementados:**
    - **`users.html`:**
        - Se añadió `type="module"` a la etiqueta `<script>`.
        - Se importó la función `routeAction` desde `api.js`.
        - Se eliminó una etiqueta `<script>` obsoleta que apuntaba a un archivo inexistente.

**D. Impacto:**
    -   **Restaura la Funcionalidad de Gestión de Usuarios:** Esta corrección es crítica para restaurar por completo la funcionalidad de la página de gestión de usuarios, permitiendo a los administradores crear, editar, eliminar y cambiar contraseñas de los usuarios.
    -   **Alineación Arquitectónica:** Alinea la página `users.html` con la arquitectura de módulos de JavaScript utilizada en el resto de la aplicación, mejorando la consistencia y mantenibilidad del código.

**V8.2.5 - (CRITICAL HOTFIX & RE-ARCHITECTURE) - 10/01/2024**
**A. RESUMEN GENERAL:** Se implementó un cambio de arquitectura fundamental en el manejo de imágenes para solucionar de forma definitiva el problema de las imágenes rotas. Se eliminó la dependencia del servicio intermediario (`IMAGE`) y ahora el frontend construye las URLs de las imágenes de Google Drive directamente.

**B. Cambio de Arquitectura (Frontend):**
    1.  **Eliminación del Proxy de Imágenes:** Se abandonó el uso del microservicio `IMAGE` como proxy. La depuración demostró que este intermediario, a pesar de las correcciones de permisos y despliegue, seguía siendo un punto de fallo persistente.
    2.  **Construcción Directa de URLs:** Se reimplementó la función `getImageUrl(fileId)` en `api.js`. Ahora, en lugar de llamar a nuestro servicio, construye una URL pública de Google Drive utilizando el formato `https://drive.google.com/thumbnail?id={ID}`.
    3.  **Causa Raíz Final:** La directiva del usuario de que el frontend debía ser el encargado de construir la URL fue la clave para resolver el problema, indicando que la estrategia de usar un proxy era incorrecta desde el principio.

**C. Cambios Técnicos Implementados:**
    - **`api.js`:**
        - Se reescribió por completo la función `getImageUrl` para generar URLs de miniaturas de Google Drive.
        - Se eliminó la constante `API_ENDPOINTS.IMAGE`, ya que es obsoleta.

**D. Impacto:**
    -   **Solución Definitiva a las Imágenes Rotas:** Este cambio elimina el punto de fallo del backend y permite que el navegador cargue las imágenes directamente desde los servidores de Google, lo cual es una solución más robusta y estándar. Se espera que todas las imágenes de la aplicación ahora se carguen correctamente.
    -   **Simplificación de la Arquitectura:** Se reduce la complejidad del sistema al eliminar un microservicio intermediario innecesario.
