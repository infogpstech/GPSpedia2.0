**CHANGES LOG - 04/02/2026**

**Archivo: index.html**
- **Línea 1:** Actualización de versión a v4.9.18.

**Archivo: main.js**
- **Líneas 112-124:** Restauración y unificación de listeners de navegación (#menu-cortes, #menu-tutoriales, #menu-relay).
- **Líneas 127-152:** Implementación robusta de Modo Oscuro con persistencia en localStorage e intercambio dinámico de logo.
- **Líneas 62-72:** Estabilización de la clase 'search-active' mediante searchBlurTimeout (250ms).
- **Líneas 206-214:** Restauración del listener para el botón Dashboard (#dashboard-btn).

**Archivo: style.css**
- **Línea 55:** Aumento del padding inferior en .container (20px -> 80px) para evitar que el footer bloquee el carrusel de marcas.
- **Línea 1015-1025:** Ajuste de layout en .footer (margin-top: 0 y flex-shrink: 0) para estabilizar la posición al final del viewport.

**Estado de la Tarea:** COMPLETADA.

**CHANGES LOG - 04/02/2026**

**Archivo: users.html**
- **Líneas 436-455:** Implementada obtención robusta de `userId` (ID/id) y validación en el frontend para cambio de contraseña.
- **Líneas 18-70:** Ajustes de CSS (box-sizing, padding, width: max-content) para asegurar que la tabla de usuarios no reduzca fuentes ni márgenes en móviles.

**Archivo: services/users/users.js**
- **Líneas 281-295:** Corregida lógica de backend para cambio de contraseña: comparación case-sensitive y ID string-matching.

**Versión:** Incremento a v4.9.20.

**CHANGES LOG - 04/02/2026**

**Archivo: api-config.js**
- **Línea 12:** Actualizado el endpoint del servicio `USERS` al nuevo URL proporcionado por el usuario.

**Archivo: users.html**
- **Líneas 33-70:** Se redujeron los márgenes internos de `.profile-section`, `.user-management-section` y las celdas de la tabla para un diseño más compacto. Se ajustó el tamaño de fuente de la tabla a `0.9rem`.

**Versión:** Incremento a v4.9.21.

**CHANGES LOG - 04/02/2026**

**Archivo: users.html**
- **Línea 188:** Se renombró el ID del campo de contraseña de `password-modal` a `user-password` en el formulario de creación/edición de usuario.
- **Línea 191:** Se mantuvo el ID `password-modal` exclusivamente para el div del modal de cambio de contraseña, resolviendo un conflicto de duplicidad de IDs que impedía la apertura del modal.
- **Línea 394:** Actualizada la referencia en el script para capturar el valor de la contraseña usando el nuevo ID `user-password`.

**Versión:** Incremento a v4.9.22.

**CHANGES LOG - 04/02/2026**

**Archivo: services/users/users.js**
- Líneas 90-128: Implementada función `getVerifiedSession` para centralizar la validación de tokens y obtención de `userId` y `role`.
- Líneas 142-154: Refactorizada la lógica de `handleGetUsers` para filtrar el listado según el rol del solicitante (Jefe solo ve Supervisor/Tecnico, Supervisor solo ve Tecnico).
- Líneas 230-245: Actualizada la lógica de `handleUpdateUser` para prohibir el cambio de nombre de usuario y aplicar RBAC estricto en la modificación de roles.
- Líneas 303-324: Añadida función `handleUpdateProfile` para permitir a los usuarios editar su propio nombre completo, con validación de propiedad de sesión.
- Líneas 334-342: Reforzada la seguridad en `handleChangePassword` mediante la verificación de que el `userId` autenticado coincide con el solicitado.

**Archivo: users.html**
- Líneas 140-143: Añadido botón "Editar" para el nombre completo en la sección "Mi Perfil".
- Líneas 199-211: Implementado modal `name-modal` para la edición del nombre del perfil.
- Líneas 386: Deshabilitado el campo `username-modal` en el modal de edición de usuarios para cumplir con la restricción de no cambio de username.
- Líneas 397: Actualizada la lógica de roles disponibles para roles 'Gefe' (Jefe) y 'Supervisor'.
- Líneas 488-511: Implementada función `handleEditNameSubmit` para procesar el cambio de nombre del perfil propio.

**Versión:** Incremento a v4.9.23.
