**V4.9.5 - (HEADER REGRESSION FIX) - 02/02/2026**
**A. RESUMEN GENERAL:** Se corrigieron las regresiones funcionales y visuales introducidas tras la reconstrucción del encabezado. Se restauró el botón hamburguesa, el botón de limpieza de búsqueda y el gesto pull-to-refresh.

**B. Cambios Implementados:**

1.  **Restauración de Interactividad (style.css):**
    *   **Descripción:** Se incrementó el `z-index` del `#hamburger-btn` (Línea 218) y se forzó la visibilidad del logo en modo búsqueda activa (Línea 408) para corregir el conflicto de ocultamiento.
2.  **Lógica Funcional de Búsqueda (main.js):**
    *   **Descripción:** Se implementó el toggle de la clase `.has-text` para el botón "X" y se vinculó su evento `click` para limpiar el input (Líneas 41-54).
3.  **Restauración de Gesto de Recarga (main.js):**
    *   **Descripción:** Se re-implementó manualmente el gesto "Pull-to-refresh" utilizando eventos de touch en el contenedor principal (Líneas 105-120).
4.  **Sincronización de Versión:**
    *   **Descripción:** Se normalizó la versión a la v4.9.5 en `index.html`, `README.md` y `ui.js`.

**V4.9.4 - (HEADER ANIMATIONS RESTORE) - 02/02/2026**
**A. RESUMEN GENERAL:** Se restauraron todas las animaciones y transiciones del encabezado y el botón hamburguesa, manteniendo la corrección del "espacio fantasma" lograda en la reconstrucción estructural anterior.

**B. Cambios Implementados:**

1.  **Restauración de Transiciones de Búsqueda (`style.css`):**
    *   **Descripción:** Se reemplazó el uso de `display: none` por una combinación de `opacity`, `visibility`, `transform` y `max-height: 0`. Esto permite que el header superior se colapse suavemente durante la búsqueda sin dejar huecos muertos.
    *   **Líneas Afectadas:** 353-366.

2.  **Visibilidad del Botón Hamburguesa (`style.css`):**
    *   **Descripción:** Se ajustaron los estilos de `#hamburger-btn` para asegurar su visibilidad y funcionalidad en dispositivos móviles, integrando transiciones de entrada/salida fluidas.
    *   **Líneas Afectadas:** 207-213.

3.  **Animación del Logo (`style.css`):**
    *   **Descripción:** Se re-implementó la lógica de animación del logo para que se desvanezca en su posición original y aparezca en la barra de búsqueda de forma coordinada y con efectos de sombra adecuados.
    *   **Líneas Afectadas:** 85, 403-414.

**C. Impacto:**
- **Experiencia de Usuario:** Se recupera la fluidez original del sistema, eliminando saltos visuales bruscos.
- **Funcionalidad Móvil:** El menú lateral vuelve a ser accesible mediante el botón hamburguesa.
- **Integridad Visual:** El logo es visible y se integra correctamente en el flujo de búsqueda.

**V4.9.3 - (EXTREME HEADER REBUILD) - 02/02/2026**
**A. RESUMEN GENERAL:** Se realizó una reconstrucción estructural profunda del encabezado y sistema de búsqueda para eliminar definitivamente el "espacio fantasma" y conflictos de layout acumulados, garantizando un código limpio y modular sin alterar el diseño visual.

**B. Cambios Implementados:**

1.  **Reconstrucción HTML del Header (`index.html`):**
    *   **Descripción:** Se reemplazó la estructura fragmentada por un contenedor maestro único `.main-header`. Se unificó el Branding, controles de usuario y buscador en una jerarquía lógica y semántica.
    *   **Líneas Afectadas:** 87-120.

2.  **Rediseño del Layout CSS (`style.css`):**
    *   **Descripción:** Se centralizaron todos los estilos en un bloque dedicado al Header. Se implementó una lógica de colapso total mediante `display: none !important` para elementos no esenciales en modo búsqueda, eliminando cualquier reserva de espacio "fantasma". Se ajustó el padding del `.container` para sincronizarse perfectamente con la altura de la barra fija.
    *   **Líneas Afectadas:** 72-130, 349-380.

3.  **Sincronización de Lógica UI (`ui.js`):**
    *   **Descripción:** Se ajustó la función `showApp` para inyectar el mensaje de bienvenida en la nueva estructura del header.
    *   **Líneas Afectadas:** 1200-1207.

**C. Impacto:**
- **Cero Espacio Fantasma:** La brecha entre la búsqueda y los resultados ha sido eliminada por completo mediante colapso estructural.
- **Mantenibilidad:** El código del header es ahora legible, predecible y libre de parches inline o reglas contradictorias.
- **Fidelidad Visual:** Se mantiene el 100% de la estética y animaciones originales requeridas por el proyecto.

**V4.9.1 - (MOBILE VIEWPORT FIX) - 02/02/2026**
**A. RESUMEN GENERAL:** Se implementó una solución arquitectónica para el manejo del viewport en dispositivos móviles, alineando el comportamiento con el estándar del proyecto.

**B. Cambios Implementados:**

1.  **Gestión Dinámica de Viewport (`main.js`):**
    *   **Descripción:** Se añadió lógica utilizando `window.visualViewport` para calcular la altura real visible de la pantalla, descontando el espacio ocupado por el teclado virtual. Se actualiza la variable CSS `--app-height` dinámicamente.
    *   **Líneas Afectadas:** 58-86.

2.  **Refactorización del Modelo de Scroll (`style.css`):**
    *   **Descripción:** Se cambió el scroll del `body` al contenedor principal `.container`. Se fijó la altura de `html` y `body` a `var(--app-height)`, eliminando el uso de `vh`.
    *   **Líneas Afectadas:** 2-15, 54-58.

3.  **Eliminación de Espacio Fantasma en Búsqueda (`style.css`, `index.html`):**
    *   **Descripción:** Se eliminó el estilo en línea `margin-bottom` en `index.html`. En CSS, se cambió `visibility: hidden` por `display: none` para la cabecera en modo `search-active`, colapsando el espacio vacío que antes se preservaba.
    *   **Líneas Afectadas en `index.html`:** 105.
    *   **Líneas Afectadas en `style.css`:** 374-376, 400.

4.  **Corrección de Alineación de Logo en Búsqueda (`style.css`):**
    *   **Descripción:** Se ajustó la posición del logo dentro del input de búsqueda para que esté perfectamente centrado y alineado con la nueva altura de la barra.
    *   **Líneas Afectadas:** 403, 422-426.

5.  **Migración de Unidades `vh` a Relativas (`style.css`):**
    *   **Descripción:** Se reemplazaron todas las ocurrencias de `90vh` por cálculos basados en `--app-height` para garantizar que los modales se ajusten correctamente al área visible real.
    *   **Líneas Afectadas:** 766, 1012.

**C. Impacto:**
- **Usabilidad Móvil:** Los resultados de búsqueda son ahora completamente visibles y scrolleables incluso con el teclado abierto.
- **Limpieza Visual:** Se ha eliminado el espacio muerto superior durante la búsqueda, maximizando el área útil.
- **Robustez:** El sistema de layout ahora es independiente de las inconsistencias de altura de los navegadores móviles.

**V4.9.1 - (MOBILE KEYBOARD LAYOUT FIX) - 01/02/2026**
**A. RESUMEN GENERAL:** Se implementó una solución integral para corregir el layout de la búsqueda en dispositivos móviles, previniendo que el teclado virtual oculte los resultados y eliminando el espacio vertical excesivo.

**B. Cambios Implementados:**

1.  **Implementación de Altura Fija y Consistente para la Barra de Búsqueda (`style.css`):**
    *   **Descripción:** Se estableció una altura fija de `55px` para el `.search-container` y se ajustaron los estilos internos (padding del input, posicionamiento del logo) para alinearse a esta nueva altura. Se añadió un fondo y sombra al contenedor en modo de búsqueda activa para mejorar la jerarquía visual.
    *   **Líneas Afectadas en `style.css`:** 172-175, 207, 401-428.

2.  **Ajuste Dinámico del Layout con `visualViewport` (`main.js`):**
    *   **Descripción:** Se añadió nueva lógica de JavaScript que escucha los eventos `resize` y `scroll` del `window.visualViewport`. Esta lógica calcula la altura visible real de la pantalla (descontando el teclado) y aplica un `max-height` dinámico al contenedor de resultados (`.container`), asegurando que siempre sea visible.
    *   **Líneas Afectadas en `main.js`:** 43-87.

3.  **Detección de Teclado y Limpieza de Listeners (`main.js`):**
    *   **Descripción:** Se implementó una función para detectar la presencia del teclado comparando `visualViewport.height` con `window.innerHeight`, añadiendo una clase `keyboard-open` al `body`. Se creó una función de limpieza (`cleanupSearchListeners`) que elimina todos los listeners y estilos en línea cuando el input de búsqueda pierde el foco, previniendo efectos residuales.
    *   **Líneas Afectadas en `main.js`:** 51-57, 63-69.

4.  **Optimización para Pantallas Pequeñas (`style.css`):**
    *   **Descripción:** Se añadió una nueva media query que ajusta la altura de la barra de búsqueda y el padding del contenido para pantallas con un ancho menor a 480px, optimizando el espacio vertical disponible.
    *   **Líneas Afectadas en `style.css`:** 431-449.

**C. Impacto:**
- **Funcionalidad en Móviles:** El layout de búsqueda ahora se adapta dinámicamente a la presencia del teclado virtual.
- **Consistencia Visual:** La barra de búsqueda tiene una altura predecible y consistente, eliminando el espacio vertical excesivo.
- **Robustez:** La gestión de listeners y estilos previene regresiones y asegura que el layout se restaure correctamente al finalizar la búsqueda.
**V4.9.0 - (DEFINITIVE ROOT CAUSE FIX) - 29/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas para las causas raíz de los problemas persistentes de visualización de video y espaciado de la barra de búsqueda, basadas en una auditoría correcta y consolidada del flujo de datos completo (backend y frontend).

**B. Cambios Implementados:**

1.  **Corrección de Contrato de Datos Backend-Frontend (Causa Raíz del Video):**
    *   **Problema:** El backend (`services/catalog/catalog.js`) enviaba la URL del video bajo la propiedad `videoGuiaDesarmeUrl`, pero el frontend (`ui.js`) esperaba una propiedad llamada `Video`. Esta discrepancia causaba que el frontend no encontrara el dato.
    *   **Solución (Backend):** Se modificó `services/catalog/catalog.js` para alinear el contrato de datos. Ahora, la propiedad se renombra a `Video` antes de enviar la respuesta al frontend.
    *   **Solución (Frontend):** Se robusteció la lógica en `ui.js` para manejar correctamente la URL del video recibida y se añadió una nueva función (`getYouTubeEmbedUrl`) para convertir de forma fiable cualquier formato de URL de YouTube a un formato `embed` válido, solucionando el problema de reproducción.
    *   **Líneas Afectadas en `catalog.js`:** 311-313.
    *   **Líneas Afectadas en `ui.js`:** 1041-1065 (nueva función), 1076.

2.  **Corrección de Espaciado de Búsqueda (Causa Raíz: Estilo en Línea):**
    *   **Problema:** Un estilo en línea (`margin-bottom: 10px;`) en el `div#search-wrapper` en `index.html` tenía mayor especificidad que las reglas en `style.css`, causando un espaciado persistente.
    *   **Solución:** Se añadió la directiva `!important` a la regla `body.search-active #search-wrapper { margin-bottom: 0; }` en `style.css`. Esto le otorga la máxima prioridad, permitiendo anular el estilo en línea y eliminar el espacio no deseado.
    *   **Líneas Afectadas en `style.css`:** 386.

**C. Impacto:**
- **Funcionalidad de Video Restaurada:** La video guía de desarme ahora se visualiza y reproduce correctamente, ya que el frontend recibe el dato en el formato esperado y lo procesa de forma robusta.
- **UI Corregida Definitivamente:** El espacio extra debajo de la barra de búsqueda ha sido eliminado por completo, logrando el diseño requerido.
- **Robustez del Sistema:** Se ha corregido una inconsistencia fundamental en el contrato de datos entre el backend y el frontend, haciendo el sistema más predec- **V4.8.9 - (ROOT CAUSE FIX) - 29/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas para las causas raíz de los dos problemas persistentes, basadas en los hallazgos de una auditoría consolidada y correcta que incluyó el `README.md`, el servicio de backend `catalog.js` y el frontend.

**B. Cambios Implementados:**

1.  **Corrección de Contrato de Datos (Backend y Frontend):**
    *   **Problema:** El backend (`services/catalog/catalog.js`) enviaba la URL del video bajo la propiedad `videoGuiaDesarmeUrl`, pero el frontend (`ui.js`) esperaba una propiedad `Video`.
    *   **Solución (Backend):** Se modificó `services/catalog/catalog.js` para que, después de procesar la URL del video, la asigne a una nueva propiedad `Video` y elimine la propiedad original `videoGuiaDesarmeUrl` antes de enviar la respuesta.
    *   **Solución (Frontend):** Se ajustó `ui.js` para que utilice consistentemente la propiedad `Video` al construir el modal de detalle, asegurando que el contrato de datos se cumpla en ambos extremos.
    *   **Líneas Afectadas en `catalog.js`:** 308-315 (aprox.).
    *   **Líneas Afectadas en `ui.js`:** 749, 752, 1046, 1049.

2.  **Corrección de Espaciado (CSS):**
    *   **Problema:** Un `margin-bottom: 10px` en un estilo en línea en `index.html` (en el `div#search-wrapper`) no estaba siendo anulado, causando un espacio persistente.
    *   **Solución:** Se añadió `!important` a la regla `body.search-active #search-wrapper { margin-bottom: 0; }` en `style.css` para darle la especificidad necesaria para anular el estilo en línea.
    *   **Líneas Afectadas en `style.css`:** 386.

**C. Impacto:**
- **Funcionalidad Restaurada:** La video guía de desarme ahora se visualiza correctamente en el modal de detalle, ya que el frontend recibe el dato esperado.
- **UI Corregida:** El espacio extra debajo de la barra de búsqueda en el estado activo ha sido eliminado por completo.
- **Robustez del Sistema:** Se ha corregido un error fundamental de inconsistencia de datos entre el frontend y el backend, haciendo el sistema más predecible.

**V4.8.8 - (DEFINITIVE FIX) - 28/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas y robustas para las fallas persistentes en el espaciado de la barra de búsqueda y la visualización de la video guía, abordando las causas raíz identificadas en una auditoría profunda.

**B. Cambios Implementados:**

1.  **Corrección de Espaciado de Búsqueda (Causa Raíz: Efecto Aditivo) (`style.css`):**
    *   **Problema:** Un `padding-bottom` heredado de una regla general (`.container`) persistía en el estado de búsqueda activa, creando un espacio no deseado.
    *   **Solución:** Se modificó la regla `body.search-active .container` para que defina explícitamente todos los valores de `padding` (`padding: 60px 20px 0;`). Esto anula por completo la regla general, eliminando el `padding-bottom` y corrigiendo el espaciado de manera definitiva.
    *   **Líneas Afectadas en `style.css`:** 393-396.

2.  **Corrección de Visualización de Video (Causa Raíz: Race Condition) (`ui.js`):**
    *   **Problema:** Una condición de carrera (`race condition`) causaba que la altura del panel del acordeón se calculara *antes* de que el `iframe` del video se cargara, resultando en un panel demasiado pequeño que ocultaba el video.
    *   **Solución:** Se refactorizó el `event listener` del `click` en `createAccordionSection`. La lógica ahora utiliza un `setTimeout` con un retardo de `0` milisegundos. Esto pospone la ejecución del cálculo de `scrollHeight` hasta el siguiente ciclo de eventos del navegador, dando tiempo al `iframe` para que comience a renderizarse y tenga dimensiones, resolviendo así la condición de carrera y asegurando que el panel se expanda a la altura correcta.
    *   **Líneas Afectadas en `ui.js`:** 1070-1085.

**C. Impacto:**
- **Solución Definitiva:** Se han resuelto las causas raíz de ambos problemas persistentes, no solo sus síntomas.
- **UI Correcta:** El espaciado de la barra de búsqueda ahora es preciso y funcional.
- **Funcionalidad Restaurada:** La video guía es ahora visible y el acordeón funciona de manera robusta y predecible, manejando correctamente el contenido dinámico como los `iframes`.

**V4.8.7 - (POST-COMMIT REGRESSION FIX) - 27/01/2026**
**A. RESUMEN GENERAL:** Se implementaron correcciones definitivas para múltiples fracasos funcionales y regresiones graves que fueron identificadas durante la revisión post-commit de la versión anterior.

**B. Cambios Implementados:**

1.  **Corrección del Espaciado de la Barra de Búsqueda (`style.css`):**
    *   **Problema:** Un commit anterior incrementó incorrectamente el espacio vertical entre la barra de búsqueda y los resultados, empeorando el problema que intentaba solucionar.
    *   **Solución:** Se ajustó la regla `body.search-active .container`. Se redujo el `padding-top` de `60px` a `20px`, un valor que compensa de manera precisa la altura de la barra de búsqueda fija sin crear un espaciado excesivo.
    *   **Líneas Afectadas en `style.css`:** 395.

2.  **Restauración de la Lógica del Acordeón (`ui.js`):**
    *   **Problema (Regresión):** El comportamiento del acordeón en el modal de detalle se rompió, permitiendo que múltiples paneles estuvieran abiertos simultáneamente.
    *   **Solución:** Se refactorizó el `event listener` del `click` en la función `createAccordionSection`. La nueva lógica ahora itera sobre todos los botones del acordeón dentro del mismo contenedor y cierra cualquier panel que no sea el que se ha clickeado, restaurando el comportamiento original de "solo un panel abierto a la vez".
    *   **Líneas Afectadas en `ui.js`:** 1070-1088.

3.  **Corrección de Visualización de Video Guía (`ui.js`):**
    *   **Problema:** El video guía no era visible porque el panel del acordeón que lo contenía no se expandía correctamente debido a la lógica de animación rota.
    *   **Solución:** La restauración de la lógica del acordeón (punto anterior) soluciona este problema de manera inherente. Al asegurar que el `max-height` del panel se calcule y aplique correctamente en el `click`, el panel ahora se expande como se espera, haciendo visible el `iframe` del video. La lógica de pausa y detención del video ahora funciona sobre un componente visible.
    *   **Líneas Afectadas en `ui.js`:** 1070-1088.

**C. Impacto:**
- **Funcionalidad y UI Corregidas:** Se han resuelto todas las regresiones y fracasos funcionales reportados. El espaciado de la búsqueda es ahora correcto, el acordeón del modal funciona según su diseño original, y el video guía es completamente accesible y funcional.

**V4.8.6 - (POST-COMMIT FIX) - 26/01/2026**
**A. RESUMEN GENERAL:** Se aplicaron correcciones a una Tarea Incompleta (espaciado de búsqueda) y a una Regresión Funcional (modal de video) identificadas durante la revisión post-commit.

**B. Cambios Implementados:**
1.  **Corrección de Espaciado en Búsqueda (`style.css`):**
    *   **Problema:** El contenido de los resultados de búsqueda quedaba oculto detrás de la barra de búsqueda cuando esta se encontraba en su estado fijo (`position: fixed`).
    *   **Solución:** Se restauró un `padding-top` (`60px`) a la regla `body.search-active .container`. Este padding desplaza el contenedor de contenido hacia abajo, compensando la altura de la barra de búsqueda y asegurando que los resultados sean completamente visibles.
    *   **Líneas Afectadas en `style.css`:** 393.

2.  **Restauración y Corrección del Acordeón de Video (`ui.js`):**
    *   **Problema:** Una modificación anterior en el `event listener` del acordeón rompió la animación de `max-height`, impidiendo que el panel se expandiera y, por lo tanto, que el video fuera visible.
    *   **Solución:** Se refactorizó la lógica del acordeón. Se restauró el `click` listener a su comportamiento original (solo gestiona el `max-height`) y se añadió un nuevo `event listener` para el evento `transitionend`. Este nuevo listener se encarga de pausar el video solo después de que la animación de cierre haya concluido, desacoplando la animación del control del video y restaurando la funcionalidad completa.
    *   **Líneas Afectadas en `ui.js`:** 1068-1087.

**C. Impacto:**
- **Funcionalidad de Búsqueda Restaurada:** Se ha corregido el layout durante la búsqueda activa, garantizando que los resultados sean siempre visibles y accesibles.
- **Funcionalidad del Modal Restaurada:** La video guía es ahora visible y el acordeón funciona con su animación original. El control de pausa y detención del video se ha mantenido, corrigiendo la regresión por completo.

**V4.8.5 - (UX/UI & FUNCTIONAL FIX) - 25/01/2026**
**A. RESUMEN GENERAL:** Se implementaron múltiples ajustes en la interfaz de usuario para mejorar las animaciones de la barra de búsqueda, optimizar el espaciado y corregir la funcionalidad del modal de detalle para incluir una video guía interactiva.

**B. Cambios Implementados:**

1.  **Suavizado de Animación de Búsqueda (`style.css`):**
    *   **Problema:** Los elementos del encabezado (botones de sección, menú hamburguesa) desaparecían de forma abrupta al activar la búsqueda.
    *   **Solución:** Se modificaron las reglas de CSS bajo `body.search-active`. Se eliminaron las propiedades que causaban un colapso instantáneo del layout (ej. `max-height: 0`, `!important`) y se refinaron las propiedades `opacity` y `transform` para asegurar una transición de desvanecimiento y deslizamiento suave y visualmente agradable.
    *   **Líneas Afectadas en `style.css`:** 371-383.

2.  **Reducción de Espaciado Vertical (`style.css`, `index.html`):**
    *   **Problema:** Existía un espacio vertical excesivo alrededor de la barra de búsqueda, reduciendo el área visible para los resultados.
    *   **Solución:**
        *   En `style.css`, se eliminó el `margin-bottom` y `padding` del selector `.search-container`.
        *   En `index.html`, se redujo el `margin-bottom` del `div` contenedor `#search-wrapper` de `20px` a `10px`.
    *   **Líneas Afectadas en `style.css`:** 166-167.
    *   **Líneas Afectadas en `index.html`:** 105.

3.  **Implementación de Video Guía en Modal (`ui.js`):**
    *   **Problema:** El modal de detalle solo mostraba un enlace al video en lugar de un reproductor embebido.
    *   **Solución:** Se modificó la función `createAccordionSection`. Ahora, en lugar de un enlace, genera un `<iframe>` de YouTube, añadiendo el parámetro `?enablejsapi=1` a la URL para permitir el control mediante JavaScript.
    *   **Líneas Afectadas en `ui.js`:** 1039-1050.

4.  **Control de Reproducción de Video (`ui.js`):**
    *   **Problema:** El video continuaría reproduciéndose si el acordeón se cerraba o si el modal se cerraba.
    *   **Solución:**
        *   Se añadió lógica al `event listener` del botón del acordeón para que, al colapsar la sección, envíe un comando `pauseVideo` al `iframe` a través de `postMessage`.
        *   Se modificó el `onclick` del botón de cerrar del modal (`mostrarDetalleModal`) para que envíe un comando `stopVideo` al `iframe`, deteniendo completamente la reproducción al salir.
    *   **Líneas Afectadas en `ui.js`:** 1061-1072 (pausa), 650-656 (detención).

**C. Impacto:**
- **Mejora de la Experiencia de Usuario (UX):** Las animaciones de búsqueda son ahora más fluidas y el layout más compacto, mejorando la interacción general.
- **Funcionalidad Corregida:** El modal de detalle ahora muestra correctamente la video guía en un reproductor interactivo que respeta las acciones del usuario, funcionando como se esperaba.
**V4.8.4 - (UI/UX FIX) - 24/01/2026**
**A. RESUMEN GENERAL:** Se implementó una corrección definitiva al problema de espaciado en la animación de la barra de búsqueda, eliminando completamente el espacio vertical entre la barra y los resultados.

**B. Cambios Implementados:**
1.  **Identificador Único para Contenedor de Búsqueda (`index.html`):**
    *   **Problema:** Un estilo en línea (`margin-bottom: 20px;`) en un `div` anónimo que envolvía el buscador causaba un espaciado persistente que no podía ser anulado por reglas de CSS generales.
    *   **Solución:** Se asignó un ID único, `search-wrapper`, a este `div` contenedor para permitir que sea objetivo de una regla de CSS específica y de alta prioridad.
    *   **Líneas Afectadas en `index.html`:** 105.

2.  **Anulación Específica de Estilos (`style.css`):**
    *   **Problema:** El espaciado no deseado persistía a pesar de los intentos anteriores de ajustar el `padding`.
    *   **Solución:** Se añadieron nuevas reglas de CSS para `body.search-active` que ahora anulan de manera precisa y definitiva los estilos que causaban el espacio:
        - Se añadió la regla `body.search-active #search-wrapper { margin-bottom: 0; }` para anular el margen inferior del contenedor.
        - Se modificó la regla `body.search-active .container` para que tenga `padding-top: 0;`, eliminando cualquier espaciado restante.
    *   **Líneas Afectadas en `style.css`:** 384-391.

**C. Impacto:**
- **Corrección Visual Definitiva:** Se ha eliminado por completo el espacio no deseado, logrando que los resultados de la búsqueda se muestren directamente debajo de la barra de búsqueda, tal como se requería.
- **Mejora de la Mantenibilidad:** La adición de un ID específico y una regla de CSS clara hace que el comportamiento del layout sea más predecible y fácil de mantener en el futuro.

**V4.8.3 - (UI/UX REFINEMENT) - 23/01/2026**
**A. RESUMEN GENERAL:** Se refinó la animación de la barra de búsqueda para optimizar el espacio en pantalla, especialmente en dispositivos móviles.

**B. Cambios Implementados:**
1.  **Ajustes de la Animación de Búsqueda (`style.css`):**
    *   **Problema:** Durante la animación de búsqueda, el botón de hamburguesa permanecía visible y el espacio entre la barra de búsqueda y los resultados era excesivo.
    *   **Solución:** Se realizaron dos ajustes en las reglas de CSS para `body.search-active`:
        - Se añadió el selector `#hamburger-btn` a la lista de elementos que se ocultan durante la animación.
        - Se redujo el `padding-top` del `.container` de `80px` a `60px` para disminuir el espacio vertical.
    *   **Líneas Afectadas en `style.css`:** 372, 385.

**C. Impacto:**
- **UI más Limpia:** La ocultación del botón de hamburguesa y la reducción del espacio superior proporcionan una vista más limpia y centrada en los resultados de la búsqueda.
- **Mejora de Usabilidad Móvil:** Se maximiza el espacio vertical disponible para los resultados, mejorando la experiencia cuando el teclado virtual está desplegado.

**V4.8.2 - (UI/UX IMPROVEMENT) - 23/01/2026**
**A. RESUMEN GENERAL:** Se implementó la animación de la barra de búsqueda para replicar el comportamiento de la v1.5, mejorando la experiencia de usuario, especialmente en dispositivos móviles.

**B. Cambios Implementados:**
1.  **Implementación de la Animación de Búsqueda (`main.js`):**
    *   **Problema:** La barra de búsqueda no tenía ninguna animación al ser seleccionada, lo que dificultaba la visualización de resultados en pantallas pequeñas cuando el teclado virtual estaba activo.
    *   **Solución:** Se añadieron dos nuevos `event listeners` al `searchInput` en la función `initializeApp`:
        - `focus`: Añade la clase `search-active` al `<body>`, activando los estilos CSS que expanden la barra de búsqueda, ocultan el encabezado y reposicionan el logo.
        - `blur`: Elimina la clase `search-active` del `<body>` con un retardo de 200ms, permitiendo que los clics en los resultados se registren antes de que la animación se revierta.
    *   **Líneas Afectadas en `main.js`:** 42-56.

**C. Impacto:**
- **Experiencia de Usuario Mejorada:** La animación proporciona más espacio para los resultados de la búsqueda, evitando que el teclado en pantalla los oculte.
- **Consistencia Visual:** El comportamiento de la barra de búsqueda ahora es consistente con la versión de referencia (`v1.5`), cumpliendo con los requisitos de diseño.

**V4.8.1 - (AUTH STABILITY FIX) - 22/01/2026**
**A. RESUMEN GENERAL:** Se implementó una corrección para un bug crítico que causaba el cierre inesperado de la sesión del usuario después de múltiples recargas de la página.

**B. Cambios Implementados:**
1.  **Prevención de Condición de Carrera en `checkSession` (`auth.js`):**
    *   **Problema:** Múltiples recargas rápidas o pestañas abiertas iniciaban procesos de validación de sesión (`checkSession`) concurrentes. Esto provocaba una condición de carrera en la que la validación de una pestaña podía hacer que el backend invalidara el token que otra pestaña estaba usando, resultando en un `logout` forzado.
    *   **Solución:** Se introdujo un mecanismo de "bloqueo" (`lock`) utilizando `localStorage`. Antes de iniciar una validación de sesión, la función ahora establece una marca de tiempo. Si otra instancia de la aplicación intenta validar mientras el bloqueo está activo (y no ha expirado), omitirá su propia validación, evitando la llamada conflictiva al backend. El bloqueo se libera una vez que la validación (exitosa o fallida) se completa.
    *   **Líneas Afectadas en `auth.js`:** 60-98.

**C. Impacto:**
- **Estabilidad de la Sesión:** Se ha eliminado la condición de carrera, asegurando que la sesión del usuario se mantenga estable y persistente incluso bajo condiciones de recargas rápidas o uso en múltiples pestañas. Se mejora significativamente la fiabilidad de la autenticación.
**V4.8.0 - (DEFINITIVE NAV FIX) - 22/01/2026**
**A. RESUMEN GENERAL:** Se implementó una corrección definitiva a una regresión persistente en el flujo de navegación de búsqueda. El botón "Regresar" ahora devuelve consistentemente al usuario a la lista de resultados de búsqueda.

**B. Cambios Implementados:**
1.  **Corrección de Lógica de Estado en `regresarABusqueda` (`ui.js`):**
    *   **Problema:** La función `regresarABusqueda` estaba inspeccionando el estado de navegación actual (`navigationState`) en lugar del estado anidado (`navigationState.previousState`). Esto causaba que no se encontrara el contexto de la búsqueda y se ejecutara un retorno incorrecto a la página principal.
    *   **Solución:** Se refactorizó la función para que acceda al objeto `previousState`. Ahora comprueba `previousState.level` y extrae el término de búsqueda de `previousState.query`, asegurando que la vista de resultados de búsqueda se reconstruya utilizando el contexto correcto.
    *   **Líneas Afectadas en `ui.js`:** 480-488.

**C. Impacto:**
- **Estabilidad del Flujo de Búsqueda:** El comportamiento del botón "Regresar" en el flujo de búsqueda es ahora robusto y predecible. Se ha eliminado la regresión, asegurando que los usuarios no pierdan el contexto de su búsqueda al navegar por los resultados.
**V4.7.9 - (REGRESSION FIX) - 22/01/2026**
**A. RESUMEN GENERAL:** Se corrigió una regresión en el flujo de búsqueda que mostraba incorrectamente un botón "Regresar" en la página de resultados.

**B. Cambios Implementados:**
1.  **Corrección de la Interfaz de Resultados de Búsqueda (`ui.js`):**
    *   **Problema:** La función `mostrarResultadosDeBusqueda` añadía un botón "Regresar" a la vista de resultados. Esta vista debe ser el nivel superior del flujo de búsqueda y no debe permitir "regresar" a un estado anterior.
    *   **Solución:** Se eliminó la línea de código que generaba el `span` del botón "Regresar" dentro de esta función. Ahora, la vista de resultados de búsqueda se presenta correctamente sin opciones de navegación hacia atrás, estableciéndola como el punto de partida del flujo.
    *   **Líneas Afectadas en `ui.js`:** 549-550.

**C. Impacto:**
- **Flujo de Navegación Corregido:** El comportamiento del flujo de búsqueda ahora es el correcto. El botón "Regresar" solo aparecerá en las pantallas subsecuentes (ej. selección de año), y su acción devolverá correctamente al usuario a la lista de resultados de búsqueda, como se esperaba.
**V4.7.8 - (NAV BUG FIX) - 21/01/2026**
**A. RESUMEN GENERAL:** Se corrigió un bug en el flujo de navegación donde el botón "Regresar" no volvía a los resultados de la búsqueda, perdiendo el contexto del usuario.

**B. Cambios Implementados:**
1.  **Preservación del Estado de Búsqueda (`navigation.js`):**
    *   **Problema:** El término de búsqueda no se guardaba en el estado de la aplicación.
    *   **Solución:** Se modificó la función `filtrarContenido` para que almacene el `query` de la búsqueda en el `navigationState`.
    *   **Líneas Afectadas en `navigation.js`:** 86.

2.  **Lógica de Regreso a la Búsqueda (`ui.js`):**
    *   **Problema:** El botón "Regresar" no tenía una lógica para reconstruir la vista de búsqueda.
    *   **Solución:**
        a. Se creó una nueva función `regresarABusqueda` que vuelve a ejecutar el filtro con el `query` guardado en el estado.
        b. Se actualizó la función `mostrarVersiones` para que, si detecta que la navegación proviene de una búsqueda, el botón "Regresar" invoque a `regresarABusqueda`.
    *   **Líneas Afectadas en `ui.js`:** 450-453 (nueva condición), 478-489 (nueva función).

**C. Impacto:**
- **Consistencia de Navegación:** El botón "Regresar" ahora funciona de manera predecible, devolviendo al usuario a los resultados de su búsqueda y manteniendo el contexto de la navegación.
**V4.7.7 - (CRITICAL REGRESSION FIX) - 20/01/2026**
**A. RESUMEN GENERAL:** Se corrigió un `SyntaxError` fatal en `ui.js` que fue introducido en el commit anterior. Este error impedía la carga completa de la aplicación, haciendo que se quedara congelada en la pantalla de carga (splash screen).

**B. Cambios Implementados:**
1.  **Corrección de Error de Sintaxis (`ui.js`):**
    *   **Problema:** Una propiedad de un objeto (`ejemplo.imagenVehiculo`) fue dividida incorrectamente en dos líneas, rompiendo el parseo del script.
    *   **Solución:** Se unificó la propiedad en una sola línea para corregir la sintaxis del código JavaScript.
    *   **Líneas Afectadas en `ui.js`:** 601.

**C. Impacto:**
- **Funcionalidad Restaurada:** La aplicación ahora puede cargar y operar normalmente. Se ha restaurado la funcionalidad completa del catálogo.
**V4.7.6 - (NAV BUG FIX) - 20/01/2026**
**A. RESUMEN GENERAL:** Se corrigió un bug crítico en el flujo de navegación que ocurría después de realizar una búsqueda por modelo. El sistema ahora navega correctamente a la selección de año en lugar de retroceder en el flujo.

**B. Cambios Implementados:**
1.  **Corrección del Flujo de Navegación en Búsqueda (`ui.js`):**
    *   **Problema:** Al buscar un modelo, la UI mostraba incorrectamente tarjetas para cada año. Al hacer clic en una, el flujo retrocedía a la selección de versión de equipamiento.
    *   **Solución:** Se refactorizó la función `mostrarResultadosDeBusqueda`. Ahora:
        a. Agrupa los resultados para mostrar una única tarjeta por cada variante de modelo (ej. "CR-V Touring").
        b. El `onclick` de cada tarjeta ahora lleva directamente a la selección de año para esa variante específica, alineando el comportamiento de la búsqueda con el de la navegación por categorías o marcas.
    *   **Líneas Afectadas en `ui.js`:** 570-607.

**C. Impacto:**
- **Experiencia de Usuario Mejorada:** Se ha eliminado la confusión en el flujo de búsqueda. La navegación es ahora lógica, predecible y consistente en toda la aplicación.
- **Consistencia del Flujo:** El comportamiento post-búsqueda ahora es idéntico al de la navegación por categorías o marcas.


**V4.7.5 - (REGRESSION FIX) - 16/01/2026**
**A. RESUMEN GENERAL:** Se corrigió un bug de regresión crítico en el sistema de búsqueda que provocaba que, al buscar un modelo con múltiples versiones, se abriera incorrectamente el modal de detalle del primer resultado en lugar de mostrar todas las opciones disponibles.

**B. Cambios Implementados:**
1.  **Eliminación de De-duplicación Agresiva (`navigation.js`):**
    *   **Problema:** La lógica de búsqueda agrupaba incorrectamente todas las variantes de un mismo modelo, tratando múltiples resultados como si fueran uno solo.
    *   **Solución:** Se eliminó la línea de código que creaba `modelosUnicos`, asegurando que la lista completa de vehículos filtrados, con todas sus variantes, sea pasada a la capa de renderizado.
    *   **Líneas Afectadas en `navigation.js`:** 82-83.

2.  **Mejora de la Claridad en Resultados (`ui.js`):**
    *   **Problema:** Las tarjetas de resultado no mostraban información que permitiera diferenciar entre múltiples versiones de un mismo modelo.
    *   **Solución:** Se modificó la función `mostrarResultadosDeBusqueda` para que el texto de cada tarjeta de modelo incluya la `versionesAplicables` o el `tipoEncendido`, además del nombre y el año.
    *   **Líneas Afectadas en `ui.js`:** 576-579.

**C. Impacto:**
- **Funcionalidad Restaurada:** El sistema de búsqueda ahora muestra correctamente todas las variantes disponibles para un modelo, permitiendo al usuario ver y seleccionar la opción deseada.
- **Experiencia de Usuario Mejorada:** Las tarjetas de resultados son más informativas, evitando la confusión cuando un mismo modelo tiene múltiples configuraciones.

**V4.7.4 - (CRITICAL FEATURE REFACTOR) - 16/01/2026**
**A. RESUMEN GENERAL:** Se realizó una refactorización profunda y estructural del sistema de búsqueda global para corregir inconsistencias graves y alinearlo con los requisitos funcionales. La nueva implementación distingue correctamente entre búsquedas por marca, modelo y año, y asegura que la navegación sea consistente y reversible.

**B. Cambios Implementados:**
1.  **Refactorización de la Lógica de Búsqueda (`navigation.js`):**
    *   **Problema:** La lógica anterior trataba todas las búsquedas como si fueran por marca, mostrando resultados incorrectos (logos de marca en lugar de tarjetas de modelo).
    *   **Solución:** Se refactorizó completamente la función `filtrarContenido`. La nueva lógica:
        a. Implementa un filtrado mejorado que maneja correctamente los rangos de años.
        b. Analiza los resultados del filtro para clasificar la búsqueda (marca, modelo, año, mixta).
        c. Invoca una nueva función de renderizado unificada en `ui.js`, pasando el tipo y los resultados.
    *   **Líneas Afectadas en `navigation.js`:** 31-85 (función `filtrarContenido` reemplazada).

2.  **Unificación del Renderizado de Resultados (`ui.js`):**
    *   **Problema:** Existían múltiples funciones de renderizado de búsqueda (`mostrarResultadosBusquedaMarca`, `mostrarResultadosBusquedaModelo`) que creaban flujos de navegación inconsistentes y rotos.
    *   **Solución:** Se eliminaron las funciones antiguas y se creó una única función `mostrarResultadosDeBusqueda`. Esta función:
        a. Acepta un objeto con el tipo y los resultados de la búsqueda.
        b. Renderiza dinámicamente el tipo de tarjeta correcto (logo de marca o tarjeta de modelo).
        c. Asegura que los eventos `onclick` de las tarjetas se integren con el flujo de navegación principal y estándar de la aplicación (`mostrarModelosPorMarca`, `navegarADetallesDeModelo`).
    *   **Líneas Afectadas en `ui.js`:** 521-585 (funciones de búsqueda reemplazadas por `mostrarResultadosDeBusqueda`).

3.  **Corrección de Dependencia Circular (`ui.js`):**
    *   **Problema:** Se detectó una dependencia circular entre `navigation.js` y `ui.js` que impedía la correcta inicialización de la aplicación en entornos de prueba.
    *   **Solución:** Se eliminó la importación innecesaria de `irAPaginaPrincipal` dentro de `ui.js`.
    *   **Líneas Afectadas en `ui.js`:** 9 (línea eliminada).

**C. Impacto:**
- **Funcionalidad de Búsqueda Corregida:** El sistema ahora devuelve resultados precisos y visualmente correctos para búsquedas por modelo, marca y año.
- **Navegación Consistente:** El flujo de navegación desde los resultados de búsqueda ahora es idéntico al de la navegación principal, con botones "Volver" funcionales y un comportamiento predecible.
- **Mantenibilidad del Código:** La lógica de búsqueda está ahora centralizada y es más fácil de mantener, y se ha mejorado la estabilidad general de la aplicación al eliminar una dependencia circular.

**V4.7.3 - (FEATURE & BUGFIX) - 16/01/2026**
**A. RESUMEN GENERAL:** Se refactorizó la lógica central de navegación para optimizar el flujo en casos de opción única. Adicionalmente, esta refactorización corrige un bug que mostraba una pantalla en blanco al navegar hacia atrás en estos mismos flujos.

**B. Cambios Implementados:**
1.  **Optimización del Flujo de Navegación (`ui.js`):**
    *   **Problema:** El usuario debía pasar por pantallas de selección intermedias ("Versión de Equipamiento" o "Tipo de Encendido") incluso si solo existía una opción, creando pasos innecesarios.
    *   **Solución:** Se refactorizó la función `navegarADetallesDeModelo` para que actúe como un procesador de flujo secuencial. Ahora analiza si un modelo tiene una única versión de equipamiento y/o un único tipo de encendido. Si es así, omite las pantallas de selección correspondientes y navega directamente a la siguiente etapa, mostrando finalmente la pantalla de selección de "Año".
    *   **Líneas Afectadas en `ui.js`:** 312-357 (lógica refactorizada de `navegarADetallesDeModelo`).

2.  **Corrección del Bug de Pantalla en Blanco (`ui.js`):**
    *   **Problema:** Al navegar hacia atrás a una pantalla de selección que contenía un único elemento (ej. "Peterbilt -> Tipo de Encendido"), la pantalla se mostraba vacía.
    *   **Solución:** La refactorización de `navegarADetallesDeModelo` elimina este bug de forma inherente. Al omitir por completo las pantallas de selección de opción única, el flujo de "navegación hacia atrás" ya no necesita reconstruir estas vistas problemáticas, asegurando una experiencia de usuario consistente.
    *   **Líneas Afectadas en `ui.js`:** 312-357.

**C. Impacto:**
- **Experiencia de Usuario Mejorada:** La navegación es más rápida e intuitiva, eliminando clics redundantes.
- **Estabilidad del Flujo:** Se ha corregido el bug de la "pantalla en blanco", haciendo la navegación hacia atrás más robusta y predecible en todos los casos.

**V4.7.2 - (CRITICAL NAV FIX) - 16/01/2026**
**A. RESUMEN GENERAL:** Se implementó una corrección definitiva para un bug crítico y persistente en la navegación hacia atrás que ocurría en flujos específicos. Esta solución asegura que la navegación sea reversible y estable en todos los escenarios.

**B. Corrección Implementada:**
1.  **Manejo de Parámetros Nulos en Botón "Volver" (`ui.js`):**
    *   **Problema:** Al navegar por la ruta `Modelo -> Versión de Equipamiento -> Año` y presionar "Volver", la aplicación fallaba con un error (`... para 'Captiva' null`).
    *   **Causa Raíz:** La función `mostrarVersiones` construía incorrectamente la llamada de retorno, pasando el valor `null` de la versión de equipamiento como una cadena de texto (`'null'`) en lugar de como un valor nulo real.
    *   **Solución:** Se refactorizó la lógica que construye el `onclick` del botón "Volver" en la función `mostrarVersiones`. Ahora, se valida explícitamente si la versión de equipamiento existe. Si no existe, se pasa el valor `null` correctamente, evitando la conversión a string y asegurando que la función de retorno reciba los parámetros correctos.
    *   **Líneas Afectadas en `ui.js`:** 426-429.

**C. Impacto:**
- **Navegación Estable y Predecible:** Se ha eliminado el bug que rompía la navegación hacia atrás. El flujo de usuario es ahora completamente reversible y funcional, independientemente de la ruta de navegación que se tome.

**V4.7.1 - (FIX) - 15/01/2026**
**A. RESUMEN GENERAL:** Se implementó una corrección definitiva al flujo de navegación, solucionando un error lógico introducido en la refactorización anterior. Se ha restaurado el flujo funcional requerido y se ha robustecido la navegación hacia atrás.

**B. Cambios Implementados:**
1.  **Corrección del Flujo `Versión de Equipamiento` (`ui.js`):**
    *   **Problema:** Al seleccionar una "Versión de Equipamiento", el sistema navegaba incorrectamente a la pantalla de "Tipo de Encendido", creando un paso extra no deseado en el flujo.
    *   **Solución:** Se modificó la función `mostrarVersionesEquipamiento`. El evento `onclick` de cada tarjeta de versión ahora filtra los datos correspondientes a esa versión y navega directamente a `mostrarVersiones` (la pantalla de selección de Año/Generación), omitiendo el paso incorrecto.
    *   **Líneas Afectadas en `ui.js`:** 465-467.

2.  **Mejora de la Información en Tarjetas (`ui.js`):**
    *   **Problema:** Las tarjetas en la pantalla de "Versión de Equipamiento" solo mostraban el nombre de la versión.
    *   **Solución:** Se mejoró el renderizado de estas tarjetas para incluir también los tipos de encendido asociados a cada versión, proporcionando más contexto al usuario, tal como se requería.
    *   **Líneas Afectadas en `ui.js`:** 476-477.

3.  **Robustecimiento de la Navegación Hacia Atrás (`ui.js`):**
    *   **Problema:** Los botones "Volver" en las pantallas de "Tipo de Encendido" y "Año/Generación" tenían una lógica estática que fallaba si el usuario llegaba a través de un flujo alternativo (como el de "Versión de Equipamiento").
    *   **Solución:** Se refactorizaron las funciones `mostrarTiposEncendido` y `mostrarVersiones` para que utilicen el `navigationState` guardado. Ahora, determinan dinámicamente cuál fue la pantalla anterior y construyen el `onclick` del botón "Volver" para que siempre regrese al paso previo correcto, garantizando una navegación reversible y predecible.
    *   **Líneas Afectadas en `ui.js`:** 370-381, 418-426.

**C. Impacto:**
- **Flujo de Navegación Correcto:** La aplicación ahora sigue estrictamente el flujo funcional requerido (`Modelo -> [Versión O Encendido] -> Año`), eliminando pasos incorrectos y confusos.
- **Experiencia de Usuario Mejorada:** La navegación hacia atrás es ahora completamente fiable, y las tarjetas de versión de equipamiento son más informativas, mejorando la usabilidad general.

**V4.7.0 - (REFACTOR) - 15/01/2026**
**A. RESUMEN GENERAL:** Se ejecutó una refactorización integral del flujo de navegación en `ui.js` para corregir inconsistencias, normalizar el comportamiento y alinearlo con los requisitos funcionales. Se ha establecido un flujo de usuario lógico, predecible y reversible.

**B. Cambios Implementados:**
1.  **Centralización de la Lógica de Navegación (`ui.js`):**
    *   **Problema:** El flujo de navegación estaba fragmentado y era inconsistente, especialmente después de seleccionar un modelo. La aplicación no decidía correctamente si mostrar "Versiones de Equipamiento" o "Tipos de Encendido".
    *   **Solución:** Se creó una nueva función `navegarADetallesDeModelo`. Esta función actúa como un "hub" central que analiza los datos de un modelo seleccionado y dirige al usuario a la pantalla correcta, ya sea `mostrarVersionesEquipamiento` o `mostrarTiposEncendido`, garantizando el flujo correcto.
    *   **Líneas Afectadas en `ui.js`:** 303-334 (nueva función `navegarADetallesDeModelo`).

2.  **Unificación de Puntos de Entrada (`ui.js`):**
    *   **Problema:** Diferentes partes de la aplicación (navegación por categoría, por marca, búsqueda) tenían sus propias lógicas `onclick` que llevaban a flujos inconsistentes.
    *   **Solución:** Se refactorizaron las funciones `mostrarModelos`, `mostrarModelosPorMarca` y `mostrarResultadosBusquedaModelo` para que todas utilicen la nueva función `navegarADetallesDeModelo` en sus eventos `onclick`. Esto unifica el comportamiento en toda la aplicación.
    *   **Líneas Afectadas en `ui.js`:** 289, 357, 519.

3.  **Corrección del Flujo de Versiones de Equipamiento (`ui.js`):**
    *   **Problema:** La función `mostrarVersionesEquipamiento` no estaba correctamente integrada en el flujo y no filtraba por modelo.
    *   **Solución:** Se modificó la función para que acepte el `modelo` como parámetro, filtre las versiones de equipamiento específicas para ese modelo y asegure que el botón "Volver" y los clics en las tarjetas dirijan al usuario a los pasos correctos del flujo unificado.
    *   **Líneas Afectadas en `ui.js`:** 427-456.

4.  **Optimización del Código (`ui.js`):**
    *   **Problema:** La función `mostrarResultadosBusquedaVersion` se volvió redundante después de centralizar la lógica en `navegarADetallesDeModelo`.
    *   **Solución:** Se eliminó la función `mostrarResultadosBusquedaVersion` para limpiar el código y evitar confusiones.
    *   **Líneas Afectadas en `ui.js`:** 531-551 (eliminadas).

5.  **Ordenamiento por Relevancia (`ui.js`):**
    *   **Problema:** Las categorías no estaban ordenadas por relevancia.
    *   **Solución:** Se modificó `mostrarCategorias` para ordenar las tarjetas de categorías según la cantidad de vehículos que contienen (población), de mayor a menor.
    *   **Líneas Afectadas en `ui.js`:** 167-175.

**C. Impacto:**
- **Navegación Consistente y Predecible:** Todos los flujos de navegación (categoría, marca, búsqueda) ahora convergen en un comportamiento único y correcto, eliminando errores y mejorando la experiencia del usuario.
- **Mantenibilidad del Código:** La centralización de la lógica de decisión en una sola función (`navegarADetallesDeModelo`) hace que el código sea más fácil de entender, depurar y mantener.

**V4.6.0 - (FEATURE) - 15/01/2026**
**A. RESUMEN GENERAL:** Se implementaron los estilos visuales para el sistema de Inbox, completando la Tarea 18. La funcionalidad, que ya estaba presente en el código, es ahora completamente accesible y usable para los roles de usuario designados.

**B. Cambios Implementados:**
1.  **Implementación de Estilos del Inbox (`style.css`):**
    *   **Problema:** El modal del Inbox carecía de cualquier estilo, haciéndolo inutilizable.
    *   **Solución:** Se añadió un nuevo bloque de CSS (`/* --- ESTILOS DEL MODAL DE INBOX --- */`) que define la apariencia y el comportamiento de todos los componentes del sistema de Inbox.
    *   **Detalles de Estilos Añadidos:**
        *   `.inbox-item`: Define el layout de cada mensaje en la lista, con estados `:hover` y `.active`.
        *   `.inbox-item.resolved` y `.inbox-item.replied`: Añaden indicadores visuales para los mensajes resueltos (opacidad reducida) y los respondidos (etiqueta de texto).
        *   `#inbox-detail`: Estilos para el panel de detalles del mensaje.
        *   `.inbox-message-content`, `.inbox-reply-content`: Contenedores visualmente diferenciados para el mensaje original y la respuesta.
        *   `.inbox-actions`: Estilos para el `textarea` y los botones de "Enviar Respuesta" y "Marcar como Resuelto", asegurando consistencia con el diseño de la aplicación.
    *   **Líneas Afectadas en `style.css`:** 1095-1185.

2.  **Actualización de Versión (`index.html`):**
    *   Se incrementó el número de versión a `4.6.0` para reflejar la adición de la nueva funcionalidad.
    *   **Líneas Afectadas en `index.html`:** 1.

**C. Impacto:**
- **Funcionalidad Completada:** El sistema de gestión de feedback (Inbox) es ahora una herramienta completamente funcional y visualmente integrada en la aplicación, permitiendo a los administradores gestionar la comunicación con los usuarios de manera eficiente.

**V4.5.2 - (NAV BUG FIX) - 14/01/2026**
**A. RESUMEN GENERAL:** Se corrigió un bug en el flujo de navegación que ocurría en la etapa de selección de "Tipo de Encendido".

**B. Corrección Implementada:**
1.  **Bug de Flujo de Navegación (`ui.js`):**
    *   **Problema:** Cuando un modelo de vehículo tenía un solo tipo de encendido, el sistema se saltaba la pantalla de selección, pasando un conjunto de datos incorrectamente filtrado a la siguiente etapa y rompiendo el flujo.
    *   **Causa Raíz:** Una lógica de "optimización" en la función `mostrarTiposEncendido` que no consideraba los casos en los que múltiples rangos de años existían para un único tipo de encendido.
    *   **Solución:** Se eliminó el bloque condicional que causaba el salto. Ahora, la pantalla de selección de "Tipo de Encendido" se mostrará siempre, incluso si solo hay una opción. Esto garantiza que el flujo de datos sea consistente y predecible, resolviendo el bug.
    *   **Líneas Afectadas en `ui.js`:** 346-349.

**C. Impacto:**
- **Estabilidad de la Navegación:** Se ha restaurado el flujo de navegación correcto para todos los casos, asegurando que los usuarios puedan llegar al detalle del vehículo sin errores, independientemente de la estructura de los datos.

**V4.5.1 - (UI & DOCS UPDATE) - 14/01/2026**
**A. RESUMEN GENERAL:** Se implementaron ajustes de diseño en el modal de detalles del vehículo y se actualizó la documentación (`README.md`) para reflejar los nuevos requisitos visuales, según la solicitud del Project Manager.

**B. Cambios Implementados:**
1.  **Actualización de Documentación (`README.md`):**
    *   **Problema:** La descripción del layout del encabezado del modal era incorrecta y faltaba un ejemplo visual.
    *   **Solución:** Se actualizó el texto para indicar que el logo de la marca debe aparecer a la izquierda del título. Se añadió una nueva sección con un diagrama ASCII y una lista detallada de requisitos que describen la estructura y el orden del contenido del modal.
    *   **Líneas Afectadas en `README.md`:** 991-1078.

2.  **Ajuste del Layout del Encabezado (`ui.js`):**
    *   **Problema:** El logo de la marca aparecía a la derecha del título del modelo.
    *   **Solución:** Se refactorizó la función `mostrarDetalleModal` para reordenar la creación de los elementos del DOM, insertando el logo *antes* que el título y ajustando el estilo `justify-content` a `flex-start` para asegurar una alineación a la izquierda.
    *   **Líneas Afectadas en `ui.js`:** 532-550.

3.  **Ajuste de Tamaño de Imágenes (`style.css`):**
    *   **Problema:** El tamaño del logo de la marca y de la imagen del vehículo no cumplían con los nuevos requisitos de diseño.
    *   **Solución:** Se modificaron las reglas de CSS para:
        *   Aumentar la altura del logo de la marca en un 10% (a `44px`) en la clase `.brand-logo-modal`.
        *   Reducir el ancho máximo de la imagen del vehículo en un 10% (a `225px`) en la clase `.img-vehiculo-modal`.
    *   **Líneas Afectadas en `style.css`:** 777-781, 790.

**C. Impacto:**
- **Consistencia Visual y Documental:** El diseño del modal de detalles ahora coincide con los requisitos visuales más recientes, y la documentación en `README.md` actúa como una fuente de verdad precisa para la estructura de la UI.

**V4.5.0 - (REGRESSION FIX) - 14/01/2026**
**A. RESUMEN GENERAL:** Se implementó una corrección integral para un conjunto de regresiones críticas en el frontend que afectaban la navegación principal y la visualización de detalles en los modales, restaurando la funcionalidad y el diseño a las especificaciones definidas en la documentación.

**B. Correcciones Implementadas:**
1.  **Restauración de la Navegación Principal (`ui.js`):**
    *   **Problema:** Las secciones "Últimos agregados", "Marcas de Vehículos" y "Marcas de Motocicletas" desaparecian después de la primera interacción del usuario.
    *   **Causa Raíz:** La lógica de navegación era destructiva, borrando el contenido principal en cada clic.
    *   **Solución:** Se refactorizó el flujo de navegación para que sea lineal y jerárquico. Se implementó una nueva función `mostrarModelosPorMarca` para manejar correctamente la transición de "Marca" a "Modelos", y se ajustaron los `onclick` para seguir este flujo, asegurando que todas las secciones principales permanezcan visibles.
    *   **Líneas Afectadas en `ui.js`:** 195, 211, 254-292 (nueva función `mostrarModelosPorMarca` reemplazando `mostrarCategoriasPorMarca`).

2.  **Corrección de Contenido en Modales (`ui.js`):**
    *   **Problema:** Los videos en los modales de tutoriales y las imágenes en los modales de relay no se mostraban si el dato correspondiente faltaba.
    *   **Solución:** Se refactorizaron las funciones `mostrarDetalleTutorialModal` y `mostrarDetalleRelayModal` para construir el DOM de forma segura con `appendChild` y validar la existencia de los datos (`item.Video`, `item.imagen`) antes de intentar renderizar los elementos.
    *   **Líneas Afectadas en `ui.js`:** 1158-1188, 1199-1237.

3.  **Corrección de Diseño del Modal de Vehículos (`ui.js` y `style.css`):**
    *   **Problema:** El logo de la marca, los botones de feedback y el nombre del colaborador estaban mal posicionados.
    *   **Solución (`ui.js`):** Se reordenó la creación de elementos en `mostrarDetalleModal` para colocar el logo a la derecha del título (Líneas 533-551). Se asignó la clase `colaborador-info` al párrafo del colaborador para un estilo dedicado (Línea 697).
    *   **Solución (`style.css`):** Se ajustó la regla `.feedback-overlay` para un posicionamiento preciso de los botones (Líneas 822-827). Se añadió la nueva clase `.colaborador-info` para garantizar que el texto del colaborador tenga su propio espacio vertical (Líneas 829-838).

**C. Impacto:**
- **Funcionalidad de Navegación Restaurada:** Los usuarios ahora pueden navegar por el catálogo de manera lógica y predecible sin perder el contexto.
- **Estabilidad de la UI:** Los modales ahora manejan correctamente los datos faltantes, evitando errores de renderizado.
- **Consistencia Visual:** El diseño del modal de detalles ahora cumple con las especificaciones visuales del `README.md`.

**V4.9.6 - (SURGICAL LAYOUT FIX) - 02/02/2026**
**A. RESUMEN GENERAL:** Se realizaron ajustes quirúrgicos en el layout del encabezado para corregir el desbordamiento horizontal y mejorar la escala visual del logo en modo búsqueda, además de suavizar las transiciones de la interfaz.

**B. Cambios Implementados:**

1.  **Corrección de Desbordamiento y Layout (style.css):**
    *   **Descripción:** Se aplicó `width: 100%`, `box-sizing: border-box` y `overflow-x: hidden` a `.main-header` durante la búsqueda activa. Esto previene que el desplazamiento del header fijo genere barras de scroll horizontal.
    *   **Líneas Afectadas:** 388-390.

2.  **Escalado y Alineación de Logo (style.css):**
    *   **Descripción:** Se eliminó `max-width: 38px` y se estableció `height: 48px` para el logo en modo búsqueda, logrando una proporción del ~95% respecto a la barra de entrada. Se ajustó la posición vertical (`top: 10px`) para una alineación perfecta.
    *   **Líneas Afectadas:** 406-412.

3.  **Suavizado de Animaciones (style.css):**
    *   **Descripción:** Se actualizó la transición de los elementos que se ocultan (selectores de sección, controles) para usar curvas de tiempo diferenciadas, evitando el colapso abrupto del espacio.
    *   **Líneas Afectadas:** 372.

4.  **Actualización de Versión:**
    *   **Descripción:** Incremento de versión a v4.9.6 en `index.html`.
    *   **Líneas Afectadas:** 7, 245.

**C. Impacto:**
- **Calidad Visual:** El logo ahora tiene una presencia proporcional y clara en la interfaz de búsqueda.
- **Estabilidad de Layout:** Se eliminó el error de overflow horizontal reportado.
- **Fluidez:** La transición entre el modo normal y el modo búsqueda es más armónica y menos intrusiva.

**V4.9.6 - (PRECISION LAYOUT REPAIR) - 02/02/2026**
**A. RESUMEN GENERAL:** Corrección crítica y quirúrgica del layout del encabezado en modo búsqueda. Se unificaron reglas conflictivas y se garantizó el centrado perfecto del logo dentro de la barra de búsqueda.

**B. Cambios Implementados:**

1.  **Unificación de Reglas (style.css):**
    *   **Descripción:** Se consolidaron múltiples reglas de `body.search-active` en bloques lógicos y unificados (Header, Logo, Contenedores) para evitar conflictos de especificidad y herencia.
    *   **Líneas Afectadas:** 358-428.

2.  **Centrado Milimétrico del Logo (style.css):**
    *   **Descripción:** Se eliminó el posicionamiento `fixed` disruptivo. Se implementó un centrado vertical dinámico mediante `absolute` y `transform: translateY(-50%)` relativo al header. Se ajustó la altura a `40px` (95% de la barra) para asegurar que el logo permanezca totalmente dentro del contenedor.
    *   **Líneas Afectadas:** 406-417.

3.  **Bloqueo de Desbordamiento y Gap (style.css):**
    *   **Descripción:** Se aplicó `gap: 0` al header activo para eliminar el espacio de elementos colapsados. Se reforzó el control de desbordamiento horizontal con `overflow: hidden` y `box-sizing: border-box`.
    *   **Líneas Afectadas:** 389.

4.  **Sincronización de Versión:**
    *   **Descripción:** Normalización a v4.9.6 en `index.html`.

**V4.9.7 - (CRITICAL FIXES BACKLOG) - 02/02/2026**
**A. RESUMEN GENERAL:** Ejecución integral del backlog de correcciones críticas. Se optimizó el tiempo de arranque, se mejoró la precisión de la búsqueda, se robusteció la visualización de videos e inbox, y se incrementó la resolución de imágenes.

**B. Cambios Implementados:**

1.  **Optimización de Splash Screen (auth.js, state.js, ui.js):**
    *   **auth.js:** Se eliminó el `await` de `loadInitialData()` en `checkSession` (Línea 84) y `login` (Línea 102), permitiendo mostrar la UI inmediatamente.
    *   **state.js:** Se implementó un sistema de `subscribe` (Líneas 31-39) para notificar cambios de estado.
    *   **ui.js:** Se añadió una guarda de estado de carga en `showApp` (Línea 1225) y una suscripción reactiva (Línea 1241) para renderizar el catálogo cuando los datos llegan en segundo plano.

2.  **Corrección de Búsqueda Numérica (navigation.js):**
    *   **Descripción:** Se limitó la detección de años al rango 1900-2100 (Línea 47). Se prioriza la coincidencia exacta de modelo sobre la de marca (Línea 84) para evitar colisiones en modelos como "2002".

3.  **Mejora de Visualización de Videos (catalog.js, ui.js):**
    *   **catalog.js:** Nueva función `normalizeYouTubeUrl` (Línea 596) para unificar formatos de URL e IDs.
    *   **ui.js:** Refactorización de `getYouTubeEmbedUrl` (Línea 1007) para mayor robustez en la extracción de IDs de YouTube.

4.  **Estabilización de Inbox (ui.js):**
    *   **Descripción:** Se modificó `openInbox` (Línea 891) para extraer datos de múltiples claves posibles (`data`, `messages`, `items`), mejorando la compatibilidad con el backend.

5.  **Refinamiento de Animaciones (style.css):**
    *   **Descripción:** Se añadió `will-change` a los elementos del header (Líneas 373, 394) para habilitar aceleración por GPU y suavizar las transiciones de búsqueda.

6.  **Consistencia de Resolución de Imágenes (ui.js):**
    *   **Descripción:** Se incrementó el tamaño base de thumbnails a 400px (Línea 12) con lógica de duplicación para pantallas de alta densidad. Se aumentó el tamaño de imágenes en modales a 1200px (Líneas 861, 1054).

7.  **Sincronización de Versión:**
    *   **Descripción:** Actualización global a v4.9.7 en `index.html`.

**C. Impacto:**
- **Rendimiento:** Reducción drástica del tiempo de espera percibido en el Splash Screen.
- **Usabilidad:** Búsqueda más inteligente y predecible.
- **Calidad Visual:** Imágenes más nítidas y animaciones sin saltos.
- **Robustez:** Mayor tolerancia a variaciones en la estructura de datos del backend.

**V4.9.8 - (BACKLOG COMPLETION & ROBUSTNESS) - 02/02/2026**
**A. RESUMEN GENERAL:** Finalización del backlog de correcciones críticas y adición de funcionalidades operativas (Dashboard, Edición, Sugerencias). Se realizó una auditoría profunda que eliminó errores de referencia y unificó el sistema de estilos.

**B. Cambios Implementados:**

1.  **Dashboard de Actividad (ui.js, index.html, main.js, feedback.js):**
    *   **Backend:** Acción `getActivityLogs` implementada para reporte de eventos.
    *   **Frontend:** Modal de Dashboard con tabla dinámica de logs.
    *   **Acceso:** Restringido a roles autorizados ('Desarrollador', 'Gefe', 'Supervisor').
2.  **Sugerencia de Años (ui.js):**
    *   **Descripción:** Interfaz `window.prompt` vinculada a la acción `suggestYear` del backend.
3.  **Edición Directa (ui.js):**
    *   **Descripción:** Botón "Editar" en el modal de detalle para redirección a `add_cortes.html`.
4.  **Optimización de Rendimiento (ui.js):**
    *   **Lazy Loading:** Aplicado a todas las imágenes del catálogo.
    *   **Carga Reactiva:** Implementación de Observer en `state.js` para evitar bloqueo de Splash Screen.
5.  **Unificación de Estilos (style.css):**
    *   **Consolidación:** Todas las reglas de `body.search-active` unificadas en un solo bloque.
    *   **Optimización:** Uso de `will-change` y mejora de sombras y gaps.
6.  **Correcciones de Auditoría (ui.js):**
    *   **Referencia:** Corregidos `logoImg.loading` e `imgVehiculo.loading` para evitar `ReferenceError`.
    *   **Importaciones:** Agregados `routeAction` y `getActivityLogs`.
7.  **Sincronización de Versión:**
    *   **Descripción:** Incremento global a v4.9.8 en `index.html`.

**V4.9.9 - (SEARCH LAYOUT REPAIR) - 02/02/2026**
**A. RESUMEN GENERAL:** Reparación definitiva del desbordamiento horizontal de la barra de búsqueda en modo activo. Se implementó un reset global de box-sizing y se refinaron las reglas de layout para garantizar la visibilidad total en dispositivos móviles.

**B. Cambios Implementados:**

1.  **Reset Global de Box-Sizing (style.css):**
    *   **Descripción:** Se añadió `*, *::before, *::after { box-sizing: border-box; }` al inicio del archivo (Línea 2). Esto asegura que el padding y los bordes se incluyan dentro del cálculo del ancho total, eliminando el overflow de los inputs con `width: 100%`.
2.  **Unificación de Layout de Búsqueda (style.css):**
    *   **Consolidación:** Se refinaron las reglas de `body.search-active` (Líneas 399-408) para asegurar que el input ocupe el ancho disponible sin exceder los límites del contenedor padre (`.main-header`).
    *   **Protección:** Adición explícita de `box-sizing: border-box` a `#searchInput` para redundancia de seguridad.
3.  **Sincronización de Versión:**
    *   **Descripción:** Actualización global a v4.9.9 en `index.html`.

**C. Impacto:**
- **Layout Móvil:** La barra de búsqueda ahora es 100% visible y centrada en móviles, sin cortes ni desbordamientos a la derecha.
- **Mantenibilidad:** El uso de `border-box` previene futuros errores de layout al modificar padding o márgenes.

v4.9.10
- Archivo ui.js:
  - Refactorización de la función setupModal (línea 869) para implementar inicialización perezosa de elementos del DOM, garantizando que los modales funcionen incluso si el DOM no está completamente cargado al inicio.
  - Robustecimiento de renderInboxList (línea 967) con validación de tipo para item.content, previniendo fallos en el renderizado si el contenido del mensaje es nulo o indefinido.
  - Mejora en el manejo de errores de openInbox (línea 937) agregando registros en consola y mensajes descriptivos en la UI.
  - Restauración de la función openDashboard (línea 887) y sus dependencias (getActivityLogs, routeAction).
  - Sincronización de la visibilidad del botón dashboard-btn según el rol del usuario (línea 1261).
- Archivo main.js:
  - Restauración del listener para el botón del Dashboard (línea 145).
- Archivo index.html:
  - Actualización de la versión a v4.9.10 en el título y pie de página.

**[02/02/2026] REFINAMIENTO DE ESTILOS DE INBOX (v4.9.11)**
- ui.js:
    - Líneas 930, 934: Eliminación de console.error según directivas de calidad.
    - Línea 965: Actualización de la lógica para mostrar el tipo de mensaje en lugar de previsualización.
    - Línea 971: Cambio de contenido de <p> por la etiqueta de tipo de mensaje.
    - Línea 989: Adición de la clase 'inbox-detail-title' al título del detalle.
- style.css:
    - Línea 1115: Adición de padding minimalista al modal de inbox.
    - Línea 1122: Reducción de padding en .inbox-item de 12px a 8px 10px.
    - Línea 1151-1153: Reducción de font-size en títulos de items (0.9em) y ajuste de interlineado.
    - Línea 1156-1158: Reducción de font-size en etiquetas de tipo (0.8em).
    - Línea 1161-1163: Implementación de overflow-y: auto y max-height en #inbox-detail.
    - Línea 1165: Definición de .inbox-detail-title con font-size reducido (1.2em).
    - Línea 1174-1175: Reducción de padding en contenedores de mensajes de 15px a 10px.
    - Línea 1189, 1193: Reducción de márgenes y tamaño mínimo de textarea en acciones.

**[02/02/2026] REPARACIÓN DEFINITIVA Y ALTA DENSIDAD DE INBOX (v4.9.12)**
- index.html:
    - Eliminación total de estilos inline en el modal de Inbox (#inbox-modal, #inbox-list, #inbox-detail).
    - Implementación de estructura semántica con clases (.inbox-modal-title, .inbox-layout-wrapper).
    - Actualización de versión global a v4.9.12.
- ui.js:
    - Normalización de clases en el renderizado de la lista (.inbox-item-title, .inbox-item-type).
    - Asegurada la visualización de alta densidad (solo Asunto y Tipo).
- style.css:
    - Reescritura integral del bloque de estilos de Inbox para alta densidad.
    - Reducción drástica de paddings (4px-6px) y gaps (8px-10px).
    - Ajuste tipográfico: Títulos de modal (1.2rem), Títulos de detalle (1rem), Items (0.85rem).
    - Implementación de scroll independiente y desbordamiento controlado en paneles divididos.
    - Eliminación de espacios redundantes en botones de acción y áreas de texto.
v4.9.13 (02/02/2026):
- style.css: Refactorización completa de la bandeja de entrada (líneas 1115-1245). Reducción de tamaños de fuente (titles de 1.2rem a 1.1rem, item-titles a 0.8rem). Minimización de márgenes y paddings. Implementación de scroll independiente para el detalle y control de desbordamiento en el modal.
- ui.js: Actualización de renderInboxDetail (líneas 1067-1068) para usar clases CSS en metadatos. Implementación de persistencia de "Likes" mediante likedCortes y actualización optimista del contador local (líneas 792-818).
- state.js: Adición de likedCortes: [] al estado inicial para persistencia durante la sesión (línea 24).
- api-config.js: Inclusión de logging detallado en routeAction (líneas 36-67) para auditoría de ruteo y respuestas, y adición de redirect: 'follow' a fetch.
- main.js: Estabilización de listeners de footer con preventDefault (líneas 146-155) y logging robusto en el formulario de contacto (líneas 204-228).
