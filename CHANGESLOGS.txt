=================================================
 NORMAS OBLIGATORIAS PARA EL REGISTRO DE CAMBIOS
=================================================

**IMPORTANTE:** Antes de registrar un nuevo cambio, asegúrese de haber seguido todas las normas de desarrollo descritas en `README.md` y `INSTRUCTIVO.TXT`.

1.  **Actualizar Versión:** Confirme que el número de versión (`vX.X.X`) es correcto y ha sido actualizado en los archivos correspondientes (`index.html`, servicios `.js`/`.gs`).
2.  **Documentación Interna:** Verifique que `README.md` y `INSTRUCTIVO.TXT` han sido actualizados para reflejar los cambios realizados.
3.  **Formato Detallado:**
    *   **Archivo y Línea:** Cada cambio listado debe especificar el nombre del archivo modificado y el número de línea exacto.
    *   **Comentarios de Código:** Confirme que las líneas de código nuevas o modificadas tienen comentarios explicativos.
    *   **Claridad:** Describa el "qué" y el "porqué" del cambio de manera clara y concisa.

-------------------------------------------------

# Registro de Cambios del Proyecto GPSpedia

## v3.1.4 - 02/08/2024
- **DOCUMENTACIÓN DE REGRESIÓN Y ESTADO DEL PROYECTO:**
  - **Contexto:** Un intento de corrección de bugs y refactorización (v1.1.0) resultó en una regresión severa, eliminando implementaciones previas y reintroduciendo errores. Esta entrada documenta el estado actual del proyecto según la revisión del usuario.
  - **Correcciones Fallidas o Reintroducidas (Trabajo Incompleto):**
    1.  **Carga de Contenido de Secciones (`index.html`):** La lógica para cargar dinámicamente el contenido de "Tutoriales" y "Relay" se ha perdido.
    2.  **Organización del Pie de Página (`index.html`, aprox. Línea 2082):** El layout del footer volvió a un estado incorrecto, con los links de navegación apareciendo sobre el aviso de copyright.
    3.  **Layout del Modal de Detalle (`index.html`, función `mostrarDetalleModal`):** El nombre del colaborador aparece incorrectamente debajo de los botones de feedback.
    4.  **Estilo de Botones de Feedback (`index.html`):** Los botones "Útil" y "Reportar" en el modal carecen del estilo solicitado.
    5.  **Visibilidad de Opciones de Corte (`index.html`):** La "Tercera Opción de Corte" no se muestra en el modal de detalle, incluso cuando los datos existen.
    6.  **Posición del Botón de Limpiar Búsqueda (`index.html`):** El botón "x" para limpiar la búsqueda aparece fuera de la barra de búsqueda.
  - **Correcciones Implementadas Correctamente:**
    1.  **Navegación y Búsqueda:** Se solucionó el bug que causaba el colapso de la aplicación al buscar y el error en los botones "Volver a...".
    2.  **Layout Principal:** Se corrigió el colapso del contenedor principal durante la búsqueda.
    3.  **Menú Hamburguesa:** La funcionalidad del menú lateral fue implementada correctamente.
    4.  **Botón de Instalación PWA:** El botón ahora se muestra condicionalmente de forma correcta.
    5.  **Estilo de Alertas:** Los mensajes de alerta del sistema (ej. `alert()`) han sido estilizados.
  - **Nuevas Implementaciones Pendientes:**
    1.  **Creación de Página de Información:** Desarrollar una nueva página HTML (`info.html`) que contenga tres secciones: "Sobre Nosotros", "Contáctenos" y "Preguntas Frecuentes".
    2.  **Sección "Sobre Nosotros":** Adaptar el contenido del `README.md` para crear una descripción del proyecto orientada al consumidor final.
    3.  **Sección "Contáctenos":** Implementar un formulario con campos para "Nombre de la Organización", "Correo Electrónico", "Teléfono" y "Mensaje". La data debe enviarse a una nueva hoja de Google Sheets.
    4.  **Sección "Preguntas Frecuentes":** Crear un acordeón de preguntas y respuestas que expliquen todas las funcionalidades clave del catálogo para un usuario nuevo.

- **Estado del Proyecto:** El proyecto se encuentra en un estado de regresión funcional. La prioridad es corregir los errores reintroducidos antes de abordar las nuevas implementaciones.

## v3.1.3 - 01/08/2024
- **REFACTORIZACIÓN DE UI Y ACTUALIZACIÓN DE NORMAS DE DESARROLLO:**
  - **Contexto:** Tras un intento fallido de refactorización que reintrodujo vulnerabilidades, se adoptó un enfoque más seguro para actualizar la interfaz de usuario, y se añadieron nuevas reglas de desarrollo basadas en la retroalimentación del usuario.
  - **Acciones Realizadas:**
    1.  **Reconstrucción de `index.html` (Líneas 1-1200):** Se reemplazó el contenido completo de `index.html` con la plantilla de `Olds/GPSpedia 1.5/index.html` para restaurar el layout visual solicitado por el usuario.
    2.  **Eliminación de Código Inseguro:** Se eliminó el bloque de script obsoleto que contenía lógica de autenticación del lado del cliente y claves de API hardcodeadas.
    3.  **Reintegración de Lógica Moderna:** Se reinsertó el bloque de script moderno que utiliza `api-manager.js` para gestionar las llamadas a los microservicios de forma segura.
    4.  **Integración de Componentes UI:** Se añadieron los componentes del menú hamburguesa, el panel lateral y se vincularon a los nuevos event listeners en el script principal.
    5.  **Actualización de `README.md` (Línea 120):** Se añadió la nueva regla de desarrollo que estipula que una tarea solo se considera completa después de un commit y la validación explícita del usuario.
    6.  **Actualización de `INSTRUCTIVO.TXT` (Línea 85):** Se replicó la nueva regla de desarrollo en el instructivo para asegurar consistencia en la documentación.
- **Estado del Proyecto:** La interfaz de usuario ha sido actualizada al layout de la v1.5 manteniendo la arquitectura de backend segura. Las normas de desarrollo han sido actualizadas para reflejar el nuevo flujo de trabajo de validación.

## v3.1.2 - 31/07/2024
- **ANÁLISIS DE LÓGICA Y CORRECCIONES FINALES DE DOCUMENTACIÓN:**
  - **Contexto:** Se realizó una auditoría final para asegurar la coherencia entre el frontend y el backend, y para corregir omisiones finales en la documentación.
  - **Acciones Realizadas:**
    1.  **Corrección de `README.md`:** Se ajustó la descripción del bug de layout para apuntar correctamente al "Header/Search Bar" y se añadió la tarea pendiente del "Botón de Instalación PWA" al checklist.
    2.  **Análisis Lógico Frontend-Backend:** Se llevó a cabo una revisión línea por línea de todas las llamadas a la API desde los archivos `.html` para compararlas con las expectativas de los 5 microservicios.
    3.  **Documentación de Discrepancias:** Se añadió la sección "Análisis de Coherencia Lógica" a `INSTRUCTIVO.TXT`, documentando una inconsistencia menor encontrada en la llamada a la acción `checkVehicle` (el frontend envía `tipo-encendido` y el backend espera `tipoEncendido`).
- **Estado del Proyecto:** La documentación está ahora completa, corregida y refleja con alta fidelidad el estado del código y las tareas pendientes. El proyecto está listo para pasar a la fase de desarrollo y corrección de errores.

## v3.1.1 - 31/07/2024 (Revisión 2)
- **CAMBIO DE ENFOQUE Y ANÁLISIS PROFUNDO (CORREGIDO Y AMPLIADO):**
  - **Contexto:** Tras la retroalimentación del usuario, se realizó una segunda revisión más exhaustiva de la documentación para asegurar que incluyera todos los detalles omitidos en la primera versión.
  - **Acciones Realizadas:**
    1.  **Re-análisis del Historial y `index.html`:** Se cruzó la información del historial del chat con el estado actual del código para identificar con precisión todas las funcionalidades pendientes y los detalles de la base de datos.
    2.  **Actualización de `README.md` (Versión 2):** Se expandió la documentación para incluir:
        - La **estructura de columnas detallada** de todas las hojas principales de la base de datos (`Cortes`, `Tutoriales`, `Relay`), no solo la de `Users`.
        - Una nueva sección de **"Trabajos Pendientes"** en formato de checklist para visualizar claramente los bugs y las nuevas funcionalidades solicitadas (menú hamburguesa, enlaces del footer, etc.).
    3.  **Actualización de `INSTRUCTIVO.TXT`:** Se añadió una sección de **"Funcionalidades Pendientes de Implementación"** para que el documento refleje de manera completa tanto los errores a corregir como las características nuevas solicitadas.
- **Estado del Proyecto:** La fase de análisis y documentación se considera ahora completa y alineada con los requerimientos. El siguiente paso es proceder con la corrección de los errores y la implementación de las funcionalidades documentadas.

## v3.1.0 - 21/12/2023
- **MIGRACIÓN COMPLETA A ARQUITECTURA MODULAR (PLAN B):**
  - **Contexto:** Se inició una migración completa del backend monolítico (`Code.gs`) a una arquitectura de cinco microservicios (`Auth`, `Catalog`, `Write`, `Users`, `Feedback`) para mejorar el rendimiento y la mantenibilidad, siguiendo un plan detallado ("Plan B").
  - **Desarrollo:**
    1. Se crearon los 5 nuevos servicios de Google Apps Script.
    2. Se introdujo `api-manager.js` en el frontend como un enrutador central para gestionar las llamadas a los nuevos servicios.
    3. Se refactorizaron todos los archivos HTML (`index.html`, `add_cortes.html`, `users.html`) para usar el nuevo `api-manager`.
  - **Problema Crítico Persistente:** Durante y después de la migración, se encontró un bug persistente y crítico en el servicio de autenticación (`Auth.js`) que causaba el error "Credenciales inválidas", impidiendo el inicio de sesión. El problema persistió a pesar de múltiples intentos de depuración, incluyendo la implementación de un sistema de logging avanzado y varias refactorizaciones del código.
  - **Decisión y Resolución Final:** Se determinó que la complejidad heredada y los múltiples parches en `Auth.js` eran la causa de la inestabilidad. Se tomó la decisión de **descartar el código problemático y reconstruir el servicio `Auth.js` desde cero**, siguiendo las instrucciones y detalles de su funcionamiento en README.MD para usar una estructura de columnas fija (hardcoded). Esta acción pretendia eliminar la causa raíz del problema y finalmente NO resolvió el bug de autenticación de manera, el error aun persistia.
- El ultimo commit no soluciono el problema, sin embargo el mensaje de error al intentar iniciar sesión cambio a "Error inesperado: Cannot read properties of null (reading 'getDataRange')"
- **Estado del Proyecto:** La migración a la arquitectura modular está completa y el problema de autenticación NO ha sido resuelto. El proyecto se ha encontrado con un impase, ya que el problema de autenticación no permite el ingreso al sistema y comprobar las demas funcionalidades del sistema.
- **Actualización de Documentación:** Se actualizó `README.md` con el plan arquitectónico completo de la v2.0 y se ajustó `INSTRUCCIONES_DESPLIEGUE.md` para la nueva estructura.

## v3.009 - 23/07/2024
- **Plan B:** Se inicia la implementación del Plan B para resolver de forma definitiva el error "Credenciales inválidas".
- **Análisis de Causa Raíz:** Se confirma que el error de "Credenciales inválidas" persiste debido a un fallo de lógica en el manejo de la contraseña en el frontend, y no es un problema de despliegue del AppsScript. La función `sanitizeInput` sigue alterando la contraseña antes de ser enviada.
- **Próximos Pasos:** Se procederá a eliminar por completo la sanitización del campo de contraseña en `index.html`.

## v3.008 - 23/07/2024
- Se actualizó la `SCRIPT_URL` en los archivos `index.html`, `users.html` y `add_cortes.html` a la nueva URL de despliegue proporcionada por el usuario.

## v3.007 - 22/07/2024
- Se corrigió el error "Credenciales inválidas" al iniciar sesión.
- Se eliminó la función `sanitizeInput` del frontend (`index.html`) que modificaba incorrectamente las contraseñas con caracteres especiales.
- Se mejoró la comparación de contraseñas en el backend (`Code.gs`) para que sea estrictamente de texto.
- Se actualizó la URL del script en `index.html`, `users.html` y `add_cortes.html`.
- Se agregó un número de versión visible en la pantalla de inicio de sesión para facilitar la depuración.
- Se creó el archivo `INSTRUCCIONES_DESPLIEGE.md` para guiar al usuario en el proceso de despliegue correcto.

## v3.006 - 21/07/2024
- Se implementó una solución en el backend (Code.gs) para forzar la comparación de contraseñas como texto, evitando errores cuando la contraseña es puramente numérica.

## v3.005 - 20/07/2024
- Se actualizó el número de versión en Code.gs para reflejar los cambios recientes.

## v3.004 - 19/07/2024
- Se corrigió la función `sanitizeInput` en `index.html` para evitar que altere las contraseñas que contienen caracteres especiales. El error anterior causaba el fallo de "Credenciales inválidas".

## v3.003 - 18/07/2024
- Se cambió el `Content-Type` en las solicitudes `fetch` de `application/json` a `text/plain` en los archivos `index.html`, `add_cortes.html` y `users.html` para solucionar el error "Fail to fetch" relacionado con CORS.

## v3.002 - 17/07/2024
- Se agregó el manejo de errores detallado en la función `postToAction` para capturar y mostrar problemas de red o de análisis JSON.
- Se implementó un sistema de logging remoto (`remoteLog`) para enviar errores del frontend al backend y facilitar la depuración.

## v3.001 - 16/07/2024
- Se identificó que el error "Fail to fetch" es probablemente un problema de CORS (Cross-Origin Resource Sharing) que ocurre durante la solicitud de pre-vuelo (preflight request) OPTIONS que el navegador envía antes de la solicitud POST real.
v1.1.0 - 2024-07-29
- Corrección: El pie de página ahora muestra los enlaces de navegación debajo de los derechos de autor.
- Corrección: Las secciones "Tutoriales" y "Relay" ahora cargan su contenido correctamente.
- Corrección: La búsqueda ya no se bloquea al usar ciertos caracteres.
- Corrección: Los botones "Volver a..." en la navegación de búsqueda funcionan correctamente.
- Corrección: Las imágenes en los modales ahora muestran un marcador de posición si la URL está dañada.
- Corrección: Se ha solucionado el diseño del pie de página del modal, posicionando correctamente el nombre del colaborador y los botones de feedback.
