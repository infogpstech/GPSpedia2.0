# Registro de Cambios del Proyecto GPSpedia

## v1.1.0 - 2024-07-28
- **CORRECCIÓN DE BLOQUEO EN PANTALLA DE SPLASH:**
  - **Contexto:** La aplicación se quedaba atascada en la pantalla de splash debido a conflictos y duplicación en la lógica de inicialización dentro de `index.html`.
  - **Desarrollo:** Se refactorizó y unificó por completo el bloque `<script>` de `index.html`. Se eliminaron las funciones duplicadas y se estableció un flujo de ejecución claro y único, asegurando que la lógica de `checkSession` e `initializeAppData` se llame correctamente sin conflictos.
  - **Resultado:** El error de bloqueo ha sido resuelto. La aplicación ahora se inicializa correctamente, mostrando la pantalla de login o el contenido principal según el estado de la sesión del usuario.

## v1.0.9 - 2024-07-28
- **ACTUALIZACIÓN DE ENDPOINT DEL SERVICIO DE CATÁLOGO (CORRECCIÓN):**
  - **Contexto:** Después de corregir la lógica del backend en `services/catalog/catalog.js`, se desplegó una nueva versión del servicio.
  - **Desarrollo:** Se actualizó la URL del servicio `CATALOG` en `api-manager.js` para apuntar al endpoint más reciente, asegurando que el frontend utilice la versión corregida con la navegación jerárquica.
  - **Resultado:** El frontend y el backend están ahora sincronizados, utilizando la última versión desplegada y corregida del servicio de catálogo.

## v1.0.8 - 2024-07-28
- **CORRECCIÓN CRÍTICA EN `services/catalog/catalog.js`:**
  - **Contexto:** Se detectó que, debido a un error en el proceso de commit anterior, el archivo `services/catalog/catalog.js` no contenía la lógica de navegación jerárquica (`getNavigationData`) necesaria, sino que mantenía la lógica de paginación obsoleta.
  - **Desarrollo:** Se reemplazó por completo el contenido de `services/catalog/catalog.js` con la versión correcta y verificada que implementa la navegación jerárquica.
  - **Resultado:** El backend ahora está correctamente alineado con el frontend. El servicio de catálogo puede manejar las solicitudes de navegación por pasos, desbloqueando la funcionalidad principal del catálogo.

## v1.0.7 - 2024-07-28
- **RESTAURACIÓN DE LA NAVEGACIÓN JERÁRQUICA DEL CATÁLOGO:**
  - **Contexto:** La implementación de "scroll infinito" no se alineaba con la experiencia de usuario deseada, que requería una navegación por pasos similar a la de la v1.0.
  - **Desarrollo:**
    1.  **Backend Adaptado:** Se modificó `services/catalog/catalog.js` para incluir una nueva acción `getNavigationData`. Esta función ahora maneja solicitudes jerárquicas, devolviendo la lista de elementos para el siguiente nivel de navegación (ej. categorías -> marcas -> modelos).
    2.  **Frontend Reconstruido:** Se eliminó la lógica de "scroll infinito" de `index.html`. En su lugar, se reimplementó el sistema de navegación por pasos, creando funciones como `navegar`, `renderNivel` y `retroceder` que interactúan con el nuevo endpoint del backend.
  - **Resultado:** Se ha restaurado la lógica de navegación original y preferida por el usuario. La aplicación ahora permite explorar el catálogo de manera jerár'ca, mejorando la usabilidad y la eficiencia al cargar solo los datos necesarios para cada vista.

## v1.0.6 - 2024-07-27
- **ACTUALIZACIÓN DE ENDPOINT DEL SERVICIO DE CATÁLOGO:**
  - **Contexto:** Después de desplegar las últimas optimizaciones en el servicio de catálogo, se generó una nueva URL para el microservicio.
  - **Desarrollo:** Se actualizó la URL del servicio `CATALOG` en el archivo de configuración `api-manager.js` para apuntar al nuevo endpoint desplegado.
  - **Resultado:** El frontend ahora se comunica con la versión más reciente y optimizada del servicio de catálogo, asegurando que las mejoras de rendimiento y funcionalidad estén activas en producción.

## v1.0.5 - 2024-07-27
- **OPTIMIZACIÓN INTEGRAL DEL SERVICIO DE CATÁLOGO (`catalog.js`):**
  - **Contexto:** Se detectaron problemas de rendimiento y funcionalidad en la carga y visualización del catálogo de vehículos. La carga inicial era lenta, los nuevos registros no aparecían al principio y el filtrado por categorías no funcionaba.
  - **Desarrollo:**
    1.  **Filtro y Ordenación en Backend:** Se refactorizó la función `handleGetCatalogData` para que maneje la lógica de filtrado y ordenación directamente en el servidor. Ahora solo se cargan los datos de la categoría solicitada (`cortes`, `tutoriales`, `relay`), y los resultados se devuelven en orden cronológico inverso, asegurando que los registros más nuevos aparezcan primero.
    2.  **Implementación de Paginación:** Se añadió lógica de paginación en el backend. La función ahora acepta parámetros `page` y `pageSize` para devolver los datos en bloques manejables. Esto reduce drásticamente el tiempo de carga inicial y el consumo de ancho de banda.
    3.  **Optimización de Carga de Imágenes:** Se implementó una función (`createThumbnailUrl`) que genera URLs de miniaturas optimizadas (300px) para las imágenes y diagramas de Google Drive. El backend ahora devuelve tanto las URLs originales como las de las miniaturas, permitiendo al frontend cargar vistas previas ligeras y posponer la carga de imágenes en alta resolución.
  - **Resultado:** El servicio de catálogo ahora es significativamente más rápido, eficiente y escalable. La carga de datos es más ágil, la interfaz responde mejor y se ha solucionado el problema de ordenación y filtrado.

## v1.0.4 - 2024-07-26
- **CORRECCIÓN DE ERROR EN PARÁMETROS DE `checkVehicle`:**
  - **Contexto:** Después de corregir el enrutamiento, la función `checkVehicle` seguía fallando con el error "Parámetros de búsqueda incompletos". Un análisis del código legado (v1.5) reveló la causa raíz.
  - **Desarrollo:** Se identificó una discrepancia entre el `name` del campo del formulario en `add_cortes.html` y el nombre del parámetro esperado por el backend. El frontend enviaba `tipo-encendido` (con guion), mientras que el backend (`write.js`) esperaba `tipoEncendido` (camelCase). Se corrigió el atributo `name` en el `select` del HTML para que coincidiera con el backend.
  - **Resultado:** El error ha sido resuelto. El frontend ahora envía los parámetros con los nombres correctos, permitiendo que la función `checkVehicle` opere como se espera.

## v1.0.3 - 2024-07-26
- **CORRECCIÓN DE ENRUTAMIENTO EN `api-manager.js`:**
  - **Contexto:** Se detectó un error en la función `checkVehicle` que impedía verificar la existencia de un vehículo. La causa era un enrutamiento incorrecto en el frontend.
  - **Desarrollo:** Se corrigió el mapa `ACTION_TO_SERVICE_MAP` en `api-manager.js` para que la acción `checkVehicle` apunte al servicio correcto (`WRITE`) en lugar de al servicio `CATALOG`.
  - **Resultado:** La funcionalidad para comprobar si un vehículo ya existe antes de crearlo o actualizarlo ha sido restaurada.

## v1.0.2 - 2024-07-25
- **CORRECCIÓN CRÍTICA DE GESTIÓN DE SESIONES EN `Auth.gs`:**
  - **Contexto:** Se detectó un error crítico que provocaba el cierre inesperado de sesiones y bloqueaba el reingreso de los usuarios.
  - **Desarrollo:**
    1.  **Eliminación de Expiración de Sesión:** Se eliminó por completo el límite de tiempo de 24 horas en las sesiones. Las sesiones ahora son perpetuas y solo se invalidan cuando el usuario cierra sesión manualmente o inicia sesión desde un nuevo dispositivo.
    2.  **Implementación de Política de Sesión Única:** Se añadió una nueva lógica en la función `handleLogin` que busca y elimina todas las sesiones activas antiguas de un usuario antes de crear una nueva. Esto asegura que solo la sesión más reciente sea válida, cumpliendo con el requisito de "una sola sesión activa".
    3.  **Depuración de Fallo de Login:** Se añadió un logging de depuración temporal y detallado a la función de verificación de contraseñas para diagnosticar por qué fallaba el reingreso. Esto permitirá identificar si el problema es de tipo de dato (número vs. texto) o un error en la lógica de hashing.
  - **Resultado:** El sistema de sesiones ahora es mucho más estable y se alinea con los requisitos del usuario. Las sesiones persistirán al cerrar y reabrir la aplicación. El logging adicional permitirá resolver el problema de reingreso de forma definitiva.

## v1.0.1 - 2024-07-25
- **REFACTORIZACIÓN Y FINALIZACIÓN DEL SERVICIO DE ESCRITURA (`write.js`):**
  - **Contexto:** Se completó y robusteció el microservicio `services/write/write.js` para manejar la adición y actualización de registros de vehículos, basándose en la lógica estable del sistema legado.
  - **Desarrollo:**
    1.  **Eliminación de Mapeo Dinámico:** Se reemplazó la función `getColumnMap` por un objeto `COLS` hardcoded, eliminando una fuente potencial de errores y mejorando la estabilidad, en línea con la arquitectura del nuevo `Auth.gs`.
    2.  **Implementación de `checkVehicle`:** Se añadió la función `handleCheckVehicle` que faltaba, permitiendo al frontend verificar si un vehículo ya existe antes de decidir si crear un nuevo registro o actualizar uno existente.
    3.  **Mejora en Creación de Filas:** Se adoptó el método `copyTo`/`clearContent` del código legado para la creación de nuevas filas. Esto garantiza que todas las propiedades de la fila anterior, incluyendo **fórmulas, validaciones de datos y formatos condicionales**, se hereden correctamente.
    4.  **Módulo de Depuración:** Se implementó un módulo de depuración en la función `doGet` que permite simular llamadas `doPost` a través de parámetros en la URL, facilitando las pruebas del backend con herramientas como cURL.
  - **Resultado:** El servicio de escritura ahora es más robusto, completo y fácil de depurar. La correcta herencia de propiedades en las nuevas filas asegura la integridad de los datos en la hoja de cálculo.

## v1.0 - 2024-07-24
- **RECONSTRUCCIÓN DEL SERVICIO DE AUTENTICACIÓN:**
  - **Contexto:** Para resolver de forma definitiva los persistentes errores de "Credenciales inválidas" y "Cannot read properties of null", se tomó la decisión de reconstruir el servicio de autenticación desde cero.
  - **Desarrollo:**
    1. Se creó un nuevo archivo `services/Auth.gs` dedicado exclusivamente a la autenticación y gestión de sesiones.
    2. Se implementó la lógica de `handleLogin` utilizando una estructura de columnas fija (hardcoded) para la hoja `Users`, eliminando la posibilidad de errores por mapeo dinámico.
    3. Se añadió la función `handleValidateSession` para verificar la validez de los tokens de sesión contra la hoja `ActiveSessions`.
    4. Se integró un módulo de logging (`logEvent`) que registra todos los eventos importantes (logins exitosos, fallidos, errores) en la hoja "Logs".
    5. Se estableció la versión del nuevo servicio en `v1.0`, reflejada tanto en el `doGet` del script como en la interfaz de `index.html`.
  - **Mejora de Seguridad:** Se implementó un sistema de hashing de contraseñas (SHA-256 con salt) para reemplazar el almacenamiento en texto plano, mejorando significativamente la seguridad de las credenciales de usuario. Se añadió una función de migración para actualizar las contraseñas existentes.
  - **Resultado:** Este nuevo servicio aísla la lógica de autenticación, mejora la robustez y proporciona un sistema de depuración claro, sentando una base estable y segura para el sistema.
