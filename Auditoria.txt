**GPSpedia - Informe de Auditoría de Error Crítico**
---
**Fecha de Auditoría:** 2026-01-05
**Analista:** Jules
**Estado:** ANÁLISIS COMPLETADO. PENDIENTE DE REPARACIÓN.

### **1. Síntoma Reportado**

Al iniciar la aplicación, la carga se interrumpe y se muestra un mensaje de error genérico en la interfaz de usuario: `"Error al cargar los datos de la aplicación. Por favor, intente de nuevo"`. La aplicación queda bloqueada en este estado. Notablemente, **no se registra ningún error** en la consola de depuración del navegador, lo que dificulta el diagnóstico inicial.

### **2. Causa Raíz Identificada**

El problema se origina en el microservicio de backend **`services/catalog/catalog.js`** y es manejado de forma incompleta por el frontend en **`auth.js`**.

**La causa raíz es un `TypeError` fatal en el backend**, que ocurre dentro de la función `handleGetDropdownData`. Específicamente, el siguiente fragmento de código es el punto de fallo:

```javascript
// services/catalog/catalog.js
const categoriaRule = sheet.getRange(2, COLS_CORTES.categoria).getDataValidation();
const categorias = categoriaRule ? categoriaRule.getCriteriaValues()[0].flat().filter(String).sort() : [];
```

El error ocurre si la celda `B2` de la hoja de cálculo "Cortes" (que corresponde a `COLS_CORTES.categoria`) **no tiene una regla de validación de datos aplicada**. En este escenario:
1.  `sheet.getRange(...).getDataValidation()` devuelve `null`.
2.  La variable `categoriaRule` se asigna a `null`.
3.  El código intenta acceder a `categoriaRule.getCriteriaValues()`, lo que equivale a `null.getCriteriaValues()`, provocando un `TypeError` que detiene la ejecución de la función.

### **3. Trazabilidad del Error (Flujo Completo)**

1.  **Inicio en Frontend (`auth.js`):** La aplicación se inicializa y llama a `handleLoginSuccess`, que a su vez ejecuta `await fetchCatalogData()`.
2.  **Llamada a Backend (`api.js`):** `fetchCatalogData()` enruta la acción `getCatalogData` al servicio `CATALOG`.
3.  **Ejecución en Backend (`catalog.js`):** El `doPost` del `catalog-service` invoca la función `handleGetDropdownData`, donde se produce el `TypeError` descrito anteriormente.
4.  **Manejo de Error en Backend (`catalog.js`):** El `try...catch` principal del `doPost` captura el `TypeError` y, en lugar de fallar, construye y devuelve una respuesta JSON controlada al frontend, con el formato `{ status: 'error', message: '...', details: {...} }`.
5.  **Recepción en Frontend (`api.js`):** La función `routeAction` recibe la respuesta. Al detectar que `result.status === 'error'`, lanza una nueva `Error` con el mensaje del backend.
6.  **Manejo de Error en Frontend (`auth.js`):** El `catch` en `handleLoginSuccess` captura este error.
7.  **Supresión del Detalle del Error:** Dentro de este bloque `catch`, el código ejecuta `showGlobalError("Error al cargar los datos...")`, mostrando el mensaje genérico. **Crucialmente, no ejecuta `console.error(error)`**, ocultando así la causa raíz específica del problema de la consola del navegador.

### **4. Conclusión**

El bug es el resultado de una combinación de dos factores:
1.  **Código Frágil en el Backend:** El servicio `catalog.js` asume que una regla de validación de datos siempre existirá, sin verificar si es `null` antes de usarla.
2.  **Manejo de Errores Incompleto en el Frontend:** El módulo `auth.js` oculta los detalles técnicos de los errores controlados del backend, mostrando solo un mensaje genérico y dificultando la depuración.

La solución requerirá endurecer el código del backend para que no falle si falta una regla de validación y mejorar el logging en el frontend para que los errores controlados sean visibles durante el desarrollo.

**ACCIÓN REQUERIDA:** Registrar una nueva tarea en `Instrucciones.txt` para reparar este bug, siguiendo las directrices de no modificar el código en esta fase de análisis.
