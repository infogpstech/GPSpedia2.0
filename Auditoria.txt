**AUDITORÍA PROFUNDA DEL 02/02/2026 - FALLA PERSISTENTE DE ESPACIO EN BÚSQUEDA MÓVIL**

**1. AUDITORÍA DE index.html**
- **Línea 105:** Presencia de estilo inline `margin-bottom: 0 !important` (aplicado dinámicamente o por parche previo) en `#search-wrapper`.
- **Estructura de Contenedores:** El `#search-wrapper` está fuera del flujo de resultados pero dentro de `.container`. Al activar la búsqueda, se queda un "hueco" en el flujo del documento que `.container` compensa con padding.
- **Tipo de Problema:** Control de layout mixto (inline + CSS).

**2. AUDITORÍA DE style.css (CRÍTICA)**
- **Línea 400:** `body.search-active .container { padding: 75px 20px 20px; }`.
    - **Conflicto:** El `padding-top` de 75px es estático. Si la barra de búsqueda tiene `top: 10px` y una altura de ~48px, el espacio total ocupado es ~58px. El padding de 75px impone un "espacio fantasma" de ~17px adicionales de forma obligatoria.
- **Línea 374:** `body.search-active .header-container { display: none; }`.
    - **Conflicto:** Aunque `display: none` colapsa el elemento, la regla en la línea 400 vuelve a empujar el contenido hacia abajo con un valor arbitrario.
- **Líneas 2 y 11:** `height: var(--app-height, 100%);` aplicado a `html` y `body`.
    - **Riesgo:** Si `--app-height` se calcula sobre el viewport total y no sobre el área útil sobre el teclado, el scroll del `.container` puede quedar bloqueado o inaccesible bajo el teclado.
- **Líneas 404 y 420:** Uso de `position: fixed` con valores `top: 10px` y `top: 17px`.
    - **Contradicción:** Se posiciona la barra fuera del flujo, pero se intenta reservar su espacio mediante padding en un contenedor que ahora maneja su propio scroll.

**3. AUDITORÍA DE main.js**
- **Líneas 55-57:** `setTimeout(() => { document.body.classList.remove('search-active'); }, 200);`.
    - **Tipo de Problema:** Lógica de tiempo (magic number) que puede causar saltos visuales si el teclado tarda más en cerrar o si el usuario hace clic rápido.
- **Líneas 63-86:** `handleViewportChange` se ejecuta en `resize` y `scroll` del `visualViewport`.
    - **Tipo de Problema:** JS duplicado/redundante. Si el scroll está en `.container`, el scroll del `visualViewport` puede dispararse de forma inesperada en algunos navegadores móviles (Safari), recalculando la altura innecesariamente.

**4. AUDITORÍA DE ui.js**
- **Línea 538:** `mostrarResultadosDeBusqueda` limpia el contenedor.
    - **Tipo de Problema:** No se detectan conflictos directos de layout, pero el renderizado masivo puede causar que el scroll del `.container` se resetee al tope en momentos inoportunos.

**5. AUDITORÍA DE navigation.js**
- **Línea 34:** `filtrarContenido` maneja el flujo de búsqueda.
    - **Tipo de Problema:** No hay lógica que coordine el estado del teclado con la visibilidad de los resultados, delegando todo al CSS que, como se vio en el punto 2, tiene valores contradictorios.

**CONCLUSIÓN DE AUDITORÍA:**
La causa real del "espacio fantasma" es la regla de padding estático en `style.css:400` que no está sincronizada con la altura real de la barra de búsqueda fija ni con el colapso del header. Además, existe una redundancia entre el posicionamiento `fixed` de la barra y el modelo de scroll del `.container`.

**AUDITORÍA EXTREMA (02/02/2026): RECONSTRUCCIÓN DE HEADER**

**1. AUDITORÍA DE index.html**
- **Líneas 87-111:** Fragmentación del encabezado en múltiples divs (`header-container`, `search-wrapper`).
- **Hallazgo:** El `#install-button` y `#search-wrapper` están fuera de `.header-container`, lo que dificulta el control unificado de visibilidad.
- **Hallazgo:** El botón de hamburguesa (`#hamburger-btn`) está anidado dentro de `#search-wrapper`, lo que vincula su layout al buscador de forma innecesaria.
- **Riesgo:** Estilos inline como `margin-bottom: 0 !important` en la línea 105 son parches de fragilidad estructural.

**2. AUDITORÍA DE style.css (CRÍTICA)**
- **Líneas 76-135:** Reglas dispersas para `.header-container` y sus hijos con múltiples media queries que redefinen `flex-direction`.
- **Líneas 374-430:** El bloque `body.search-active` intenta forzar un nuevo layout mediante `position: fixed` en elementos que antes eran `relative`, causando saltos visuales y huecos.
- **Hallazgo:** `.container` (Línea 50) tiene un padding base de 20px que se suma al padding de 60px de `search-active`, pero el modelo de scroll en `.container` hace que este padding superior sea "scrollable", dejando un hueco al tope.

**3. AUDITORÍA DE main.js**
- **Líneas 38-56:** Gestión de eventos de búsqueda (`focus`, `blur`) que activan clases de CSS.
- **Líneas 64-85:** Lógica de `visualViewport` que inyecta variables de altura.
- **Conflicto:** La clase `search-active` se quita con un `setTimeout` de 200ms, lo cual es asíncrono y puede desincronizarse con el cierre del teclado.

**4. AUDITORÍA DE ui.js / navigation.js**
- **ui.js:159, navigation.js:19:** Dependencia directa del ID `#searchInput`.
- **Hallazgo:** No hay conflictos de lógica, pero cualquier cambio de ID en el HTML durante la reconstrucción requiere actualización inmediata aquí.

**CONCLUSIÓN DE AUDITORÍA EXTREMA:**
La fragmentación HTML del header impide una transición limpia a "modo búsqueda". Al ocultar el header original con `display: none`, el navegador recalcula el flujo de `.container`, pero la barra de búsqueda (al ser `fixed`) no rellena ese espacio de forma natural. Se requiere un contenedor maestro `.main-header` que encapsule todo lo superior.

**AUDITORÍA DE RESTAURACIÓN DE REGRESIONES (02/02/2026)**

**1. AUDITORÍA DE style.css**
- **Hallazgo (Botón Hamburguesa):** El botón `#hamburger-btn` carecía de un z-index suficiente para ser interactivo sobre el nuevo layout. Se añadió `z-index: 1500`.
- **Hallazgo (Logo en Búsqueda):** La regla `body.search-active .header-branding .app-logo` ocultaba el logo incluso cuando se intentaba posicionar con `fixed`. Se forzó visibilidad con `opacity: 1 !important` y `visibility: visible !important` en el estado fixed (Línea 408).

**2. AUDITORÍA DE main.js**
- **Hallazgo (Botón X):** La lógica para mostrar/ocultar el botón de limpieza de búsqueda (`#clear-search-btn`) mediante la clase `.has-text` no estaba implementada. Se añadió el listener en la línea 41.
- **Hallazgo (Pull-to-refresh):** El cambio de scroll del `body` al `.container` desactivó el gesto nativo del navegador. Se restauró mediante listeners de `touchstart` y `touchend` calculando el desplazamiento vertical (Línea 105).

**3. AUDITORÍA DE VERSIONAMIENTO**
- **Hallazgo:** Inconsistencias entre `index.html` (v4.9.2) y los logs. Se normalizó todo el proyecto a la versión v4.9.5.

**AUDITORÍA DE AJUSTE FINO QUIRÚRGICO (02/02/2026)**

**1. AUDITORÍA DE style.css**
- **Hallazgo (Escala del Logo):** En la línea 406,  tiene . Con un input de aproximadamente 48px, esto representa un ~79% de la altura, lo cual es percibido como pequeño. Se debe ajustar a ~45px (95% de 48px).
- **Hallazgo (Desbordamiento Horizontal):** En la línea 379,  usa . Si el ancho no está limitado a  o si hay un padding/margen externo, puede causar overflow. La falta de  global (o al menos en este elemento) es un riesgo.
- **Hallazgo (Animación de Botones):** En las líneas 359-373, los botones de sección se ocultan con  y  de forma conjunta. El uso de  puede estar cortando la animación de opacidad prematuramente, causando el "salto visual". Se recomienda separar la lógica de animación o suavizar los tiempos.
- **Hallazgo (Box-sizing):** No hay una regla universal de , lo que genera inconsistencias en el cálculo de anchos con padding.

**2. AUDITORÍA DE index.html**
- **Estructura:** La jerarquía  es correcta, pero el desbordamiento ocurre cuando  se vuelve  y el navegador no compensa el ancho de la barra de scroll si el viewport no está correctamente configurado.

**3. AUDITORÍA DE main.js**
- **Viewport:** La lógica de  es sólida, pero no interfiere directamente con los problemas visuales reportados, los cuales son puramente de CSS.

**RESULTADOS DE EJECUCIÓN QUIRÚRGICA (v4.9.6):**
- **style.css (Línea 406):** Se eliminó  y se estableció  con  para el logo en modo búsqueda, logrando la proporcionalidad requerida.
- **style.css (Línea 388):** Se aplicó ,  y  a  en estado  para eliminar el scroll horizontal.
- **style.css (Línea 372):** Se suavizó la transición de colapso del header usando curvas de tiempo diferenciadas: .
- **index.html:** Actualización de versión a v4.9.6.

**AUDITORÍA DE AJUSTE FINO QUIRÚRGICO (02/02/2026)**

**1. AUDITORÍA DE style.css**
- **Hallazgo (Escala del Logo):** En la línea 406, `body.search-active .app-logo` tiene `max-width: 38px`. Con un input de aproximadamente 48px, esto representa un ~79% de la altura, lo cual es percibido como pequeño. Se debe ajustar a ~45px (95% de 48px).
- **Hallazgo (Desbordamiento Horizontal):** En la línea 379, `body.search-active .main-header` usa `left: 0; right: 0; position: fixed;`. Si el ancho no está limitado a `100%` o si hay un padding/margen externo, puede causar overflow. La falta de `box-sizing: border-box` global (o al menos en este elemento) es un riesgo.
- **Hallazgo (Animación de Botones):** En las líneas 359-373, los botones de sección se ocultan con `opacity: 0` y `max-height: 0` de forma conjunta. El uso de `max-height: 0` puede estar cortando la animación de opacidad prematuramente, causando el "salto visual". Se recomienda separar la lógica de animación o suavizar los tiempos.
- **Hallazgo (Box-sizing):** No hay una regla universal de `box-sizing: border-box`, lo que genera inconsistencias en el cálculo de anchos con padding.

**2. AUDITORÍA DE index.html**
- **Estructura:** La jerarquía `.main-header > .header-top + .header-bottom` es correcta, pero el desbordamiento ocurre cuando `main-header` se vuelve `fixed` y el navegador no compensa el ancho de la barra de scroll si el viewport no está correctamente configurado.

**3. AUDITORÍA DE main.js**
- **Viewport:** La lógica de `visualViewport` es sólida, pero no interfiere directamente con los problemas visuales reportados, los cuales son puramente de CSS.

**RESULTADOS DE EJECUCIÓN QUIRÚRGICA (v4.9.6):**
- **style.css (Líneas 406-412):** Se eliminó `max-width: 38px` y se estableció `height: 48px` con `width: auto` para el logo en modo búsqueda, logrando la proporcionalidad requerida.
- **style.css (Línea 388):** Se aplicó `width: 100%`, `box-sizing: border-box` y `overflow-x: hidden` a `.main-header` en estado `search-active` para eliminar el scroll horizontal.
- **style.css (Línea 372):** Se suavizó la transición de colapso del header usando curvas de tiempo diferenciadas: `opacity 0.3s ease-out, transform 0.3s ease-out, max-height 0.4s ease-in-out`.
- **index.html:** Actualización de versión a v4.9.6.

**AUDITORÍA DE REPARACIÓN DE PRECISIÓN (02/02/2026)**

**1. AUDITORÍA DE style.css (ANÁLISIS DE FRACASO)**
- **Hallazgo (Logo fuera de lugar):** Las reglas de la línea 405 (`body.search-active .app-logo`) y 420 (`body.search-active .header-branding .app-logo`) están en conflicto directo. La primera fuerza `position: fixed` y `opacity: 1`, mientras la segunda intenta ocultar el logo original. Esto rompe el flujo del flexbox y saca al logo de su contexto visual.
- **Hallazgo (Desbordamiento):** Aunque se añadió `width: 100%` y `overflow-x: hidden`, el uso de `padding: 10px 20px` en un elemento `position: fixed` sin un control estricto de `box-sizing` y herencia puede seguir causando desbordamiento si el scroll del body no está totalmente bloqueado.
- **Hallazgo (Animación):** El uso de `max-height: 0` en la línea 368 colapsa el espacio instantáneamente a pesar de la transición, lo que genera el salto visual reportado.
- **Hallazgo (Falta de Unificación):** Existen 7 reglas separadas bajo `body.search-active` que controlan el mismo componente (Header). Esto viola la norma de unificación.

**2. PLAN DE REPARACIÓN QUIRÚRGICA:**
- Unificar todas las reglas de `body.search-active` que afectan al header en un bloque consolidado.
- Eliminar el posicionamiento `fixed` redundante del logo; mantenerlo en el flujo o posicionarlo absolutamente *dentro* del header ya fijo.
- Ajustar altura del logo a 40px (≈5% menor que los 42-44px del input) y centrarlo mediante `transform: translateY` o ajuste fino de `top`.
- Bloquear scroll horizontal en `html` y `body` de forma redundante durante la búsqueda.

**RESULTADOS DE REPARACIÓN DE PRECISIÓN (v4.9.6):**
- **style.css (Línea 380-420):** Se unificaron todas las reglas de búsqueda activa. Se eliminó el posicionamiento `fixed` del logo y se reemplazó por `position: absolute` con `top: 50%` y `transform: translateY(-50%)` relativo al header, garantizando un centrado vertical milimétrico.
- **style.css (Línea 389):** Se añadió `gap: 0` al header activo para asegurar que el centrado vertical no se vea afectado por elementos ocultos con `max-height: 0`.
- **style.css (Línea 389-390):** Se consolidó el control de desbordamiento horizontal mediante `box-sizing: border-box` y `overflow: hidden`.
- **index.html:** Actualización de versión a v4.9.6.

**AUDITORÍA BACKLOG CORRECCIONES CRÍTICAS (02/02/2026)**

**1. TAREA 1 — OPTIMIZACIÓN SPLASH SCREEN (auth.js, state.js, ui.js)**
- **Hallazgo (auth.js):** Las funciones `checkSession` (Línea 80) y `login` (Línea 98) bloquean la ejecución con `await loadInitialData()` antes de mostrar la aplicación.
- **Hallazgo (state.js):** El sistema de estado es estático; no existe un patrón de observador para notificar a la UI cuando los datos han terminado de cargar en segundo plano.
- **Hallazgo (ui.js):** La función `showApp` (Línea 1223) tiene una guarda que impide el renderizado si los datos no están listos, pero no ofrece un estado de carga alternativo.
- **Riesgo:** Si se quita el `await`, la aplicación podría mostrarse vacía sin disparar el renderizado posterior. Se requiere implementar `subscribe` en `state.js`.

**2. TAREA 2 — BÚSQUEDA DE MODELOS NUMÉRICOS (navigation.js)**
- **Hallazgo:** El regex `/\b\d{4}\b/` (Línea 44) captura cualquier número de 4 dígitos como año sin validar rangos (ej. 0001 o 9999).
- **Hallazgo:** No hay priorización de coincidencia exacta de modelo sobre coincidencia de año.
- **Riesgo:** Colisiones en modelos que son números (ej. BMW 2002).

**3. TAREA 3 — VISUALIZACIÓN DE VIDEOS (catalog.js, ui.js)**
- **Hallazgo (catalog.js):** La normalización de YouTube es rudimentaria (Línea 306).
- **Hallazgo (ui.js):** `getYouTubeEmbedUrl` (Línea 1005) no maneja todos los formatos de URL de YouTube (ej. compartidos, shorts).
- **Riesgo:** Videos rotos o no reproducibles en el modal.

**4. TAREA 4 — ESTABILIDAD DEL INBOX (ui.js)**
- **Hallazgo:** `openInbox` (Línea 888) asume que los datos están siempre en `result.data`.
- **Riesgo:** Fallo de carga si el backend cambia la estructura de respuesta o si los datos vienen en una clave distinta (ej. `messages`).

**5. TAREA 5 — ANIMACIONES DEL HEADER (style.css)**
- **Hallazgo:** Existen múltiples reglas bajo `body.search-active` que redefinen transiciones, lo que puede causar "lag" visual o cortes abruptos si `max-height` y `opacity` no están perfectamente sincronizados.
- **Riesgo:** Experiencia de usuario entrecortada en móviles.

**6. TAREA 6 — RESOLUCIÓN DE IMÁGENES (ui.js)**
- **Hallazgo:** `getImageUrl` (Línea 12) usa un tamaño por defecto de 280px. En modales se usa 1000px.
- **Riesgo:** Imágenes borrosas en dispositivos modernos con alta densidad de píxeles (Retina/OLED).

**AUDITORÍA DE DESBORDAMIENTO DE BÚSQUEDA (02/02/2026)**
- **Hallazgo 1 (Causa Raíz):** Falta reset global de `box-sizing: border-box`. El input `#searchInput` tiene `width: 100%` y un padding horizontal acumulado de hasta 95px en modo activo (55px izq + 40px der). Esto genera un desbordamiento de `width: 100% + 95px` sobre el contenedor padre.
- **Hallazgo 2 (Layout Flex):** El contenedor `.search-wrapper` es un flexbox. En modo `search-active`, el botón `#hamburger-btn` se oculta con `visibility: hidden` y `max-height: 0`, pero su `width` original (o el de su contenedor) podría seguir afectando el cálculo del `flex-grow: 1` del `.search-container`, empujándolo hacia la derecha.
- **Hallazgo 3 (Consolidación):** Existen reglas redundantes para `#searchInput` en las líneas 399 y 404 de `style.css` que deben ser unificadas.

**AUDITORÍA DE FALLO DE CARGA DE INBOX (02/02/2026)**
- **Hallazgo 1 (Conexión):** El sistema de Inbox depende de `getFeedbackItems` en `api-config.js`. La conexión es correcta a través de `routeAction` hacia el servicio `FEEDBACK`.
- **Hallazgo 2 (Estructura de Datos):** La función `openInbox` en `ui.js` intenta extraer datos de varias claves (`data`, `messages`, `items`). Sin embargo, si el backend devuelve un error o un formato inesperado, la UI se queda en "Cargando mensajes..." o muestra un error genérico sin detalles.
- **Hallazgo 3 (Integridad):** Se detectó que el Dashboard y otras funcionalidades operativas se perdieron o quedaron incompletas en archivos clave (`ui.js`, `main.js`) debido a errores en la aplicación de cambios previos. Esto afecta la estabilidad global.
- **Hallazgo 4 (Robustez):** `renderInboxList` en `ui.js` realiza un `substring` sobre `item.content`. Si el contenido es nulo o no es una cadena, la función fallará silenciosamente, impidiendo el renderizado de la lista.
- **Hallazgo 5 (Inicialización):** `setupModal` se ejecuta al nivel superior de `ui.js`. Si por alguna razón el DOM no está listo (aunque sea un módulo), la función retorna `undefined`, rompiendo los listeners en `main.js`.

**RECOMENDACIÓN:** Refactorizar `setupModal` para búsqueda perezosa de elementos, mejorar la resiliencia de `renderInboxList` y restaurar la integridad de las funciones operativas (`openDashboard`).

**AUDITORÍA TÉCNICA FINAL - REVISIÓN DE INTEGRIDAD (02/02/2026)**

1. **Hallazgo: Desajuste de Contrato de Datos (Dashboard)**
   - **Problema:** El backend (`feedback.js`) entrega claves en minúsculas (`timestamp`, `nombreUsuario`, `tipoActividad`, `detalle`). La implementación inicial en el frontend (`ui.js`) buscaba claves con PascalCase (`Timestamp`, `Usuario`, `Accion`, `Detalles`).
   - **Impacto:** Las filas del Dashboard se mostraban vacías o con fechas inválidas en producción.
   - **Estado:** Corregido en `ui.js`.

2. **Hallazgo: Vulnerabilidad ante Hojas Faltantes (Inbox)**
   - **Problema:** `handleGetFeedbackItems` fallaba catastróficamente si las hojas "Feedbacks" o "Contactanos" no existían, debido a llamadas directas a `getDataRange()` sobre objetos nulos.
   - **Impacto:** Bloqueo total del sistema de Inbox con error 500 del servidor.
   - **Estado:** Corregido en `feedback.js` con validaciones defensivas.

3. **Hallazgo: Inconsistencia de Roles Administrativos**
   - **Problema:** Existía ambigüedad entre el rol "Jefe" y el error tipográfico "Gefe" en la base de datos vs el código.
   - **Impacto:** Usuarios con privilegios administrativos podían no ver los botones de gestión.
   - **Estado:** Se unificaron ambos criterios en `ui.js`.

4. **Hallazgo: Integridad del DOM (Modales)**
   - **Problema:** El modal de Dashboard no estaba definido en el HTML, a pesar de estar referenciado en JS.
   - **Estado:** Implementado en `index.html`.

5. **Hallazgo: Riesgo de Regresión Visual (CSS)**
   - **Problema:** La adición de `box-sizing: border-box` a nivel global (`*`) puede alterar el tamaño de elementos que dependen del comportamiento por defecto (`content-box`).
   - **Revisión:** La mayoría de los componentes clave ya tenían esta propiedad declarada individualmente. Se mantiene la regla global por estándar de modernización, pero se requiere vigilancia.

6. **Hallazgo: Residuos de Desarrollo**
   - **Problema:** Presencia de archivos `.bak` y scripts de prueba en la raíz.
   - **Estado:** Eliminados.

**AUDITORÍA DE ESTILOS DE INBOX (02/02/2026)**

**1. AUDITORÍA DE ui.js (Sección Inbox)**
- **Línea 972-977 (renderInboxList):**
    - Hallazgo: El innerHTML de la tarjeta muestra el asunto (title) y una previsualización del contenido (contentPreview).
    - Requerimiento: Mostrar solo asunto y tipo de mensaje.
- **Línea 992 (renderInboxDetail):**
    - Hallazgo: Se utiliza un h3 para el asunto.
    - Requerimiento: Reducir tamaño de letra del título.
- **Línea 930 (openInbox):**
    - Hallazgo: Presencia de console.error.
    - Requerimiento: Eliminar según directivas de calidad.

**2. AUDITORÍA DE style.css (Sección Inbox)**
- **Línea 1115 (.inbox-item):**
    - Hallazgo: padding de 12px.
    - Requerimiento: Minimizar márgenes internos.
- **Línea 1150 (.inbox-item-content p):**
    - Hallazgo: Estilos para el párrafo que actualmente muestra la previsualización.
    - Requerimiento: Adaptar para etiqueta de tipo de mensaje.
- **Línea 1158 (#inbox-detail h3):**
    - Hallazgo: Estilo para el título del detalle sin tamaño de fuente explícito reducido.
    - Requerimiento: Reducir tamaño de fuente.
- **Línea 1162 (.inbox-message-content, .inbox-reply-content):**
    - Hallazgo: padding de 15px y margin de 15px 0.
    - Requerimiento: Minimizar márgenes y paddings.
- **Línea 1180 (.inbox-actions):**
    - Hallazgo: margin-top de 20px. Requerimiento: Minimizar.

**3. AUDITORÍA DE index.html (Estructura Inbox)**
- **Línea 260 (#inbox-list):** Hallazgo: overflow-y: auto presente.
- **Línea 263 (#inbox-detail):** Hallazgo: No tiene overflow-y: auto.
    - Requerimiento: Resolver desbordamiento del contenedor.

**RIESGOS Y EFECTOS COLATERALES:**
- El cambio de flex: 2 en #inbox-detail puede causar problemas en pantallas pequeñas si no se maneja bien el overflow.
- La reducción de márgenes puede afectar la legibilidad si es extrema.
