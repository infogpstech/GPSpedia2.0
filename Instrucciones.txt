Importante: 
PROHIBIDO AGREGAR CONTENIDO ANTES DEL SIGUIENTE BLOQUE DE TEXTO. 

— PROCEDIMIENTO OBLIGATORIO DE TRABAJO.
===================================================================

Este procedimiento es de CUMPLIMIENTO OBLIGATORIO en TODOS los proyectos.
No se permite omitir, alterar ni reordenar pasos.

--------------------------------------------------
FLUJO PRINCIPAL DE TRABAJO
--------------------------------------------------

1. AUDITORÍA INICIAL DEL ARCHIVO
   - Auditar el/los archivo(s) involucrados.
   - Revisión archivo por archivo.
   - Revisión línea por línea.
   - Identificar estado actual, riesgos, dependencias y efectos colaterales.
   - PROHIBIDO modificar código en esta etapa.

2. REGISTRO DE HALLAZGOS
   - Registrar TODOS los hallazgos en Auditoría.txt.
   - Crear nueva entrada o actualizar la existente.
   - PROHIBIDO eliminar información previa.
   - NO realizar correcciones durante la auditoría.

3. MANEJO DE HALLAZGOS FUERA DE ALCANCE
   - Si se detectan problemas fuera de la tarea actual:
     a) Resolverlos en el MISMO commit SOLO si es seguro.
     b) Si no es posible:
        -> Registrar nueva tarea en Instrucciones.txt
        -> Referenciarla en Auditoría.txt

4. RESPALDO OBLIGATORIO ANTES DE EDICIÓN
   - Crear copia exacta del/los archivo(s) a modificar.
   - El respaldo DEBE conservar:
     · Nombre original
     · Contenido íntegro
   - El respaldo se usa EXCLUSIVAMENTE para comparación posterior.

5. EJECUCIÓN DE LA TAREA
   - Implementar ÚNICAMENTE lo solicitado.
   - PROHIBIDO:
     · Cambiar estilos no relacionados
     · Alterar flujos existentes
     · Introducir optimizaciones no solicitadas
   - Todo cambio debe estar justificado por la tarea.

6. VERIFICACIÓN FUNCIONAL
   - Confirmar que la tarea cumple su objetivo.
   - Verificar que no se rompan funciones existentes.
   - Probar flujos relacionados directa e indirectamente.

7. COMPARACIÓN POST-EDICIÓN (OBLIGATORIA)
   - Comparar archivo editado contra el respaldo previo.
   - Identificar:
     · Líneas eliminadas
     · Líneas modificadas
     · Bloques sobreescritos
   - Verificar que:
     -> TODO cambio esté directamente relacionado con la tarea.
   - Si se detectan cambios ajenos:
     -> REVERTIRLOS inmediatamente
     -> Repetir la comparación
-Los archivos de Respaldo se debe eliminar DESPUES de la revision de codigo de Code Review. 
-Todo archivo, captura generado para la verificación visual o ejecutable debe de ser eliminado en el pre-commit. 

8. VERIFICACIÓN DE INTEGRIDAD Y EFECTOS COLATERALES
   - Revisar dependencias internas y externas.
   - Detectar efectos colaterales visuales o lógicos.
   - Confirmar que no existen regresiones.

9. REVISIÓN FINAL DE CÓDIGO
   - Revisión completa nuevamente.
   - Línea por línea.
   - Función por función.
   - Evaluar consistencia, claridad y impacto.

10. REGISTRO EN CHANGESLOGS.TXT
    - Registrar TODOS los cambios realizados.
    - Indicar:
      · Archivo modificado
      · Líneas afectadas
      · Descripción objetiva
    - PROHIBIDO asumir éxito o usar frases de cierre.

11. ACTUALIZACIÓN DE INSTRUCCIONES.TXT
    - Mover la tarea ejecutada a:
      -> "TAREAS PENDIENTES DE REVISIÓN"
    - NO eliminar tareas sin aprobación del PM.

12. COMMIT
    - Realizar UN SOLO commit por ciclo completo.
    - El commit DEBE reflejar EXACTAMENTE
      lo auditado y documentado.


--------------------------------------------------
EXTENSIÓN OBLIGATORIA POR CODE REVIEW
--------------------------------------------------

Si el Code Review detecta:
- Fallas
- Bloqueantes
- Riesgos
- Cambios requeridos

ENTONCES:
-> Este MISMO procedimiento DEBE aplicarse nuevamente
-> Incluso si implica modificar archivos ya editados
-> NO se permiten correcciones parciales


==================================================
PROTOCOLO DE RESULTADO DE CODE REVIEW
==================================================

--------------------------------------------------
FLUJO DE ANÁLISIS
--------------------------------------------------

1. LECTURA COMPLETA DEL CODE REVIEW
   - Leer TODO el informe.
   - No omitir secciones.

2. SAFETY & SIDE EFFECTS
   - Se considera FUENTE DE VERDAD PRINCIPAL.
   - SOLO se ignora si el Code Review solicita
     explícitamente revertir cambios.

--------------------------------------------------
TRATAMIENTO DE REVERSIÓN
--------------------------------------------------

3. EVALUACIÓN OBLIGATORIA

   a) CAMBIOS "OUT OF SCOPE"
      - Verificar si pertenecen a:
        · Tareas anteriores
        · Commits previos aprobados

      - Si pertenecen a tareas anteriores:
        -> IGNORAR solicitud de reversión
        -> CONTINUAR con el commit actual

   b) CAMBIOS DE LA TAREA ACTUAL
      - Si los cambios NO solicitados
        fueron introducidos durante la tarea actual:
        -> REALIZAR reversión
        -> REGISTRAR el motivo

--------------------------------------------------
IMPACTO EN EL FLUJO
--------------------------------------------------

4. REINICIO DEL CICLO
   - Toda observación que implique cambios:
     -> REINICIA el ciclo completo
        desde la AUDITORÍA INICIAL

   - El reinicio NO afecta:
     · Commits anteriores
     · Tareas aprobadas
     · Cambios fuera de alcance


--------------------------------------------------
DOCUMENTACIÓN OBLIGATORIA
--------------------------------------------------

Toda acción derivada del Code Review
DEBE quedar registrada en:
- Auditoría.txt
- ChangesLogs.txt
- Instrucciones.txt (si aplica)


--------------------------------------------------
REGLA FINAL ABSOLUTA
--------------------------------------------------

SI NO SE AUDITA, NO SE CAMBIA.
SI NO SE REGISTRA, NO EXISTE.

El incumplimiento de CUALQUIER paso
INVALIDA el proceso completo.

---
**TAREAS PENDIENTES DE REVISIÓN**
---
1. **TÍTULO: Reparación de Precisión de Layout y Logo (v4.9.6)**
   - **ESTADO:** PENDIENTE DE REVISIÓN POR EL PM
   - **TIPO:** Refinamiento UI / Bugfix Layout / Unificación CSS
   - **ALCANCE:** Corrección milimétrica de centrado de logo y desbordamiento horizontal.
   - **DESCRIPCIÓN DETALLADA:**
     - **Unificación:** Consolidación de reglas CSS dispersas bajo `body.search-active` en un solo bloque coherente.
     - **Centrado Logo:** Implementación de centrado vertical dinámico (`top: 50%`, `transform: translateY(-50%)`) y escala del 95%.
     - **Layout:** Eliminación de `gap` en header activo para colapso total de espacio superior.
     - **Overflow:** Bloqueo estricto de desbordamiento horizontal en el encabezado fijo.

2. **TÍTULO: Corrección de Regresiones del Header (v4.9.5)**
   - **ESTADO:** PENDIENTE DE REVISIÓN POR EL PM
   - **TIPO:** Bugfix / UX / Regresión
   - **ALCANCE:** Restauración completa de funcionalidades perdidas tras el refactor estructural.
   - **DESCRIPCIÓN DETALLADA:**
     - **Hamburger:** Restaurada visibilidad e interactividad mediante ajuste de z-index y capas.
     - **Búsqueda:** Se implementó el botón "X" para limpiar términos y su lógica visual (`.has-text`).
     - **Logo:** Corregida animación y visibilidad en modo búsqueda (ya no desaparece).
     - **Pull-to-refresh:** Re-implementado mediante listeners de touch para permitir recarga manual en móviles.
     - **Versión:** Sincronización global a v4.9.5.

2. **TÍTULO: Restauración de Animaciones y Botón Hamburguesa**
   - **ESTADO:** PENDIENTE DE REVISIÓN POR EL PM
   - **TIPO:** Fix UX / UI Regression / Animaciones
   - **ALCANCE:** Restauración de la fluidez visual y componentes esenciales del header tras el refactor estructural.
   - **DESCRIPCIÓN DETALLADA:**
     - **Animaciones:** Se reemplazó `display: none` por transiciones de `opacity` y `max-height` para restaurar la suavidad entre estados de búsqueda.
     - **Hamburger:** Se restauró la visibilidad y interactividad del botón de menú lateral.
     - **Logo:** Se re-activó la animación de reducción y reposicionamiento del logo.
     - **Estabilidad:** El fix de "espacio fantasma" se mantiene intacto mediante colapso de altura animado.

2. **TÍTULO: Reconstrucción Extrema del Header y Fix de Espacio Fantasma**
   - **ESTADO:** PENDIENTE DE REVISIÓN POR EL PM
   - **TIPO:** Refactor Estructural / Layout Móvil / UX
   - **ALCANCE:** Reconstrucción integral del sistema de encabezado y búsqueda para eliminar redundancias y fallos de visualización en móviles.
   - **DESCRIPCIÓN DETALLADA:**
     - **HTML:** Implementación de `.main-header` como contenedor maestro unificado.
     - **CSS:** Centralización de estilos y uso de `display: none !important` para colapsar espacio en modo búsqueda. Sincronización milimétrica del padding de resultados (70px).
     - **JS:** Ajuste de `ui.js` para compatibilidad con la nueva jerarquía (mensaje de bienvenida).
     - **Visual:** Eliminación total del hueco entre barra y resultados manteniendo la estética original.

2. **TÍTULO: Corrección de Causa Raíz de Fallos en Búsqueda y Modal**
   - **ESTADO:** PENDIENTE DE REVISIÓN POR EL PM
   - **TIPO:** Corrección de Causa Raíz / Bug de Datos / Bug Visual de CSS
   - **ALCANCE:** Se implementaron correcciones definitivas en el backend (`services/catalog/catalog.js`), frontend (`ui.js`) y CSS (`style.css`) basadas en una auditoría consolidada.
   - **DESCRIPCIÓN DETALLADA:**
     - **Problema Video (Causa Raíz: Contrato de Datos Roto):** Se corrigió la discrepancia de nombres de propiedad entre el backend y el frontend. El servicio `catalog.js` ahora renombra `videoGuiaDesarmeUrl` a `Video` antes de enviar la respuesta. El `ui.js` fue ajustado para consumir esta propiedad (`Video`), solucionando la causa raíz de que el video no se visualizara.
     - **Problema Espaciado (Causa Raíz: Especificidad CSS):** Se añadió `!important` a la regla de CSS que anula el `margin-bottom` del `div#search-wrapper` en `style.css`. Esto asegura que el estilo en línea del `index.html` sea sobrescrito y el espacio extra se elimine correctamente.


---
**DERIVADO DE AUDITORÍA — NO EJECUTAR AÚN**
---
*No hay tareas pendientes en esta sección.*

---
**TAREAS COMPLETADAS (Validadas por el PM)**
---
1. MEJORA Y REFINAMIENTO DE ANIMACIÓN DE BÚSQUEDA
Estado: COMPLETADO
Origen: Refinamiento UX
Prioridad: Normal
Área: Frontend | UI | CSS | JS
Archivos involucrados: style.css, main.js

Descripción:
Se completó un ciclo de mejoras en la animación de la barra de búsqueda. Las implementaciones incluyen:
- La adición de la animación de expansión/contracción de la barra al hacer foco, replicando el comportamiento de la v1.5.
- La ocultación del menú de hamburguesa y la reducción del espacio superior para optimizar la vista de búsqueda.
- La corrección final y definitiva del espaciado vertical entre la barra y los resultados, asegurando una alineación perfecta.

2. INVESTIGAR CIERRE DE SESIÓN INESPERADO TRAS REFRESH
Estado: COMPLETADO
Origen: Reporte de Bug
Prioridad: CRÍTICA
Área: Frontend | Autenticación | Estado
Archivos involucrados: auth.js

Descripción:
Se ha implementado una corrección para prevenir una condición de carrera (`race condition`) durante la validación de la sesión. Se añadió un mecanismo de bloqueo (`lock`) en `localStorage` para asegurar que solo una pestaña o proceso de validación se comunique con el backend a la vez, evitando que validaciones concurrentes se invaliden entre sí.

3. CORRECCIÓN DEL SISTEMA DE BÚSQUEDA Y NAVEGACIÓN
Estado: COMPLETADO
Origen: Múltiples reportes de bugs y regresiones.
Prioridad: CRÍTICA
Área: Frontend | Navegación | Búsqueda | UX
Archivos involucrados: ui.js, navigation.js

Descripción:
Se completó un ciclo de correcciones que abordaron múltiples fallos en el sistema de búsqueda y su navegación subsecuente. Las correcciones incluyen:
- Asegurar que la búsqueda por modelo muestre tarjetas de modelo en lugar de logos de marca.
- Corregir el flujo de navegación para que, después de una búsqueda, se avance correctamente en la jerarquía de selección (Año, etc.).
- Eliminar una regresión que causaba la de-duplicación incorrecta de resultados.
- Corregir un `SyntaxError` fatal que impedía la carga de la aplicación.
- Implementar la corrección definitiva para el botón "Regresar", asegurando que devuelva al usuario a los resultados de la búsqueda de manera consistente, mediante el manejo correcto del estado de navegación anidado.

---
**TAREAS PENDIENTES DE REVISIÓN**
---
1. **TÍTULO: Correcciones Críticas GPSpedia (v4.9.7)**
   - **ESTADO:** PENDIENTE DE REVISIÓN POR EL PM
   - **TIPO:** Optimización / Bugfix / UX / Robustez
   - **ALCANCE:** Ejecución del backlog de 7 tareas críticas.
   - **DESCRIPCIÓN DETALLADA:**
     - **Splash Screen:** Carga no bloqueante de datos en segundo plano mediante sistema de observadores en `state.js`.
     - **Búsqueda:** Refinamiento de lógica de años (1900-2100) y priorización de modelos exactos.
     - **Videos:** Normalización robusta de URLs de YouTube en backend y frontend.
     - **Inbox:** Extracción resiliente de datos desde el API de feedback.
     - **Animaciones:** Optimización GPU del header para evitar lag.
     - **Imágenes:** Incremento de resolución para pantallas de alta densidad.
