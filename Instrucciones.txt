=================================================
 INSTRUCTIVO DEL PROYECTO GPSpedia 2.0
=================================================
**Versi贸n del Documento:** 3.2
**Fecha de Actualizaci贸n:** 2024-08-19

Este documento detalla las normas de desarrollo, el estado de las tareas pendientes y el flujo de trabajo para el proyecto GPSpedia 2.0.

Para un an谩lisis detallado del sistema, los hallazgos de la auditor铆a y las recomendaciones estrat茅gicas, consulte el archivo `Auditoria.txt`.

---------------------------------
NORMAS OBLIGATORIAS DE DESARROLLO
---------------------------------

**A. Control de Versiones y Documentaci贸n:**
1.  **Actualizaci贸n de Versi贸n:** Cualquier cambio debe reflejarse en el n煤mero de versi贸n visible en `index.html` y en los servicios de Apps Script.
2.  **Consulta y Actualizaci贸n de Documentaci贸n:** Antes y despu茅s de cualquier desarrollo, se deben consultar y actualizar `README.md`, `INSTRUCTIVO.TXT` y `CHANGESLOGS.txt`.
3.  **Detalle en `CHANGESLOGS.txt`:** Cada entrada debe especificar el archivo y n煤mero de l铆nea modificado.

**B. Calidad del C贸digo:**
1.  **Comentarios:** Todo c贸digo nuevo o modificado debe tener un comentario explicando su prop贸sito.

**C. Proceso de Aprobaci贸n:**
1.  **Verificaci贸n Post-Commit:** Una tarea solo se considera completada despu茅s de un commit y la validaci贸n expl铆cita del Project Manager.

---------------------------------
SISTEMA DE VERSIONAMIENTO HBRIDO
---------------------------------

El proyecto utiliza un sistema de dos niveles:

1.  **Versi贸n Global (P煤blica):**
    *   **Formato:** `vMAJOR.MINOR.PATCH` (ej. `v3.2.7`).
    *   **Funci贸n:** Representa el estado general del proyecto. Se actualiza en `ChangesLogs.txt` y `index.html` en cada `submit`.

2.  **Versi贸n de Componente (Interna):**
    *   **Formato:** `ARQUITECTURA.ARCHIVO.EDICION` (ej. `2.1.0`).
    *   **Funci贸n:** Rastrea la madurez de cada archivo de c贸digo (`.html`, `.gs`, `.js`).
    *   **Reglas:**
        *   **Frontend (arq. `2`):** `index.html`, `api-manager.js`, etc., inician en `2.0.0`.
        *   **Backend (arq. `1`):** Cada microservicio (`auth.js`, etc.) inicia en `1.0.0`.
    *   **Ubicaci贸n:** Debe registrarse en un comentario en la cabecera de cada archivo.

---------------------------------
PROCESO DE TRABAJO POR FASES
---------------------------------

Para organizar el desarrollo y asegurar la calidad, el trabajo se dividir谩 en fases. Cada fase se enfocar谩 en un conjunto espec铆fico de tareas y culminar谩 en un commit.

1.  **Asignaci贸n de Tareas:** Se define un conjunto de tareas (ej. "Ajustes de UI en `index.html`").
2.  **Desarrollo y Commit:** Se realizan todos los cambios de c贸digo necesarios para completar la fase.
3.  **Revisi贸n Post-Commit:** El Project Manager revisa los cambios.
    *   **Si es satisfactorio:** Se marca la tarea como completada en `README.md` y `INSTRUCTIVO.TXT`. Se registra el 茅xito en `CHANGESLOGS.txt`.
    *   **Si NO es satisfactorio:** Se registra el problema en `CHANGESLOGS.txt` y se crea una nueva tarea para solucionarlo. No se marcan las tareas como completadas.
4.  **Nuevas Solicitudes:** Cualquier nueva implementaci贸n o cambio solicitado se agregar谩 primero a la lista de pendientes en `README.md` y `INSTRUCTIVO.TXT` sin marcar. Solo se marcar谩n como completadas despu茅s de un ciclo de desarrollo y una revisi贸n post-commit exitosa.

---------------------------------
ESTADO ACTUAL DEL PROYECTO (CHECKLIST)
---------------------------------

### Tareas Completadas Recientemente
- [X] **Estandarizaci贸n de la Base de Datos del Backend:** Se ha verificado y actualizado toda la capa de microservicios (`auth`, `catalog`, `users`, `write`, `feedback`) para asegurar que todos apunten exclusivamente a la base de datos can贸nica v2.0.
- [X] **Resoluci贸n del Bug Cr铆tico "Pantalla Blanca":** Se refactoriz贸 el frontend (`index.html`) para alinearlo con la nueva estructura de datos `camelCase` del backend v2.0.
- [X] **Implementaci贸n del Sistema de Notificaci贸n de Errores:** Se a帽adi贸 un sistema de notificaciones globales en `index.html` y `api-manager.js`.
- [X] **Refactorizaci贸n del Acceso a Datos del Backend:** Se han actualizado todos los microservicios para utilizar un mapa de columnas fijo.
- [X] **Correcci贸n del Bug de Sesi贸n de Usuario:** Se solucion贸 un problema en `users.html` que imped铆a la correcta visualizaci贸n de la informaci贸n del usuario en sesi贸n.
- [X] **Reparaci贸n del Formulario de Contacto:** Se corrigi贸 el error "Acci贸n no definida" en el formulario de "Cont谩ctanos".
- [X] **Correcci贸n de Visualizaci贸n en Tutoriales:** Se solucion贸 un bug en `index.html` que provocaba que el texto de los tutoriales se mostrara como "undefined".

### Bugs y Regresiones Cr铆ticas
- [ ] **L贸gica del Modal de Detalle:** El modal de detalle actualmente solo carga la informaci贸n del primer corte, ignorando los datos de `corte2` y `corte3`.
- [ ] **Carga de Im谩genes en Modal:** Las im谩genes asociadas a la apertura, cable de alimentaci贸n y configuraci贸n del relay no se est谩n mostrando en el modal.
- [ ] **Carga de Logos en Modal:** El logo de la marca del veh铆culo no se est谩 cargando y mostrando correctamente dentro del modal.
- [ ] **Refactorizaci贸n del Flujo de Escritura:** Implementar el nuevo flujo de trabajo de 3 etapas para a帽adir/actualizar cortes.
- [ ] **Inconsistencias de Versionamiento:** Sincronizar la versi贸n global y las versiones de componentes en todos los archivos.
- [ ] **Visibilidad de Cortes:** Asegurar que las tres opciones de corte sean visibles en el modal si existen los datos.

### Revisiones de UI/UX
- [ ] **Redise帽o de Botones de Feedback:** Reemplazar los botones "S铆/No" por un sistema de pulgares (/) y a帽adir botones para "Sugerir un a帽o" y "Reportar un problema".
- [ ] **Reorganizaci贸n de Secciones Principales:** Alterar el orden a: 1. "ltimos Agregados", 2. "B煤squeda por Marca", 3. "B煤squeda por Categor铆a".
- [ ] **Layout de "ltimos Agregados":** Modificar el layout para que muestre los resultados en un formato de 3 columnas.
- [ ] **Visualizaci贸n de Marcas con Logos:** En "B煤squeda por Marca", reemplazar los nombres de las marcas por sus respectivos logos.

### Nuevas Funcionalidades
- [ ] **Sistema de Navegaci贸n Jer谩rquico:** Implementar un flujo de navegaci贸n guiado (Marca -> Modelo -> A帽o).
- [ ] **Sistema de Gesti贸n de Feedback (Inbox):** Desarrollar una interfaz para que Supervisores/Jefes gestionen los problemas reportados por los usuarios.
- [ ] **Implementaci贸n de Modo Oscuro:** A帽adir una paleta de colores alternativa y un interruptor para activarlo/desactivarlo.
- [ ] **Debugging Integral:** Implementar un sistema de debugging en backend y frontend accesible por rol.
- [ ] **Carga Optimizada de Im谩genes (Lazy Load):** Implementar carga progresiva de im谩genes para mejorar el rendimiento.
- [ ] **Soporte para Rango de A帽os (Feedback-driven):** Implementar la l贸gica de `suggestYear` en el backend y la UI correspondiente.
- [ ] **Sistema de Versionamiento H铆brido:** Aplicar el nuevo sistema de versionamiento a todos los componentes del c贸digo fuente.

### Deuda T茅cnica y Mejoras
- [ ] **Script de Migraci贸n de Timestamps:** Implementar un script de ejecuci贸n 煤nica para rellenar el campo `timestamp` en los registros existentes.

---
### Arquitectura de la Base de Datos

#### Arquitectura v2.0 (Can贸nica)
- **ID de Google Sheet:** `1M6zAVch_EGKGGRXIo74Nbn_ihH1APZ7cdr2kNdWfiDs`
- **Principio de Dise帽o:** Estructura granular y robusta, expl铆cita y a prueba de errores de formato.

A continuaci贸n se detalla la estructura de cada hoja en la base de datos. Los nombres de las columnas deben coincidir **exactamente** con los especificados.

##### 1. Hoja: `Users`
- **Columnas:** `ID`, `Nombre_Usuario`, `Password`, `Privilegios`, `Telefono`, `Correo_Electronico`, `SessionToken`.

##### 2. Hoja: `Cortes`
- **Columnas:** `id`, `categoria`, `marca`, `modelo`, `versionesAplicables`, `anoDesde`, `anoHasta`, `tipoEncendido`, `imagenVehiculo`, `videoGuiaDesarmeUrl`, `contadorBusqueda`, `tipoCorte1`, `ubicacionCorte1`, `colorCableCorte1`, `configRelay1`, `imgCorte1`, `utilCorte1`, `colaboradorCorte1`, `tipoCorte2`, `ubicacionCorte2`, `colorCableCorte2`, `configRelay2`, `imgCorte2`, `utilCorte2`, `colaboradorCorte2`, `tipoCorte3`, `ubicacionCorte3`, `colorCableCorte3`, `configRelay3`, `imgCorte3`, `utilCorte3`, `colaboradorCorte3`, `apertura`, `imgApertura`, `cableAlimen`, `imgCableAlimen`, `timestamp`, `notaImportante`.

##### 3. Hoja: `LogosMarca`
- **Columnas:** `id`, `nombreMarca`, `urlLogo`, `fabricanteNombre`.

##### 4. Hoja: `Tutorial`
- **Columnas:** `ID`, `Tema`, `Imagen`, `comoIdentificarlo`, `dondeEncontrarlo`, `Detalles`, `Video`.

##### 5. Hoja: `Relay`
- **Columnas:** `ID`, `configuracion`, `funcion`, `vehiculoDondeSeUtiliza`, `pin30Entrada`, `pin85BobinaPositivo`, `pin86bobinaNegativo`, `pin87aComunCerrado`, `pin87ComunmenteAbierto`, `imagen`, `observacion`.

##### 6. Hoja: `ActiveSessions`
- **Columnas:** `ID_Usuario`, `Usuario`, `ActiveSessions`, `date`, `Logs`.

##### 7. Hoja: `Feedbacks`
- **Columnas:** `ID`, `Usuario`, `ID_vehiculo`, `Problema`, `Respuesta`, `Se resolvio`, `Responde`, `Reporte de util`.

##### 8. Hoja: `Contactanos`
- **Columnas:** `Contacto_ID`, `User_ID`, `Asunto`, `Mensaje`, `Respuesta_mensaje`, `ID_usuario_responde`.

##### 9. Hoja: `Logs`
- **Columnas:** `Timestamp`, `Level`, `Message`, `Data`.

##### 10. Hoja: `ActividadUsuario`
- **Columnas:** `id`, `timestamp`, `idUsuario`, `nombreUsuario`, `tipoActividad`, `idElementoAsociado`, `detalle`.
