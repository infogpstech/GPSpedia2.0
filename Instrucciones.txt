NORMAS OBLIGATORIAS DE DESARROLLO
---------------------------------

**A. Control de Versiones y Documentación:**
1.  **Actualización de Versión:** Cualquier cambio debe reflejarse en el número de versión visible en `index.html` y en los servicios de Apps Script.
2.  **Consulta y Actualización de Documentación:** Antes y después de cualquier desarrollo, se deben consultar y actualizar `README.md`, `Instrucciones.txt` y `ChangesLogs.txt`.
3.  **Detalle en `ChangesLogs.txt`:** Cada entrada debe especificar el archivo y número de línea modificado.

**B. Calidad del Código:**
1.  **Comentarios:** Todo código nuevo o modificado debe tener un comentario explicando su propósito.
2. **prohibido eliminar el bloque que describe mas reglas en Instrucciones.txt
3.**prohibido resumir o utilizar sumarizacion "(Sin Cambios)" EN NINGUN ARCHIVO DE CODIGO, DOCUMENTACIÓN O DE REGLAMENTO. 
4. PROHIBIDO REVERTIR COMMITS SIN LA SOLUCITUD DEL PM. 
5. PROHIBIDO USAR HERRAMIENTAS BUSQUEDA, EDICION RAPIDA, TODA BUSQUESA, REVISION DEBE SER LINEA POR LINEA DE ARCHIVO POR ARCHIVO. 
6. OBLIGATORIO AUDITAR CADA ARCHIVO DE CODIGO ANTES DE CUALQUIER MODIFICACION POR MUY PEQUEÑA QUE SEA CADA HALLAZGO NO DEBE SER REPARADO EN EL MOMENTO DE AUDITORIA, DEBE DE REGISTRARSE EN Auditoria.txt Y DESPUES PLANTEARSE COMO UNA NUEVA TAREA EN Instrucciones.txt. 
7. PROHIBIDO DUPLICAR BLOQUES DE CODIGO, POR ELLO ES LA AUDITORIA INICIAL. 
8. PROHIBIDO INVENTARSE LA FECHA EN ChangesLogs.txt USAR DE REFERENCIA LA FECHA DE LA ULTIMA ENTRADA DE ChangesLogs.txt 
9. No asumir que cualquier fix registrado en ChangesLogs.txt fue exitoso. 
10. NO registrar como EXITO Cualquier Fix aplicado en el codigo, toda entrada debe evitar asumir arreglar fallas y evitar utilizar terminos como "Se corrigio, se arreglo,..etc" 

**C. Proceso de Aprobación:**
1.  **PROHIBIDO marcar tareas como “completadas” sin revisión del Project Manager.**
2.  **PROHIBIDO asumir que un cambio resolvió un problema.**
3.  **SOLO describir qué se cambió o qué se debe cambiar.**
4.  Si una tarea introduce nuevos errores: Marcar como **EN REVISIÓN**.
5.  Si la tarea no funciona o no cumple: Marcar como **REQUIERE NUEVA REVISIÓN**.
6. si una tarea se realizo no marcarla como COMPLETADA, marcarla como PENDIENTE REVISION POR EL MP. 
-Tareas Pendientes- 


GPSpedia

[TAREA] Centralizar la Lógica de Autorización de Backend

Origen: Auditoría Técnica Forense v2.0
Prioridad: CRÍTICA
Área: Arquitectura | Seguridad

Descripción:
El código para validar sesiones de usuario y verificar roles está duplicado en múltiples servicios de backend (ej. `services/users/users.js`, `services/utilities/utilities.js`). Esta inconsistencia representa un riesgo de seguridad y una pesadilla de mantenimiento.

Alcance:
- Crear un único servicio o librería compartida para manejar toda la lógica de autorización.
- Refactorizar todos los servicios existentes para que utilicen este nuevo componente centralizado.
- NO incluye la modificación de la lógica de frontend, solo el consumo del nuevo servicio.

Notas:
- Riesgo si no se ejecuta: Una brecha de seguridad si una política de permisos no se actualiza en todos los servicios a la vez.

---

[TAREA] Refactorizar Frontend para Separar Lógica de Presentación

Origen: Auditoría Técnica Forense v2.0
Prioridad: ALTA
Área: Frontend

Descripción:
El archivo `index.html` contiene una cantidad masiva de código JavaScript inline, mezclando la lógica de la aplicación con la estructura del DOM. Esto hace que el código sea frágil y difícil de mantener.

Alcance:
- Extraer todo el código JavaScript inline del `index.html` a archivos `.js` modulares y cohesivos.
- Reducir la dependencia de selectores de ID y clase en JavaScript, favoreciendo el uso de atributos `data-*` para desacoplar la lógica del estilo.
- NO incluye rediseñar la interfaz de usuario, solo refactorizar el código subyacente.

Notas:
- Riesgo si no se ejecuta: El mantenimiento del frontend se volverá cada vez más costoso y propenso a errores, ralentizando el desarrollo de nuevas funcionalidades.

---

[TAREA] Implementar Estrategia de Caché Granular para el Catálogo

Origen: Auditoría Técnica Forense v2.0
Prioridad: ALTA
Área: Performance | Backend

Descripción:
El servicio de catálogo (`services/catalog/catalog.js`) ha deshabilitado el almacenamiento en caché porque el conjunto de datos completo excede el límite de 100 KB de Google Apps Script. Esto causa que cada carga de la aplicación sea lenta, ya que debe leer y procesar toda la base de datos cada vez.

Alcance:
- Diseñar e implementar una estrategia de caché que no exceda los límites de tamaño. Esto podría implicar cachear subconjuntos de datos (ej. por categoría o marca) en lugar del catálogo completo.
- El frontend deberá ser actualizado para ensamblar los datos cacheados granularmente.
- NO incluye la optimización de otras consultas de la base de datos.

Notas:
- Riesgo si no se ejecuta: Tiempos de carga deficientes persistirán, afectando negativamente la experiencia del usuario.

---

[TAREA] Abstraer la Capa de Acceso a Datos del Backend

Origen: Auditoría Técnica Forense v2.0
Prioridad: MEDIA
Área: Arquitectura | Backend

Descripción:
La lógica de negocio en todos los servicios de backend está fuertemente acoplada a la estructura de la hoja de Google Sheets, utilizando índices de columna numéricos hardcodeados (ej. `row[COLS_CORTES.marca - 1]`). Esto hace que el sistema sea extremadamente frágil a cualquier cambio en la base de datos.

Alcance:
- Crear una capa de abstracción de datos (un "mapper" o "repositorio") que traduzca las filas de la hoja de cálculo a objetos JavaScript de una manera centralizada.
- Refactorizar todos los servicios para que utilicen esta capa de abstracción en lugar de acceder directamente a los índices de las columnas.
- NO incluye cambiar el esquema de la base de datos.

Notas:
- Riesgo si no se ejecuta: Un simple cambio como insertar una nueva columna en Google Sheets podría romper toda la aplicación de maneras impredecibles.

---

[TAREA] Implementar Bloqueo Concurrente para Operaciones Críticas

Origen: Auditoría Técnica Forense v2.0
Prioridad: MEDIA
Área: Backend | Arquitectura

Descripción:
Operaciones como registrar un "like" (`handleRecordLike` en `services/feedback/feedback.js`) no son atómicas, lo que crea una condición de carrera. Si dos usuarios realizan la misma acción simultáneamente, se pueden perder datos.

Alcance:
- Utilizar el `LockService` de Google Apps Script para envolver las operaciones de lectura-modificación-escritura en un bloqueo exclusivo.
- Aplicar este patrón a todas las operaciones identificadas como no atómicas, como los contadores.
- NO incluye una revisión exhaustiva de todas las operaciones del sistema, solo las más críticas ya identificadas.

Notas:
- Riesgo si no se ejecuta: La integridad de los datos generados por el usuario (likes, contadores, etc.) no es fiable.

---

[TAREA] Formalizar y Documentar la API de Microservicios

Origen: Auditoría Técnica Forense v2.0
Prioridad: BAJA
Área: Arquitectura | Documentación

Descripción:
La comunicación entre el frontend y el backend se basa en un contrato de API implícito y no documentado. Esto dificulta la incorporación de nuevos desarrolladores y aumenta la probabilidad de errores por expectativas desalineadas entre el cliente y el servidor.

Alcance:
- Crear documentación para cada endpoint de cada microservicio.
- La documentación debe especificar la `action` esperada, la estructura del `payload` de la solicitud y el formato de la respuesta JSON.
- NO incluye la creación de un nuevo sistema de API, solo documentar el existente.

Notas:
- Riesgo si no se ejecuta: El mantenimiento a largo plazo será más lento y costoso debido a la falta de una referencia clara de la API.
